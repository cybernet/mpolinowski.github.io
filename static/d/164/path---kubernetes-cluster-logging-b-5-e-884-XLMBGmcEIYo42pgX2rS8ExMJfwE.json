{"data":{"post":{"id":"a0100ea0-0287-51e3-aa3f-6c9b93f39641","html":"<p><a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/65a4bb9682b131df95bd3b6fd0295e2a/8e846/photo-11627898645_5f0761ff9e_o.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 800px;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 36.66666666666667%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsSAAALEgHS3X78AAABXUlEQVQoz42QT4uBURSHXy9GGEqMIllRyrwrNhpjZcewGTVW/pQNGSQpERsLJdmMlE8wdsp6fIbxHXyOZ957S8NMU7P4nXs6nfOc37nKrd2Oz+cjEokQjUZJJh+o1+s0m02q1SqVSoVarUav16Pf79Nut5lMJhSLL4TDYfx+P06nE0VRUHUpZpMJm82Gx+OR0FTqkVzuiW63y2g0YjabsVwumc/nDIdDxuMx6/WaTqdDqVSiUHjGrs8LoFEAb8xmrFYrLpeLQCCApt2TzWZoNBosFgum06kErlZvbLfv7Pd7WRcXCJfChMVi+QaeHbrdbkKhEPF4jHw+R6v1SiaTYTAYsNls2O12HA4fHI9HXZ+cTifK5bIEnSVPNshgwGg0YtbdOhwOvN476VY0aZpGMBiUy9LpNIlEglgspv91UtYN+uwVUL2AXW77r1RVvQb+1XjeLAZELt6f+S+4ri+0v9qnnE+8bAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    ></span>\n    <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px transparent;\"\n        alt=\"Angkor Wat, Cambodia\"\n        title=\"\"\n        src=\"/static/65a4bb9682b131df95bd3b6fd0295e2a/8ff1e/photo-11627898645_5f0761ff9e_o.png\"\n        srcset=\"/static/65a4bb9682b131df95bd3b6fd0295e2a/9ec3c/photo-11627898645_5f0761ff9e_o.png 200w,\n/static/65a4bb9682b131df95bd3b6fd0295e2a/c7805/photo-11627898645_5f0761ff9e_o.png 400w,\n/static/65a4bb9682b131df95bd3b6fd0295e2a/8ff1e/photo-11627898645_5f0761ff9e_o.png 800w,\n/static/65a4bb9682b131df95bd3b6fd0295e2a/6ff5e/photo-11627898645_5f0761ff9e_o.png 1200w,\n/static/65a4bb9682b131df95bd3b6fd0295e2a/8e846/photo-11627898645_5f0761ff9e_o.png 1500w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n      />\n  </span>\n  </a></p>\n<!-- TOC -->\n<ul>\n<li>\n<p><a href=\"#prometheus-and-grafana\">Prometheus and Grafana</a></p>\n<ul>\n<li><a href=\"#helm-installation\">Helm Installation</a></li>\n<li><a href=\"#prometheus-installation\">Prometheus Installation</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#the-elk-stack\">The ELK Stack</a></p>\n<ul>\n<li><a href=\"#installation\">Installation</a></li>\n</ul>\n</li>\n</ul>\n<!-- /TOC -->\n<h2 id=\"prometheus-and-grafana\"><a href=\"#prometheus-and-grafana\" aria-label=\"prometheus and grafana permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Prometheus and Grafana</h2>\n<p><a href=\"https://prometheus.io\">Prometheus</a> is an open-source monitoring solution that can be used with the visualization frontend <a href=\"https://grafana.com\">Grafana</a> to display your clusters health status. To install them we are going to use the <a href=\"https://helm.sh\">Helm Package Manager</a> for Kubernetes.</p>\n<h3 id=\"helm-installation\"><a href=\"#helm-installation\" aria-label=\"helm installation permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Helm Installation</h3>\n<p>Helm helps you manage Kubernetes applications — Helm Charts helps you define, install, and upgrade even the most complex Kubernetes application. Charts are easy to create, version, share, and publish — so start using Helm and stop the copy-and-paste.</p>\n<p>To install Helm, head over to their <a href=\"https://github.com/helm/helm/\">Github Page</a> and grab the link to the install binaries - in my case the latest version is <a href=\"https://github.com/helm/helm/releases/tag/v2.12.3\">Helm v2.12.3</a>. Use this link to download the binaries to your Centos server:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">wget</span> https://storage.googleapis.com/kubernetes-helm/helm-v2.12.3-linux-amd64.tar.gz\n<span class=\"token function\">tar</span> zxvf helm-v2.12.3-linux-amd64.tar.gz</code></pre></div>\n<p>The unzipped folder contains a file called <strong>helm</strong> that needs to be copied to <code class=\"language-text\">cp helm /usr/local/bin/</code>. You can type <code class=\"language-text\">helm</code> to verify that it is working:</p>\n<hr>\n<p><a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/518c86f0531fde53b4bcd6ad2113e501/5212a/kubernetes_logging_04.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 800px;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 12.28287841191067%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAIAAADXZGvcAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAATElEQVQI12Pg1jDg0zHh0TTi0zbm1TbmUNcXVNHVUdFlltdgVNBklFNnwINYlbTZVHTZVXXZVXRYlXVYlLRYFLWAgkAGUIRJQQOPZgAn9gyQepsMKgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    ></span>\n    <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px transparent;\"\n        alt=\"A Kubernetes Cluster & Microservices\"\n        title=\"\"\n        src=\"/static/518c86f0531fde53b4bcd6ad2113e501/8ff1e/kubernetes_logging_04.png\"\n        srcset=\"/static/518c86f0531fde53b4bcd6ad2113e501/9ec3c/kubernetes_logging_04.png 200w,\n/static/518c86f0531fde53b4bcd6ad2113e501/c7805/kubernetes_logging_04.png 400w,\n/static/518c86f0531fde53b4bcd6ad2113e501/8ff1e/kubernetes_logging_04.png 800w,\n/static/518c86f0531fde53b4bcd6ad2113e501/5212a/kubernetes_logging_04.png 806w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n      />\n  </span>\n  </a></p>\n<hr>\n<p>We can now type <code class=\"language-text\">helm init</code> to add the <strong>Tiller Pod</strong> to our cluster. You can verify that Helm is connected by running <code class=\"language-text\">helm version</code> (it should show your Helm client as well as Kubernetes version) and <code class=\"language-text\">kubectl get pods -n kube-system</code>:</p>\n<hr>\n<p><a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/f4498710f25a7e918a9b344bbeb214d5/dae74/kubernetes_logging_05.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 800px;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 70.77114427860697%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAIAAACgpqunAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABuUlEQVQoz41Sa2+bQBAEJxiDjeOYpKrUGDCve3BP41fV//+/OgtfospRKo1WHHezs7O7QTaMWzVO8ZxyF3Umb5Vs9fEog4J9g52+ANth3Ntr7u4bcYo7Ex76APgf8qu5QHZvb+/+vubuuZZhJRYVp+uShSWf8YC8t/fc3mZ98Hfm8mqvU8YrXCxbvWzUslXP9fCAnDK35j7lPukNIo4JM0lvV52OGhXVA2iIM/8JjfjsCO9SZlHtBCJv5GktfCo8YiZHHPFzgsXjuNVRq2FqUQnynLtbJqlPq96sOrPuTMZshkJaKjhGnEqImoE+JqAEMvICt+aKUcEhUqyYzXtTY1rcvTcqwDtIIW+nyQtlh50B+pAJtsM03gaJVcJs3Jus04dG1dwVval62whfCgdaQmVTddCPp3TBPGTsCSKdC5ZU4lenC+4qeSrFqWDu56zz0RMOn/CiztgNAHOiEuCk5AtYalU6nDf6gpmHBcez8IslocH+GP+8+d+oam4M+rSV406fo1ouSo6mfEnGYtAkj5IW86N7qgT4IEAQ31gv9PIx+c1TzZjqRngowwwmgVzoJW5pW2fl8l/yX2jmYvDhsGbHAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n    ></span>\n    <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px transparent;\"\n        alt=\"A Kubernetes Cluster & Microservices\"\n        title=\"\"\n        src=\"/static/f4498710f25a7e918a9b344bbeb214d5/8ff1e/kubernetes_logging_05.png\"\n        srcset=\"/static/f4498710f25a7e918a9b344bbeb214d5/9ec3c/kubernetes_logging_05.png 200w,\n/static/f4498710f25a7e918a9b344bbeb214d5/c7805/kubernetes_logging_05.png 400w,\n/static/f4498710f25a7e918a9b344bbeb214d5/8ff1e/kubernetes_logging_05.png 800w,\n/static/f4498710f25a7e918a9b344bbeb214d5/dae74/kubernetes_logging_05.png 804w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n      />\n  </span>\n  </a></p>\n<hr>\n<p>Before we can install package, first run a <code class=\"language-text\">helm repo update</code> to make sure that you are up to date. And to allow Helm/Tiller to install packages to the default namespace in Kubernetes, we first have to run these three commands (<strong>optional</strong> - the installation below will create a custom namespace <em>monitoring</em> that is not going to cause any issues):</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">kubectl create serviceaccount --namespace kube-system tiller\nkubectl create clusterrolebinding tiller-cluster-rule --clusterrole<span class=\"token operator\">=</span>cluster-admin --serviceaccount<span class=\"token operator\">=</span>kube-system:tiller\nkubectl patch deploy --namespace kube-system tiller-deploy -p <span class=\"token string\">'{\"spec\":{\"template\":{\"spec\":{\"serviceAccount\":\"tiller\"}}}}'</span> </code></pre></div>\n<h3 id=\"prometheus-installation\"><a href=\"#prometheus-installation\" aria-label=\"prometheus installation permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Prometheus Installation</h3>\n<p>To install Prometheus we are going to use a repository by CoreOS called <a href=\"https://github.com/helm/charts/tree/master/stable/prometheus-operator\">Prometheus Operator</a> that provides easy monitoring definitions for Kubernetes services and deployment and management of Prometheus instances.</p>\n<!--\n__Deprecation Warning__ Check [stable/prometheus-operator](https://github.com/helm/charts/tree/master/stable/prometheus-operator)!\n\nTo install it with Helm we need [those 3 commands](https://github.com/coreos/prometheus-operator/tree/master/helm)\n\n\n```bash\nhelm repo add coreos https://s3-eu-west-1.amazonaws.com/coreos-charts/stable/\nhelm install coreos/prometheus-operator --name prometheus-operator --namespace monitoring\nhelm install coreos/kube-prometheus --name kube-prometheus --namespace monitoring\n```\n\n> If you need to uninstall those packages later, you need to use the __purge__ flag: `helm delete --purge  prometheus-operator` and `helm delete --purge  kube-prometheus`\n-->\n<p>To install the chart with the release name <code class=\"language-text\">test-release</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">helm <span class=\"token function\">install</span> --name test-release stable/prometheus-operator --namespace monitoring</code></pre></div>\n<p>helm install coreos/grafana —name my-release —set adminUser=bob</p>\n<p>The command deploys prometheus-operator on the Kubernetes cluster in the default configuration. The <a href=\"https://github.com/helm/charts/tree/master/stable/prometheus-operator#configuration\">configuration section</a> lists the parameters that can be configured during installation.</p>\n<p>The default installation includes Prometheus Operator, Alertmanager, Grafana, and configuration for scraping Kubernetes infrastructure.</p>\n<p>To uninstall/delete the prometheus-operator deployment:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">helm delete --purge test-release\nkubectl delete crd prometheuses.monitoring.coreos.com\nkubectl delete crd prometheusrules.monitoring.coreos.com\nkubectl delete crd servicemonitors.monitoring.coreos.com\nkubectl delete crd alertmanagers.monitoring.coreos.com</code></pre></div>\n<p>You can verify the successful installation with <code class=\"language-text\">kubectl get all -n monitoring</code>:</p>\n<hr>\n<p><a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/e90e605663e5abdd6b8ef17e282bc0da/8d35d/kubernetes_logging_06.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 800px;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 83.22981366459628%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAIAAABSJhvpAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACJUlEQVQ4y02T2ZLaQAxFDcaYfRkmbwkB463dbi8wZib5/w/LkdrUpEqlasu60tUW7KrHsmgXWeMlzppVYsvUVZkrb9akrjN9UbbzxM7Ten6ro8QG52KUt+b51n6e2s9j8zwg9bCvP5YESh2A+Fbz2NmPg3tGNzv9Xe7sAz2Cj2449X9+3P++91+n7ssHWpXdBI9feZhUUVpvq8fBDeHFYBHw5QUm6t4NmDZVv7WPfT2sy25OEvUAEKduY+6b6j5LLBG3PK5V8DMjUIBreK1wQk8vBplI1JzPeerQi7wJr4ZAq0KCEmKZtzOFBFtzhyQ/NqaPMzdVbggP8aZJqaNaiZK1k3PJW6nVWILdCG4xLYp2qRJeKmJjobd8EgXCi7xFR7cai09A5h4k3FSPM4MbgXGaJSR0nhE+gPmFw9gwGrAue5KjSeXrkT5Du+yhB0bBJbEAYxEiHrzGO7GQ8XqqE0LEj2rFaMVyLqifvzCi/xM/6r2VDSMbDMH7Bx6zq43zRknSsHoUTQCYRYRmwAIBlu25vMCK9ONB+2zT/2aJnczyYMPYDeZE8V7WpiebX+Nl3hE3kv4ZaBOXhfleTz2MbpE7bYy0Gpj80LIpgQwUDynahibN6OBrZm8PzTAehntyGEe5ludGiGhHEooy0lRljj3UiQQyIaOjMuPAGDjhZUN0jcjPYmmd4yVCUDoCmBuUmrVacsp5VHfuJNIJM1LY+lF9y+vzHyn0dStizgn6AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n    ></span>\n    <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px transparent;\"\n        alt=\"A Kubernetes Cluster & Microservices\"\n        title=\"\"\n        src=\"/static/e90e605663e5abdd6b8ef17e282bc0da/8ff1e/kubernetes_logging_06.png\"\n        srcset=\"/static/e90e605663e5abdd6b8ef17e282bc0da/9ec3c/kubernetes_logging_06.png 200w,\n/static/e90e605663e5abdd6b8ef17e282bc0da/c7805/kubernetes_logging_06.png 400w,\n/static/e90e605663e5abdd6b8ef17e282bc0da/8ff1e/kubernetes_logging_06.png 800w,\n/static/e90e605663e5abdd6b8ef17e282bc0da/8d35d/kubernetes_logging_06.png 805w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n      />\n  </span>\n  </a></p>\n<hr>\n<p>We can also verify that the Prometheus web interface is working - but as you can see above, the service <code class=\"language-text\">kube-prometheus</code> only has an internal port set (<strong>ClusterIP</strong>). We can edit this default configuration with:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">kubectl edit svc kube-prometheus -n monitoring</code></pre></div>\n<p>This, by default will open the service configuration in Vim - you can install <strong>Nano</strong> and run <code class=\"language-text\">export EDITOR=nano</code> to prevent that from happening to you.</p>\n<hr>\n<p><a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/df9b7950539e3077e19d5e08df21958c/5212a/kubernetes_logging_07.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 800px;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 63.89578163771712%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABRklEQVQoz5WRCU/CQBCFt+UqclqPYJCjpe3eW7YCjTExcl/6//+OsxBNFGok+bLpMW/nvRnkvczIbEvnW7F8lysDPAN4uiazDZx4uoFXtf7gix1f7Nlix+a78G0VvC5RKVRXRDtRXIqUOUMF5H0G2H1q9Yjt0ZzHcn2KHkPUiVA7QC0fPRyoi1GdJaVAIKjrEesA6uJTrK+/36AK0a5Kyxh6yrzPCz4vDkQxEFYPn73iB+CnqSZNOW6IkRMqEKNuZvNTMXOHKYiv1QT00NME+0WWuIyHt/oZlG6cNsQYnOcHxnzOzIwfg9hZRiBtjT9VaVJjCXSuUF1lSZVqo/TYceyZKWAxUA3TsvvE7AY+/d82CO7i9EaOy4H8q+4sRY/5cdphusX0cdUXiJ1A3scpNIfMTqQKA36B2CVDT47aOK6YDUcXOf8ErqdXkaxNqeoAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    ></span>\n    <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px transparent;\"\n        alt=\"A Kubernetes Cluster & Microservices\"\n        title=\"\"\n        src=\"/static/df9b7950539e3077e19d5e08df21958c/8ff1e/kubernetes_logging_07.png\"\n        srcset=\"/static/df9b7950539e3077e19d5e08df21958c/9ec3c/kubernetes_logging_07.png 200w,\n/static/df9b7950539e3077e19d5e08df21958c/c7805/kubernetes_logging_07.png 400w,\n/static/df9b7950539e3077e19d5e08df21958c/8ff1e/kubernetes_logging_07.png 800w,\n/static/df9b7950539e3077e19d5e08df21958c/5212a/kubernetes_logging_07.png 806w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n      />\n  </span>\n  </a></p>\n<hr>\n<p>We added a <code class=\"language-text\">nodePort: 30088</code> and set the type from <strong>ClusterIP</strong> to <strong>NodePort</strong> to expose the port for us. Saving the file will automatically verify your edit and re-apply the service configuration, if no error was found. You can access the web interface now by typing in your Master Server IP address followed by the port <strong>30088</strong>:</p>\n<hr>\n<p><a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/874ddb502d9af9d33212d10b6b172a6c/08784/kubernetes_logging_08.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 800px;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 89.65517241379311%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAIAAADUsmlHAAAACXBIWXMAAA7EAAAOxAGVKw4bAAACBklEQVQ4y41Uy27TQBT1x0CLHMVJWzk4zwVC/AtSEqQ6zqpdZkulfAcrNgikLNggVjwWbNiwCYjGJY5jezwvjzljR1aoUNOjkXVm7j0+d65nbJzaj22nc9ZymmetJ0+fud50OHpx2nJq1kmtcWLWmyaI1QTBimk1Hz6qPTg2j8260+0bnU5nMBi0222QrkYPcNoatm239rA/QQRRY7Xyl8vlje/HGhEGEB8CSVNCiJEDkisp8ntDKZUkRIs/fPdff/rJheScSSmzAneLkXa9ug6CjfH+269XH39skzRJYiElYgfFFYyiChURmikFGS8ghChLgEm5gpooTUH+ESuVI5czBgFUlLIySRbAImNYoSDYZJpSvFEVLwXRzgjAvGrGfmP2+W6q8phTbFBpsbotrvLKJ4xEpqulgocs5ZmENGakdNbdu9uZiJDwiKAR2patqb8mPpficNlo5IbR3+RPkPqZ4gmPYh5i19pZqcN7lmhhmlBBtny9pTcqV+W3+I/zbZ5lIgoxZJzku15klTiHuDpbJdkVXAHp+hBztt3o7x6FbBtCZexb3fNo5yqrTlj++euX5+OhN/Gm06nruuPR+Orq5WKxmM/nw9HI87zJZOK65wCiE8y9qWbuuRa/e/umbh71+n1cbNxny7IuLi+CIJjNZlaj0ev2cNGdtoOb3inQKwh+AH8BrxOGIN/CLjkAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    ></span>\n    <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px transparent;\"\n        alt=\"A Kubernetes Cluster & Microservices\"\n        title=\"\"\n        src=\"/static/874ddb502d9af9d33212d10b6b172a6c/8ff1e/kubernetes_logging_08.png\"\n        srcset=\"/static/874ddb502d9af9d33212d10b6b172a6c/9ec3c/kubernetes_logging_08.png 200w,\n/static/874ddb502d9af9d33212d10b6b172a6c/c7805/kubernetes_logging_08.png 400w,\n/static/874ddb502d9af9d33212d10b6b172a6c/8ff1e/kubernetes_logging_08.png 800w,\n/static/874ddb502d9af9d33212d10b6b172a6c/08784/kubernetes_logging_08.png 812w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n      />\n  </span>\n  </a></p>\n<hr>\n<p>But we are going to use Grafana as it offers a lot more as a frontend for Prometheus - I am going to revert the changes I made to service file to close the port <strong>30088</strong> again and let’s use it for the Grafana service instead:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">kubectl edit svc kube-prometheus-grafana -n monitoring</code></pre></div>\n<p>And you should now be greeted by the beautiful Grafana user interface:</p>\n<hr>\n<p><a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/178ed54412f939b3f58e5734df1ff176/08784/kubernetes_logging_09.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 800px;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 72.29064039408867%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAIAAACgpqunAAAACXBIWXMAAA7EAAAOxAGVKw4bAAACP0lEQVQoz02S2W7TQBSGc4WEEKJNkwD1Mvbs+4zHjp3FDW2lSqg3BRVuESDxBAiegcfmJCm01qejGUv/Wf4zk2ib1A6u6RhXoek+3X/4eP95NV42y1Xq19pFwuRTMBUQtQ02NpOgaEzddnfVdMPN+9ufv35/+frNhsb4aENysZXGc2WPKBuU9aAc1tvt9eXk9Nkky/LUDVyqt+fFdLY4W7wpK1xhlpd1lqO8qPLySM2Y2BcNjVQaITx5/uLlbL6gVFQVwZgxaEnKFOO6770xknMthBICfjLC8hxxpqyJjMosLycnJ68Wr98Y40Bf15Qy2a43QBpW+8PmwHqzHEftQ5nXmDMSGRb7RBP4oLIDYwiHyoRK3gyQQKQVwP9F2W0wd7XH4h30iGXHEa0exMZ4KFtVlBDWjd3yot8zLvtd3+/2cXU1aGnxHYnfw7i8jlo5fBBPpzOo7H2UUoeQfBO6ofPRdX1rvAmN107HNsBIiGOquJKWElYVB/HJ6ZQLJaWSAoKFNUK0xoFNZYmBoqgh5gXKM0Qoo4xjws6zYi+ezxfWBXAbqDGtEIb5tXZH//8DuRBMS4yVUQrzaBis7miYtF4YSzADCwg8JsKPwC641Ogc4w2lO1ILmhWP4kQoxzUVxkkfa0Tg/BQwkmNF1tT/0Tgx77g4un02mz+4jYjy3g8945prB5kAaIZpx7WlpaR3dPyxvRlvL1aDQeWD29Z47yKl0jqflk07dKlvmy4Badkerp02Dp4kruEtcIJ5UaC/jc+Dct1TWeMAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    ></span>\n    <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px transparent;\"\n        alt=\"A Kubernetes Cluster & Microservices\"\n        title=\"\"\n        src=\"/static/178ed54412f939b3f58e5734df1ff176/8ff1e/kubernetes_logging_09.png\"\n        srcset=\"/static/178ed54412f939b3f58e5734df1ff176/9ec3c/kubernetes_logging_09.png 200w,\n/static/178ed54412f939b3f58e5734df1ff176/c7805/kubernetes_logging_09.png 400w,\n/static/178ed54412f939b3f58e5734df1ff176/8ff1e/kubernetes_logging_09.png 800w,\n/static/178ed54412f939b3f58e5734df1ff176/08784/kubernetes_logging_09.png 812w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n      />\n  </span>\n  </a></p>\n<hr>\n<h2 id=\"the-elk-stack\"><a href=\"#the-elk-stack\" aria-label=\"the elk stack permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>The ELK Stack</h2>\n<p>We build a Kubernetes cluster with a couple of micro services in the previous step and saw that we can get access to Kubernetes logs for each pod by first finding out it’s name and then using the <code class=\"language-text\">logs</code> command:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">kubectl get pods\nkubectl logs webapp-774b78689-l9ftr</code></pre></div>\n<hr>\n<p><a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/8da96ed6f6bb64a3ad11dff3afcbc5cd/8d35d/kubernetes_logging_01.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 800px;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 21.490683229813662%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAIAAAABPYjBAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAu0lEQVQI112O24rCMBQA48KuabW0DSiIq0XT3HNybZr+/5dt2UdhXuZhYNBgl06ns4qdzq3wRwaYuc4sV52KzV7FqCKZAU3y8BTogwHW3tfB1zFsg1sxd9/U/FDTyIh9RW+NHqLR6WsS6Jd/xk8oNGxz2Gioo0qN8JjBkTuis/L1MdvbS1OT78ze36af5N4c9ot/EFHp4lZi8gXKaEsPSw9lHyE6MSgvk2co3K/C111vMmDuWxlaEU4q/AGzMR/fkIEZ7gAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    ></span>\n    <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px transparent;\"\n        alt=\"A Kubernetes Cluster & Microservices\"\n        title=\"\"\n        src=\"/static/8da96ed6f6bb64a3ad11dff3afcbc5cd/8ff1e/kubernetes_logging_01.png\"\n        srcset=\"/static/8da96ed6f6bb64a3ad11dff3afcbc5cd/9ec3c/kubernetes_logging_01.png 200w,\n/static/8da96ed6f6bb64a3ad11dff3afcbc5cd/c7805/kubernetes_logging_01.png 400w,\n/static/8da96ed6f6bb64a3ad11dff3afcbc5cd/8ff1e/kubernetes_logging_01.png 800w,\n/static/8da96ed6f6bb64a3ad11dff3afcbc5cd/8d35d/kubernetes_logging_01.png 805w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n      />\n  </span>\n  </a></p>\n<hr>\n<p>But it is really cumbersome to do when you have a large number of pods running. Also some information might be logged inside the container itself and are ephemeral in nature.</p>\n<p>The most common solution for a distributed logging system is the <a href=\"https://www.elastic.co\">ElasticStack</a> - also called the ELK stack as it is traditionally build on three blocks:</p>\n<ul>\n<li><a href=\"https://hub.docker.com/_/elasticsearch\">Elasticsearch</a></li>\n<li><a href=\"https://hub.docker.com/_/logstash\">Logstash</a></li>\n<li><a href=\"https://hub.docker.com/_/kibana\">Kibana</a></li>\n</ul>\n<p>We are going to switch Logstash with <a href=\"https://www.fluentd.org\">Fluentd</a>. <strong>Fluentd</strong> is an open source data collector, which lets you unify the data collection and consumption for a better use and understanding of data. We are going to use it to connect to our pods, find active logs and collect them and offers a JSON structured downstream that we are going to feed into the Elasticsearch database. FluentD will have to be <strong>installed on every node</strong> inside our cluster - this is done by configuring it as a <a href=\"https://kubernetes.io/docs/concepts/workloads/controllers/daemonset/\">DaemonSet</a> instead of a <em>ReplicaSet</em>.</p>\n<p><strong>Elasticsearch</strong> is a distributed, RESTful search and analytics engine and will be used to store the data collected by FluentD in a NoSQL fashion. The distributed nature of Elasticsearch allows us to easily combine one or more instances of the database into a cluster. It is recommended to have <strong>at least 2 instances</strong> running to ensure fail-over security. The Elasticsearch pod will also be created in a special kind of <em>ReplicaSet</em> called a <a href=\"https://kubernetes.io/docs/concepts/workloads/controllers/statefulset/\">StatefulSet</a>. This ensures that the pods will not be assigned random names, but will always be called by their assigned pod name (<strong>elasticsearch-logging</strong>) followed by an incremental number <code class=\"language-text\">-0</code>, <code class=\"language-text\">-1</code>, etc - this is needed for pods that need to be clustered.</p>\n<p>And last we have the <strong>Kibana</strong> frontend that lets you visualize the Elasticsearch data. So that hopefully we can extract some useful information from it - without having to sift through Gigabytes of hard to read Kubernetes logs. The frontend will only be used when we log in to check our logs. It is therefore sufficient to <strong>only run 1 instance</strong> as it is not a critical infrastructure.</p>\n<h3 id=\"installation\"><a href=\"#installation\" aria-label=\"installation permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Installation</h3>\n<p>We are going to use a ready-2-go image from Kubernetes to <a href=\"https://github.com/kubernetes/kubernetes/tree/master/cluster/addons/fluentd-elasticsearch\">install FluentD, Kibana and Elasticsearch</a>. This repository contains both the YAML config files for Kubernetes as well as the information for build the required images for the three components. We only need to download the YAML files and download them to the directory where you stored the cluster configuration. When you downloaded all 6 files apply all of them to your cluster:</p>\n<hr>\n<p><a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/60e5767b45d938e0db794b0eb22ed8c2/08784/kubernetes_logging_02.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 800px;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 59.60591133004927%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAA7EAAAOxAGVKw4bAAABrElEQVQoz12S2Y7bMAxF9f9/1qe+FZ1J6sRNnMSrFmojtZVOBkExxIG1XVHilcX8GKdJzjJcJqctIlGIFClFJAYp8XCcl1Uq6/3MjTYGLLdgrcDgKPgQI1jHarBBg7POawM8EyJyv9SaS+FEKZedlJ/fImapp1VJiItJypJxSbtkwEltpIaIqbRWSouY502tykyLXDa996UR52EcN1hNXHTYABnpkqVmscE3YtU+s4xZWWZR2ECBaq3tFTnnGJGrIEr1e7S3DJ+miFU5CaQt5Vx4ESPuxXKh7AN7RdS+ZSiFYZdYIxbAEQpQK/UrpQK3W8mnpxTYlvdx/wUvgQ/C9MPa3eg2lnEnXgfTneHUm9PZdCce4nCn2055fGnyOLr+r+0vQn52k0IpfeUb8lFg1brpTTLeQAoBnUPnyQcWvLEA5v4QursobBsQBC668VuC8/aJ84Hhf8OFwORnATu1ekS7SSFP1yW2xWZHz5oTv7YzvI3/M74Iu5pe7KlfwZsdEUglph8/74fh/rvXp2u83nR3Xj6O6+dxO3Tq0Ok/Z3XsGJ4Pl+GN6vrt18c/4Livor4wjbUAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    ></span>\n    <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px transparent;\"\n        alt=\"A Kubernetes Cluster & Microservices\"\n        title=\"\"\n        src=\"/static/60e5767b45d938e0db794b0eb22ed8c2/8ff1e/kubernetes_logging_02.png\"\n        srcset=\"/static/60e5767b45d938e0db794b0eb22ed8c2/9ec3c/kubernetes_logging_02.png 200w,\n/static/60e5767b45d938e0db794b0eb22ed8c2/c7805/kubernetes_logging_02.png 400w,\n/static/60e5767b45d938e0db794b0eb22ed8c2/8ff1e/kubernetes_logging_02.png 800w,\n/static/60e5767b45d938e0db794b0eb22ed8c2/08784/kubernetes_logging_02.png 812w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n      />\n  </span>\n  </a></p>\n<hr>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">kubectl apply -f <span class=\"token keyword\">.</span>\nkubectl get all -n kube-system</code></pre></div>\n<hr>\n<p><a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/482ab228ad18a6f9d35bc4357ad66076/4f1c7/kubernetes_logging_03.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 799px;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 90.2377972465582%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAIAAADUsmlHAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACZklEQVQ4y3VTi26jQAwkIeT9bKL0LqUQyL5hdwkkpOr/f9iNodeHTidZloGdnfHYBBt7X5p6qetV0Sz1dSarqXARt3tVVframMYKJzNd66sQbizcKDPBqwgSSbG1951rd+6+r95QhKkKXlgQ81FehHmxce1MX3EajzgNgvGl/AIDcPCPJ//YV5Sn3I0ZfY4uJeLJtWtTg63DSEiL8u/Mrt0D7NqtvR2b9yf3mEkfXQogwbbz7Vx6aBkzC8zWtnNVQ9dfZuJ865S3UAVk/yHKCQ8tC1XhdNSp3brHQt++wOvyjrbXxQ22DVIVZmZ4VtRzZka52ZQ3Yu7BMV+ZZsK+9bw0zUw4ODxhlgru0BiumKtqZWr0vypqfMIB3D48axTI6J/AULUuGlwJBmBADvF4udDXtWkIbOow0xPu0Bce57Ii8xKJkwRGeyGJpNzLg+Ypt6jh07hzDjD4DF14CfKFribcBugKQ9qR23dw4hHnBqnsQiGGFLqnwks0DBXgJy+AOVRvUE49S4+ZofiAnT8yNfkBVijACSQMwpxptzBkIGESwDAMp3vO/4AdmgU5bdixfj9UD1yG2JX3KbMkNZEh4SXqEHclsr8LPqPzfjrBSPgQOlFhe+EZtwOsPkZNWVPOdPCTmaztpAXMNImsYm4T4U6X4jlVifCn3Lxcyl+ZiZk95cVZVc/Yuc/d+CyYqc/SA5lKn0p3Fv53Zo6JjFl5ykzC7culSIRNuJt0tD9ihjXCnyB81OUJxi79kNkQA8s75YhUjbgL/gXXylvlSkHhlMWvb5UvpUOh4FzMBq98+MoHMSO1P+MPH6R/JAKfSMAAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    ></span>\n    <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px transparent;\"\n        alt=\"A Kubernetes Cluster & Microservices\"\n        title=\"\"\n        src=\"/static/482ab228ad18a6f9d35bc4357ad66076/4f1c7/kubernetes_logging_03.png\"\n        srcset=\"/static/482ab228ad18a6f9d35bc4357ad66076/9ec3c/kubernetes_logging_03.png 200w,\n/static/482ab228ad18a6f9d35bc4357ad66076/c7805/kubernetes_logging_03.png 400w,\n/static/482ab228ad18a6f9d35bc4357ad66076/4f1c7/kubernetes_logging_03.png 799w\"\n        sizes=\"(max-width: 799px) 100vw, 799px\"\n      />\n  </span>\n  </a></p>\n<hr>\n<p><strong>TBC</strong></p>\n<p><a href=\"https://github.com/helm/charts/tree/master/stable/elastic-stack\">https://github.com/helm/charts/tree/master/stable/elastic-stack</a></p>\n<p><a href=\"https://github.com/kiwigrid/helm-charts/tree/master/charts/fluentd-elasticsearch\">https://github.com/kiwigrid/helm-charts/tree/master/charts/fluentd-elasticsearch</a></p>","htmlAst":{"type":"root","children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"a","properties":{"className":["gatsby-resp-image-link"],"href":"/static/65a4bb9682b131df95bd3b6fd0295e2a/8e846/photo-11627898645_5f0761ff9e_o.png","style":"display: block","target":"_blank","rel":["noopener"]},"children":[{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-wrapper"],"style":"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 800px;"},"children":[{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-background-image"],"style":"padding-bottom: 36.66666666666667%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsSAAALEgHS3X78AAABXUlEQVQoz42QT4uBURSHXy9GGEqMIllRyrwrNhpjZcewGTVW/pQNGSQpERsLJdmMlE8wdsp6fIbxHXyOZ957S8NMU7P4nXs6nfOc37nKrd2Oz+cjEokQjUZJJh+o1+s0m02q1SqVSoVarUav16Pf79Nut5lMJhSLL4TDYfx+P06nE0VRUHUpZpMJm82Gx+OR0FTqkVzuiW63y2g0YjabsVwumc/nDIdDxuMx6/WaTqdDqVSiUHjGrs8LoFEAb8xmrFYrLpeLQCCApt2TzWZoNBosFgum06kErlZvbLfv7Pd7WRcXCJfChMVi+QaeHbrdbkKhEPF4jHw+R6v1SiaTYTAYsNls2O12HA4fHI9HXZ+cTifK5bIEnSVPNshgwGg0YtbdOhwOvN476VY0aZpGMBiUy9LpNIlEglgspv91UtYN+uwVUL2AXW77r1RVvQb+1XjeLAZELt6f+S+4ri+0v9qnnE+8bAAAAABJRU5ErkJggg=='); background-size: cover; display: block;"},"children":[]},{"type":"text","value":"\n    "},{"type":"element","tagName":"img","properties":{"className":["gatsby-resp-image-image"],"style":"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px transparent;","alt":"Angkor Wat, Cambodia","title":"","src":"/static/65a4bb9682b131df95bd3b6fd0295e2a/8ff1e/photo-11627898645_5f0761ff9e_o.png","srcSet":["/static/65a4bb9682b131df95bd3b6fd0295e2a/9ec3c/photo-11627898645_5f0761ff9e_o.png 200w","/static/65a4bb9682b131df95bd3b6fd0295e2a/c7805/photo-11627898645_5f0761ff9e_o.png 400w","/static/65a4bb9682b131df95bd3b6fd0295e2a/8ff1e/photo-11627898645_5f0761ff9e_o.png 800w","/static/65a4bb9682b131df95bd3b6fd0295e2a/6ff5e/photo-11627898645_5f0761ff9e_o.png 1200w","/static/65a4bb9682b131df95bd3b6fd0295e2a/8e846/photo-11627898645_5f0761ff9e_o.png 1500w"],"sizes":["(max-width:","800px)","100vw,","800px"]},"children":[]},{"type":"text","value":"\n  "}]},{"type":"text","value":"\n  "}]}]},{"type":"text","value":"\n"},{"type":"comment","value":" TOC "},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"#prometheus-and-grafana"},"children":[{"type":"text","value":"Prometheus and Grafana"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"#helm-installation"},"children":[{"type":"text","value":"Helm Installation"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"#prometheus-installation"},"children":[{"type":"text","value":"Prometheus Installation"}]}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"#the-elk-stack"},"children":[{"type":"text","value":"The ELK Stack"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"#installation"},"children":[{"type":"text","value":"Installation"}]}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"comment","value":" /TOC "},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{"id":"prometheus-and-grafana"},"children":[{"type":"element","tagName":"a","properties":{"href":"#prometheus-and-grafana","ariaLabel":"prometheus and grafana permalink","className":["anchor"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"Prometheus and Grafana"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://prometheus.io"},"children":[{"type":"text","value":"Prometheus"}]},{"type":"text","value":" is an open-source monitoring solution that can be used with the visualization frontend "},{"type":"element","tagName":"a","properties":{"href":"https://grafana.com"},"children":[{"type":"text","value":"Grafana"}]},{"type":"text","value":" to display your clusters health status. To install them we are going to use the "},{"type":"element","tagName":"a","properties":{"href":"https://helm.sh"},"children":[{"type":"text","value":"Helm Package Manager"}]},{"type":"text","value":" for Kubernetes."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{"id":"helm-installation"},"children":[{"type":"element","tagName":"a","properties":{"href":"#helm-installation","ariaLabel":"helm installation permalink","className":["anchor"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"Helm Installation"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Helm helps you manage Kubernetes applications — Helm Charts helps you define, install, and upgrade even the most complex Kubernetes application. Charts are easy to create, version, share, and publish — so start using Helm and stop the copy-and-paste."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"To install Helm, head over to their "},{"type":"element","tagName":"a","properties":{"href":"https://github.com/helm/helm/"},"children":[{"type":"text","value":"Github Page"}]},{"type":"text","value":" and grab the link to the install binaries - in my case the latest version is "},{"type":"element","tagName":"a","properties":{"href":"https://github.com/helm/helm/releases/tag/v2.12.3"},"children":[{"type":"text","value":"Helm v2.12.3"}]},{"type":"text","value":". Use this link to download the binaries to your Centos server:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"bash"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-bash"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-bash"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"wget"}]},{"type":"text","value":" https://storage.googleapis.com/kubernetes-helm/helm-v2.12.3-linux-amd64.tar.gz\n"},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"tar"}]},{"type":"text","value":" zxvf helm-v2.12.3-linux-amd64.tar.gz"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The unzipped folder contains a file called "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"helm"}]},{"type":"text","value":" that needs to be copied to "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"cp helm /usr/local/bin/"}]},{"type":"text","value":". You can type "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"helm"}]},{"type":"text","value":" to verify that it is working:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"hr","properties":{},"children":[]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"a","properties":{"className":["gatsby-resp-image-link"],"href":"/static/518c86f0531fde53b4bcd6ad2113e501/5212a/kubernetes_logging_04.png","style":"display: block","target":"_blank","rel":["noopener"]},"children":[{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-wrapper"],"style":"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 800px;"},"children":[{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-background-image"],"style":"padding-bottom: 12.28287841191067%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAIAAADXZGvcAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAATElEQVQI12Pg1jDg0zHh0TTi0zbm1TbmUNcXVNHVUdFlltdgVNBklFNnwINYlbTZVHTZVXXZVXRYlXVYlLRYFLWAgkAGUIRJQQOPZgAn9gyQepsMKgAAAABJRU5ErkJggg=='); background-size: cover; display: block;"},"children":[]},{"type":"text","value":"\n    "},{"type":"element","tagName":"img","properties":{"className":["gatsby-resp-image-image"],"style":"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px transparent;","alt":"A Kubernetes Cluster & Microservices","title":"","src":"/static/518c86f0531fde53b4bcd6ad2113e501/8ff1e/kubernetes_logging_04.png","srcSet":["/static/518c86f0531fde53b4bcd6ad2113e501/9ec3c/kubernetes_logging_04.png 200w","/static/518c86f0531fde53b4bcd6ad2113e501/c7805/kubernetes_logging_04.png 400w","/static/518c86f0531fde53b4bcd6ad2113e501/8ff1e/kubernetes_logging_04.png 800w","/static/518c86f0531fde53b4bcd6ad2113e501/5212a/kubernetes_logging_04.png 806w"],"sizes":["(max-width:","800px)","100vw,","800px"]},"children":[]},{"type":"text","value":"\n  "}]},{"type":"text","value":"\n  "}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"hr","properties":{},"children":[]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"We can now type "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"helm init"}]},{"type":"text","value":" to add the "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"Tiller Pod"}]},{"type":"text","value":" to our cluster. You can verify that Helm is connected by running "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"helm version"}]},{"type":"text","value":" (it should show your Helm client as well as Kubernetes version) and "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"kubectl get pods -n kube-system"}]},{"type":"text","value":":"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"hr","properties":{},"children":[]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"a","properties":{"className":["gatsby-resp-image-link"],"href":"/static/f4498710f25a7e918a9b344bbeb214d5/dae74/kubernetes_logging_05.png","style":"display: block","target":"_blank","rel":["noopener"]},"children":[{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-wrapper"],"style":"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 800px;"},"children":[{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-background-image"],"style":"padding-bottom: 70.77114427860697%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAIAAACgpqunAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABuUlEQVQoz41Sa2+bQBAEJxiDjeOYpKrUGDCve3BP41fV//+/OgtfospRKo1WHHezs7O7QTaMWzVO8ZxyF3Umb5Vs9fEog4J9g52+ANth3Ntr7u4bcYo7Ex76APgf8qu5QHZvb+/+vubuuZZhJRYVp+uShSWf8YC8t/fc3mZ98Hfm8mqvU8YrXCxbvWzUslXP9fCAnDK35j7lPukNIo4JM0lvV52OGhXVA2iIM/8JjfjsCO9SZlHtBCJv5GktfCo8YiZHHPFzgsXjuNVRq2FqUQnynLtbJqlPq96sOrPuTMZshkJaKjhGnEqImoE+JqAEMvICt+aKUcEhUqyYzXtTY1rcvTcqwDtIIW+nyQtlh50B+pAJtsM03gaJVcJs3Jus04dG1dwVval62whfCgdaQmVTddCPp3TBPGTsCSKdC5ZU4lenC+4qeSrFqWDu56zz0RMOn/CiztgNAHOiEuCk5AtYalU6nDf6gpmHBcez8IslocH+GP+8+d+oam4M+rSV406fo1ouSo6mfEnGYtAkj5IW86N7qgT4IEAQ31gv9PIx+c1TzZjqRngowwwmgVzoJW5pW2fl8l/yX2jmYvDhsGbHAAAAAElFTkSuQmCC'); background-size: cover; display: block;"},"children":[]},{"type":"text","value":"\n    "},{"type":"element","tagName":"img","properties":{"className":["gatsby-resp-image-image"],"style":"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px transparent;","alt":"A Kubernetes Cluster & Microservices","title":"","src":"/static/f4498710f25a7e918a9b344bbeb214d5/8ff1e/kubernetes_logging_05.png","srcSet":["/static/f4498710f25a7e918a9b344bbeb214d5/9ec3c/kubernetes_logging_05.png 200w","/static/f4498710f25a7e918a9b344bbeb214d5/c7805/kubernetes_logging_05.png 400w","/static/f4498710f25a7e918a9b344bbeb214d5/8ff1e/kubernetes_logging_05.png 800w","/static/f4498710f25a7e918a9b344bbeb214d5/dae74/kubernetes_logging_05.png 804w"],"sizes":["(max-width:","800px)","100vw,","800px"]},"children":[]},{"type":"text","value":"\n  "}]},{"type":"text","value":"\n  "}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"hr","properties":{},"children":[]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Before we can install package, first run a "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"helm repo update"}]},{"type":"text","value":" to make sure that you are up to date. And to allow Helm/Tiller to install packages to the default namespace in Kubernetes, we first have to run these three commands ("},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"optional"}]},{"type":"text","value":" - the installation below will create a custom namespace "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"monitoring"}]},{"type":"text","value":" that is not going to cause any issues):"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"bash"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-bash"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-bash"]},"children":[{"type":"text","value":"kubectl create serviceaccount --namespace kube-system tiller\nkubectl create clusterrolebinding tiller-cluster-rule --clusterrole"},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":"cluster-admin --serviceaccount"},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":"kube-system:tiller\nkubectl patch deploy --namespace kube-system tiller-deploy -p "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"'{\"spec\":{\"template\":{\"spec\":{\"serviceAccount\":\"tiller\"}}}}'"}]},{"type":"text","value":" "}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{"id":"prometheus-installation"},"children":[{"type":"element","tagName":"a","properties":{"href":"#prometheus-installation","ariaLabel":"prometheus installation permalink","className":["anchor"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"Prometheus Installation"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"To install Prometheus we are going to use a repository by CoreOS called "},{"type":"element","tagName":"a","properties":{"href":"https://github.com/helm/charts/tree/master/stable/prometheus-operator"},"children":[{"type":"text","value":"Prometheus Operator"}]},{"type":"text","value":" that provides easy monitoring definitions for Kubernetes services and deployment and management of Prometheus instances."}]},{"type":"text","value":"\n"},{"type":"comment","value":"\n__Deprecation Warning__ Check [stable/prometheus-operator](https://github.com/helm/charts/tree/master/stable/prometheus-operator)!\n\nTo install it with Helm we need [those 3 commands](https://github.com/coreos/prometheus-operator/tree/master/helm)\n\n\n```bash\nhelm repo add coreos https://s3-eu-west-1.amazonaws.com/coreos-charts/stable/\nhelm install coreos/prometheus-operator --name prometheus-operator --namespace monitoring\nhelm install coreos/kube-prometheus --name kube-prometheus --namespace monitoring\n```\n\n> If you need to uninstall those packages later, you need to use the __purge__ flag: `helm delete --purge  prometheus-operator` and `helm delete --purge  kube-prometheus`\n"},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"To install the chart with the release name "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"test-release"}]},{"type":"text","value":":"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"bash"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-bash"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-bash"]},"children":[{"type":"text","value":"helm "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"install"}]},{"type":"text","value":" --name test-release stable/prometheus-operator --namespace monitoring"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"helm install coreos/grafana —name my-release —set adminUser=bob"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The command deploys prometheus-operator on the Kubernetes cluster in the default configuration. The "},{"type":"element","tagName":"a","properties":{"href":"https://github.com/helm/charts/tree/master/stable/prometheus-operator#configuration"},"children":[{"type":"text","value":"configuration section"}]},{"type":"text","value":" lists the parameters that can be configured during installation."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The default installation includes Prometheus Operator, Alertmanager, Grafana, and configuration for scraping Kubernetes infrastructure."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"To uninstall/delete the prometheus-operator deployment:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"bash"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-bash"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-bash"]},"children":[{"type":"text","value":"helm delete --purge test-release\nkubectl delete crd prometheuses.monitoring.coreos.com\nkubectl delete crd prometheusrules.monitoring.coreos.com\nkubectl delete crd servicemonitors.monitoring.coreos.com\nkubectl delete crd alertmanagers.monitoring.coreos.com"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"You can verify the successful installation with "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"kubectl get all -n monitoring"}]},{"type":"text","value":":"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"hr","properties":{},"children":[]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"a","properties":{"className":["gatsby-resp-image-link"],"href":"/static/e90e605663e5abdd6b8ef17e282bc0da/8d35d/kubernetes_logging_06.png","style":"display: block","target":"_blank","rel":["noopener"]},"children":[{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-wrapper"],"style":"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 800px;"},"children":[{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-background-image"],"style":"padding-bottom: 83.22981366459628%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAIAAABSJhvpAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACJUlEQVQ4y02T2ZLaQAxFDcaYfRkmbwkB463dbi8wZib5/w/LkdrUpEqlasu60tUW7KrHsmgXWeMlzppVYsvUVZkrb9akrjN9UbbzxM7Ten6ro8QG52KUt+b51n6e2s9j8zwg9bCvP5YESh2A+Fbz2NmPg3tGNzv9Xe7sAz2Cj2449X9+3P++91+n7ssHWpXdBI9feZhUUVpvq8fBDeHFYBHw5QUm6t4NmDZVv7WPfT2sy25OEvUAEKduY+6b6j5LLBG3PK5V8DMjUIBreK1wQk8vBplI1JzPeerQi7wJr4ZAq0KCEmKZtzOFBFtzhyQ/NqaPMzdVbggP8aZJqaNaiZK1k3PJW6nVWILdCG4xLYp2qRJeKmJjobd8EgXCi7xFR7cai09A5h4k3FSPM4MbgXGaJSR0nhE+gPmFw9gwGrAue5KjSeXrkT5Du+yhB0bBJbEAYxEiHrzGO7GQ8XqqE0LEj2rFaMVyLqifvzCi/xM/6r2VDSMbDMH7Bx6zq43zRknSsHoUTQCYRYRmwAIBlu25vMCK9ONB+2zT/2aJnczyYMPYDeZE8V7WpiebX+Nl3hE3kv4ZaBOXhfleTz2MbpE7bYy0Gpj80LIpgQwUDynahibN6OBrZm8PzTAehntyGEe5ludGiGhHEooy0lRljj3UiQQyIaOjMuPAGDjhZUN0jcjPYmmd4yVCUDoCmBuUmrVacsp5VHfuJNIJM1LY+lF9y+vzHyn0dStizgn6AAAAAElFTkSuQmCC'); background-size: cover; display: block;"},"children":[]},{"type":"text","value":"\n    "},{"type":"element","tagName":"img","properties":{"className":["gatsby-resp-image-image"],"style":"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px transparent;","alt":"A Kubernetes Cluster & Microservices","title":"","src":"/static/e90e605663e5abdd6b8ef17e282bc0da/8ff1e/kubernetes_logging_06.png","srcSet":["/static/e90e605663e5abdd6b8ef17e282bc0da/9ec3c/kubernetes_logging_06.png 200w","/static/e90e605663e5abdd6b8ef17e282bc0da/c7805/kubernetes_logging_06.png 400w","/static/e90e605663e5abdd6b8ef17e282bc0da/8ff1e/kubernetes_logging_06.png 800w","/static/e90e605663e5abdd6b8ef17e282bc0da/8d35d/kubernetes_logging_06.png 805w"],"sizes":["(max-width:","800px)","100vw,","800px"]},"children":[]},{"type":"text","value":"\n  "}]},{"type":"text","value":"\n  "}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"hr","properties":{},"children":[]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"We can also verify that the Prometheus web interface is working - but as you can see above, the service "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"kube-prometheus"}]},{"type":"text","value":" only has an internal port set ("},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"ClusterIP"}]},{"type":"text","value":"). We can edit this default configuration with:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"bash"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-bash"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-bash"]},"children":[{"type":"text","value":"kubectl edit svc kube-prometheus -n monitoring"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"This, by default will open the service configuration in Vim - you can install "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"Nano"}]},{"type":"text","value":" and run "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"export EDITOR=nano"}]},{"type":"text","value":" to prevent that from happening to you."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"hr","properties":{},"children":[]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"a","properties":{"className":["gatsby-resp-image-link"],"href":"/static/df9b7950539e3077e19d5e08df21958c/5212a/kubernetes_logging_07.png","style":"display: block","target":"_blank","rel":["noopener"]},"children":[{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-wrapper"],"style":"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 800px;"},"children":[{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-background-image"],"style":"padding-bottom: 63.89578163771712%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABRklEQVQoz5WRCU/CQBCFt+UqclqPYJCjpe3eW7YCjTExcl/6//+OsxBNFGok+bLpMW/nvRnkvczIbEvnW7F8lysDPAN4uiazDZx4uoFXtf7gix1f7Nlix+a78G0VvC5RKVRXRDtRXIqUOUMF5H0G2H1q9Yjt0ZzHcn2KHkPUiVA7QC0fPRyoi1GdJaVAIKjrEesA6uJTrK+/36AK0a5Kyxh6yrzPCz4vDkQxEFYPn73iB+CnqSZNOW6IkRMqEKNuZvNTMXOHKYiv1QT00NME+0WWuIyHt/oZlG6cNsQYnOcHxnzOzIwfg9hZRiBtjT9VaVJjCXSuUF1lSZVqo/TYceyZKWAxUA3TsvvE7AY+/d82CO7i9EaOy4H8q+4sRY/5cdphusX0cdUXiJ1A3scpNIfMTqQKA36B2CVDT47aOK6YDUcXOf8ErqdXkaxNqeoAAAAASUVORK5CYII='); background-size: cover; display: block;"},"children":[]},{"type":"text","value":"\n    "},{"type":"element","tagName":"img","properties":{"className":["gatsby-resp-image-image"],"style":"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px transparent;","alt":"A Kubernetes Cluster & Microservices","title":"","src":"/static/df9b7950539e3077e19d5e08df21958c/8ff1e/kubernetes_logging_07.png","srcSet":["/static/df9b7950539e3077e19d5e08df21958c/9ec3c/kubernetes_logging_07.png 200w","/static/df9b7950539e3077e19d5e08df21958c/c7805/kubernetes_logging_07.png 400w","/static/df9b7950539e3077e19d5e08df21958c/8ff1e/kubernetes_logging_07.png 800w","/static/df9b7950539e3077e19d5e08df21958c/5212a/kubernetes_logging_07.png 806w"],"sizes":["(max-width:","800px)","100vw,","800px"]},"children":[]},{"type":"text","value":"\n  "}]},{"type":"text","value":"\n  "}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"hr","properties":{},"children":[]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"We added a "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"nodePort: 30088"}]},{"type":"text","value":" and set the type from "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"ClusterIP"}]},{"type":"text","value":" to "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"NodePort"}]},{"type":"text","value":" to expose the port for us. Saving the file will automatically verify your edit and re-apply the service configuration, if no error was found. You can access the web interface now by typing in your Master Server IP address followed by the port "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"30088"}]},{"type":"text","value":":"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"hr","properties":{},"children":[]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"a","properties":{"className":["gatsby-resp-image-link"],"href":"/static/874ddb502d9af9d33212d10b6b172a6c/08784/kubernetes_logging_08.png","style":"display: block","target":"_blank","rel":["noopener"]},"children":[{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-wrapper"],"style":"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 800px;"},"children":[{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-background-image"],"style":"padding-bottom: 89.65517241379311%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAIAAADUsmlHAAAACXBIWXMAAA7EAAAOxAGVKw4bAAACBklEQVQ4y41Uy27TQBT1x0CLHMVJWzk4zwVC/AtSEqQ6zqpdZkulfAcrNgikLNggVjwWbNiwCYjGJY5jezwvjzljR1aoUNOjkXVm7j0+d65nbJzaj22nc9ZymmetJ0+fud50OHpx2nJq1kmtcWLWmyaI1QTBimk1Hz6qPTg2j8260+0bnU5nMBi0222QrkYPcNoatm239rA/QQRRY7Xyl8vlje/HGhEGEB8CSVNCiJEDkisp8ntDKZUkRIs/fPdff/rJheScSSmzAneLkXa9ug6CjfH+269XH39skzRJYiElYgfFFYyiChURmikFGS8ghChLgEm5gpooTUH+ESuVI5czBgFUlLIySRbAImNYoSDYZJpSvFEVLwXRzgjAvGrGfmP2+W6q8phTbFBpsbotrvLKJ4xEpqulgocs5ZmENGakdNbdu9uZiJDwiKAR2patqb8mPpficNlo5IbR3+RPkPqZ4gmPYh5i19pZqcN7lmhhmlBBtny9pTcqV+W3+I/zbZ5lIgoxZJzku15klTiHuDpbJdkVXAHp+hBztt3o7x6FbBtCZexb3fNo5yqrTlj++euX5+OhN/Gm06nruuPR+Orq5WKxmM/nw9HI87zJZOK65wCiE8y9qWbuuRa/e/umbh71+n1cbNxny7IuLi+CIJjNZlaj0ev2cNGdtoOb3inQKwh+AH8BrxOGIN/CLjkAAAAASUVORK5CYII='); background-size: cover; display: block;"},"children":[]},{"type":"text","value":"\n    "},{"type":"element","tagName":"img","properties":{"className":["gatsby-resp-image-image"],"style":"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px transparent;","alt":"A Kubernetes Cluster & Microservices","title":"","src":"/static/874ddb502d9af9d33212d10b6b172a6c/8ff1e/kubernetes_logging_08.png","srcSet":["/static/874ddb502d9af9d33212d10b6b172a6c/9ec3c/kubernetes_logging_08.png 200w","/static/874ddb502d9af9d33212d10b6b172a6c/c7805/kubernetes_logging_08.png 400w","/static/874ddb502d9af9d33212d10b6b172a6c/8ff1e/kubernetes_logging_08.png 800w","/static/874ddb502d9af9d33212d10b6b172a6c/08784/kubernetes_logging_08.png 812w"],"sizes":["(max-width:","800px)","100vw,","800px"]},"children":[]},{"type":"text","value":"\n  "}]},{"type":"text","value":"\n  "}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"hr","properties":{},"children":[]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"But we are going to use Grafana as it offers a lot more as a frontend for Prometheus - I am going to revert the changes I made to service file to close the port "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"30088"}]},{"type":"text","value":" again and let’s use it for the Grafana service instead:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"bash"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-bash"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-bash"]},"children":[{"type":"text","value":"kubectl edit svc kube-prometheus-grafana -n monitoring"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"And you should now be greeted by the beautiful Grafana user interface:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"hr","properties":{},"children":[]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"a","properties":{"className":["gatsby-resp-image-link"],"href":"/static/178ed54412f939b3f58e5734df1ff176/08784/kubernetes_logging_09.png","style":"display: block","target":"_blank","rel":["noopener"]},"children":[{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-wrapper"],"style":"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 800px;"},"children":[{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-background-image"],"style":"padding-bottom: 72.29064039408867%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAIAAACgpqunAAAACXBIWXMAAA7EAAAOxAGVKw4bAAACP0lEQVQoz02S2W7TQBSGc4WEEKJNkwD1Mvbs+4zHjp3FDW2lSqg3BRVuESDxBAiegcfmJCm01qejGUv/Wf4zk2ib1A6u6RhXoek+3X/4eP95NV42y1Xq19pFwuRTMBUQtQ02NpOgaEzddnfVdMPN+9ufv35/+frNhsb4aENysZXGc2WPKBuU9aAc1tvt9eXk9Nkky/LUDVyqt+fFdLY4W7wpK1xhlpd1lqO8qPLySM2Y2BcNjVQaITx5/uLlbL6gVFQVwZgxaEnKFOO6770xknMthBICfjLC8hxxpqyJjMosLycnJ68Wr98Y40Bf15Qy2a43QBpW+8PmwHqzHEftQ5nXmDMSGRb7RBP4oLIDYwiHyoRK3gyQQKQVwP9F2W0wd7XH4h30iGXHEa0exMZ4KFtVlBDWjd3yot8zLvtd3+/2cXU1aGnxHYnfw7i8jlo5fBBPpzOo7H2UUoeQfBO6ofPRdX1rvAmN107HNsBIiGOquJKWElYVB/HJ6ZQLJaWSAoKFNUK0xoFNZYmBoqgh5gXKM0Qoo4xjws6zYi+ezxfWBXAbqDGtEIb5tXZH//8DuRBMS4yVUQrzaBis7miYtF4YSzADCwg8JsKPwC641Ogc4w2lO1ILmhWP4kQoxzUVxkkfa0Tg/BQwkmNF1tT/0Tgx77g4un02mz+4jYjy3g8945prB5kAaIZpx7WlpaR3dPyxvRlvL1aDQeWD29Z47yKl0jqflk07dKlvmy4Badkerp02Dp4kruEtcIJ5UaC/jc+Dct1TWeMAAAAASUVORK5CYII='); background-size: cover; display: block;"},"children":[]},{"type":"text","value":"\n    "},{"type":"element","tagName":"img","properties":{"className":["gatsby-resp-image-image"],"style":"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px transparent;","alt":"A Kubernetes Cluster & Microservices","title":"","src":"/static/178ed54412f939b3f58e5734df1ff176/8ff1e/kubernetes_logging_09.png","srcSet":["/static/178ed54412f939b3f58e5734df1ff176/9ec3c/kubernetes_logging_09.png 200w","/static/178ed54412f939b3f58e5734df1ff176/c7805/kubernetes_logging_09.png 400w","/static/178ed54412f939b3f58e5734df1ff176/8ff1e/kubernetes_logging_09.png 800w","/static/178ed54412f939b3f58e5734df1ff176/08784/kubernetes_logging_09.png 812w"],"sizes":["(max-width:","800px)","100vw,","800px"]},"children":[]},{"type":"text","value":"\n  "}]},{"type":"text","value":"\n  "}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"hr","properties":{},"children":[]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{"id":"the-elk-stack"},"children":[{"type":"element","tagName":"a","properties":{"href":"#the-elk-stack","ariaLabel":"the elk stack permalink","className":["anchor"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"The ELK Stack"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"We build a Kubernetes cluster with a couple of micro services in the previous step and saw that we can get access to Kubernetes logs for each pod by first finding out it’s name and then using the "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"logs"}]},{"type":"text","value":" command:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"bash"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-bash"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-bash"]},"children":[{"type":"text","value":"kubectl get pods\nkubectl logs webapp-774b78689-l9ftr"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"hr","properties":{},"children":[]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"a","properties":{"className":["gatsby-resp-image-link"],"href":"/static/8da96ed6f6bb64a3ad11dff3afcbc5cd/8d35d/kubernetes_logging_01.png","style":"display: block","target":"_blank","rel":["noopener"]},"children":[{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-wrapper"],"style":"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 800px;"},"children":[{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-background-image"],"style":"padding-bottom: 21.490683229813662%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAIAAAABPYjBAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAu0lEQVQI112O24rCMBQA48KuabW0DSiIq0XT3HNybZr+/5dt2UdhXuZhYNBgl06ns4qdzq3wRwaYuc4sV52KzV7FqCKZAU3y8BTogwHW3tfB1zFsg1sxd9/U/FDTyIh9RW+NHqLR6WsS6Jd/xk8oNGxz2Gioo0qN8JjBkTuis/L1MdvbS1OT78ze36af5N4c9ot/EFHp4lZi8gXKaEsPSw9lHyE6MSgvk2co3K/C111vMmDuWxlaEU4q/AGzMR/fkIEZ7gAAAABJRU5ErkJggg=='); background-size: cover; display: block;"},"children":[]},{"type":"text","value":"\n    "},{"type":"element","tagName":"img","properties":{"className":["gatsby-resp-image-image"],"style":"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px transparent;","alt":"A Kubernetes Cluster & Microservices","title":"","src":"/static/8da96ed6f6bb64a3ad11dff3afcbc5cd/8ff1e/kubernetes_logging_01.png","srcSet":["/static/8da96ed6f6bb64a3ad11dff3afcbc5cd/9ec3c/kubernetes_logging_01.png 200w","/static/8da96ed6f6bb64a3ad11dff3afcbc5cd/c7805/kubernetes_logging_01.png 400w","/static/8da96ed6f6bb64a3ad11dff3afcbc5cd/8ff1e/kubernetes_logging_01.png 800w","/static/8da96ed6f6bb64a3ad11dff3afcbc5cd/8d35d/kubernetes_logging_01.png 805w"],"sizes":["(max-width:","800px)","100vw,","800px"]},"children":[]},{"type":"text","value":"\n  "}]},{"type":"text","value":"\n  "}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"hr","properties":{},"children":[]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"But it is really cumbersome to do when you have a large number of pods running. Also some information might be logged inside the container itself and are ephemeral in nature."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The most common solution for a distributed logging system is the "},{"type":"element","tagName":"a","properties":{"href":"https://www.elastic.co"},"children":[{"type":"text","value":"ElasticStack"}]},{"type":"text","value":" - also called the ELK stack as it is traditionally build on three blocks:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://hub.docker.com/_/elasticsearch"},"children":[{"type":"text","value":"Elasticsearch"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://hub.docker.com/_/logstash"},"children":[{"type":"text","value":"Logstash"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://hub.docker.com/_/kibana"},"children":[{"type":"text","value":"Kibana"}]}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"We are going to switch Logstash with "},{"type":"element","tagName":"a","properties":{"href":"https://www.fluentd.org"},"children":[{"type":"text","value":"Fluentd"}]},{"type":"text","value":". "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"Fluentd"}]},{"type":"text","value":" is an open source data collector, which lets you unify the data collection and consumption for a better use and understanding of data. We are going to use it to connect to our pods, find active logs and collect them and offers a JSON structured downstream that we are going to feed into the Elasticsearch database. FluentD will have to be "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"installed on every node"}]},{"type":"text","value":" inside our cluster - this is done by configuring it as a "},{"type":"element","tagName":"a","properties":{"href":"https://kubernetes.io/docs/concepts/workloads/controllers/daemonset/"},"children":[{"type":"text","value":"DaemonSet"}]},{"type":"text","value":" instead of a "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"ReplicaSet"}]},{"type":"text","value":"."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"Elasticsearch"}]},{"type":"text","value":" is a distributed, RESTful search and analytics engine and will be used to store the data collected by FluentD in a NoSQL fashion. The distributed nature of Elasticsearch allows us to easily combine one or more instances of the database into a cluster. It is recommended to have "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"at least 2 instances"}]},{"type":"text","value":" running to ensure fail-over security. The Elasticsearch pod will also be created in a special kind of "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"ReplicaSet"}]},{"type":"text","value":" called a "},{"type":"element","tagName":"a","properties":{"href":"https://kubernetes.io/docs/concepts/workloads/controllers/statefulset/"},"children":[{"type":"text","value":"StatefulSet"}]},{"type":"text","value":". This ensures that the pods will not be assigned random names, but will always be called by their assigned pod name ("},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"elasticsearch-logging"}]},{"type":"text","value":") followed by an incremental number "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"-0"}]},{"type":"text","value":", "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"-1"}]},{"type":"text","value":", etc - this is needed for pods that need to be clustered."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"And last we have the "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"Kibana"}]},{"type":"text","value":" frontend that lets you visualize the Elasticsearch data. So that hopefully we can extract some useful information from it - without having to sift through Gigabytes of hard to read Kubernetes logs. The frontend will only be used when we log in to check our logs. It is therefore sufficient to "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"only run 1 instance"}]},{"type":"text","value":" as it is not a critical infrastructure."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{"id":"installation"},"children":[{"type":"element","tagName":"a","properties":{"href":"#installation","ariaLabel":"installation permalink","className":["anchor"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"Installation"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"We are going to use a ready-2-go image from Kubernetes to "},{"type":"element","tagName":"a","properties":{"href":"https://github.com/kubernetes/kubernetes/tree/master/cluster/addons/fluentd-elasticsearch"},"children":[{"type":"text","value":"install FluentD, Kibana and Elasticsearch"}]},{"type":"text","value":". This repository contains both the YAML config files for Kubernetes as well as the information for build the required images for the three components. We only need to download the YAML files and download them to the directory where you stored the cluster configuration. When you downloaded all 6 files apply all of them to your cluster:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"hr","properties":{},"children":[]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"a","properties":{"className":["gatsby-resp-image-link"],"href":"/static/60e5767b45d938e0db794b0eb22ed8c2/08784/kubernetes_logging_02.png","style":"display: block","target":"_blank","rel":["noopener"]},"children":[{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-wrapper"],"style":"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 800px;"},"children":[{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-background-image"],"style":"padding-bottom: 59.60591133004927%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAA7EAAAOxAGVKw4bAAABrElEQVQoz12S2Y7bMAxF9f9/1qe+FZ1J6sRNnMSrFmojtZVOBkExxIG1XVHilcX8GKdJzjJcJqctIlGIFClFJAYp8XCcl1Uq6/3MjTYGLLdgrcDgKPgQI1jHarBBg7POawM8EyJyv9SaS+FEKZedlJ/fImapp1VJiItJypJxSbtkwEltpIaIqbRWSouY502tykyLXDa996UR52EcN1hNXHTYABnpkqVmscE3YtU+s4xZWWZR2ECBaq3tFTnnGJGrIEr1e7S3DJ+miFU5CaQt5Vx4ESPuxXKh7AN7RdS+ZSiFYZdYIxbAEQpQK/UrpQK3W8mnpxTYlvdx/wUvgQ/C9MPa3eg2lnEnXgfTneHUm9PZdCce4nCn2055fGnyOLr+r+0vQn52k0IpfeUb8lFg1brpTTLeQAoBnUPnyQcWvLEA5v4QursobBsQBC668VuC8/aJ84Hhf8OFwORnATu1ekS7SSFP1yW2xWZHz5oTv7YzvI3/M74Iu5pe7KlfwZsdEUglph8/74fh/rvXp2u83nR3Xj6O6+dxO3Tq0Ok/Z3XsGJ4Pl+GN6vrt18c/4Livor4wjbUAAAAASUVORK5CYII='); background-size: cover; display: block;"},"children":[]},{"type":"text","value":"\n    "},{"type":"element","tagName":"img","properties":{"className":["gatsby-resp-image-image"],"style":"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px transparent;","alt":"A Kubernetes Cluster & Microservices","title":"","src":"/static/60e5767b45d938e0db794b0eb22ed8c2/8ff1e/kubernetes_logging_02.png","srcSet":["/static/60e5767b45d938e0db794b0eb22ed8c2/9ec3c/kubernetes_logging_02.png 200w","/static/60e5767b45d938e0db794b0eb22ed8c2/c7805/kubernetes_logging_02.png 400w","/static/60e5767b45d938e0db794b0eb22ed8c2/8ff1e/kubernetes_logging_02.png 800w","/static/60e5767b45d938e0db794b0eb22ed8c2/08784/kubernetes_logging_02.png 812w"],"sizes":["(max-width:","800px)","100vw,","800px"]},"children":[]},{"type":"text","value":"\n  "}]},{"type":"text","value":"\n  "}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"hr","properties":{},"children":[]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"bash"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-bash"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-bash"]},"children":[{"type":"text","value":"kubectl apply -f "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"."}]},{"type":"text","value":"\nkubectl get all -n kube-system"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"hr","properties":{},"children":[]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"a","properties":{"className":["gatsby-resp-image-link"],"href":"/static/482ab228ad18a6f9d35bc4357ad66076/4f1c7/kubernetes_logging_03.png","style":"display: block","target":"_blank","rel":["noopener"]},"children":[{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-wrapper"],"style":"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 799px;"},"children":[{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-background-image"],"style":"padding-bottom: 90.2377972465582%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAIAAADUsmlHAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACZklEQVQ4y3VTi26jQAwkIeT9bKL0LqUQyL5hdwkkpOr/f9iNodeHTidZloGdnfHYBBt7X5p6qetV0Sz1dSarqXARt3tVVframMYKJzNd66sQbizcKDPBqwgSSbG1951rd+6+r95QhKkKXlgQ81FehHmxce1MX3EajzgNgvGl/AIDcPCPJ//YV5Sn3I0ZfY4uJeLJtWtTg63DSEiL8u/Mrt0D7NqtvR2b9yf3mEkfXQogwbbz7Vx6aBkzC8zWtnNVQ9dfZuJ865S3UAVk/yHKCQ8tC1XhdNSp3brHQt++wOvyjrbXxQ22DVIVZmZ4VtRzZka52ZQ3Yu7BMV+ZZsK+9bw0zUw4ODxhlgru0BiumKtqZWr0vypqfMIB3D48axTI6J/AULUuGlwJBmBADvF4udDXtWkIbOow0xPu0Bce57Ii8xKJkwRGeyGJpNzLg+Ypt6jh07hzDjD4DF14CfKFribcBugKQ9qR23dw4hHnBqnsQiGGFLqnwks0DBXgJy+AOVRvUE49S4+ZofiAnT8yNfkBVijACSQMwpxptzBkIGESwDAMp3vO/4AdmgU5bdixfj9UD1yG2JX3KbMkNZEh4SXqEHclsr8LPqPzfjrBSPgQOlFhe+EZtwOsPkZNWVPOdPCTmaztpAXMNImsYm4T4U6X4jlVifCn3Lxcyl+ZiZk95cVZVc/Yuc/d+CyYqc/SA5lKn0p3Fv53Zo6JjFl5ykzC7culSIRNuJt0tD9ihjXCnyB81OUJxi79kNkQA8s75YhUjbgL/gXXylvlSkHhlMWvb5UvpUOh4FzMBq98+MoHMSO1P+MPH6R/JAKfSMAAAAAASUVORK5CYII='); background-size: cover; display: block;"},"children":[]},{"type":"text","value":"\n    "},{"type":"element","tagName":"img","properties":{"className":["gatsby-resp-image-image"],"style":"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px transparent;","alt":"A Kubernetes Cluster & Microservices","title":"","src":"/static/482ab228ad18a6f9d35bc4357ad66076/4f1c7/kubernetes_logging_03.png","srcSet":["/static/482ab228ad18a6f9d35bc4357ad66076/9ec3c/kubernetes_logging_03.png 200w","/static/482ab228ad18a6f9d35bc4357ad66076/c7805/kubernetes_logging_03.png 400w","/static/482ab228ad18a6f9d35bc4357ad66076/4f1c7/kubernetes_logging_03.png 799w"],"sizes":["(max-width:","799px)","100vw,","799px"]},"children":[]},{"type":"text","value":"\n  "}]},{"type":"text","value":"\n  "}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"hr","properties":{},"children":[]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"TBC"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://github.com/helm/charts/tree/master/stable/elastic-stack"},"children":[{"type":"text","value":"https://github.com/helm/charts/tree/master/stable/elastic-stack"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://github.com/kiwigrid/helm-charts/tree/master/charts/fluentd-elasticsearch"},"children":[{"type":"text","value":"https://github.com/kiwigrid/helm-charts/tree/master/charts/fluentd-elasticsearch"}]}]}],"data":{"quirksMode":false}},"fields":{"slug":"/kubernetes-cluster-logging/","prefix":"2019-01-19"},"frontmatter":{"title":"Kubernetes Cluster Monitoring & Logging","subTitle":"Red Hat Enterprise and Centos Linux Server Administration","cover":{"childImageSharp":{"resize":{"src":"/static/b08a03ff59506d39e6926bd5a55494a9/fbe2f/photo-11627898645_5f0761ff9e_o-cover.png"}}}}},"author":{"id":"9c69de06-11ab-55c9-b52a-3cc0b2f51365","html":"<p><strong>Mike Polinowski</strong> Proin ornare ligula eu tellus tempus elementum. Aenean <a href=\"/contact/\">contact me</a> iaculis mi, nec blandit lacus interdum vitae. Vestibulum non nibh risus, a scelerisque purus. :hearts:</p>"},"footnote":{"id":"24817670-3434-5a21-9de1-e9fab89708d7","html":"<ul>\n<li>This is a personal Developer Blog</li>\n<li>Ξ</li>\n<li>built by <a href=\"https://github.com/mpolinowski\">Mike Polinowski</a></li>\n<li>Ξ</li>\n<li>with <a href=\"https://www.gatsbyjs.org/\">Gatsby</a> &#x26; <a href=\"https://reactjs.org\">React</a></li>\n<li>Ξ</li>\n<li>source code on <a href=\"https://github.com/mpolinowski/mpolinowski.github.io\">GitHub</a></li>\n<li>Ξ</li>\n<li>deliverd by <a href=\"https://pages.github.com\">Github Pages</a></li>\n<li>Ξ</li>\n<li>photos from <a href=\"https://www.flickr.com/people/149680084@N06/\">Flickr</a></li>\n</ul>"}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/kubernetes-cluster-logging/"}}