{"data":{"post":{"id":"1668d15a-cc06-5da5-814f-cb65457bc71d","html":"<p><a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/cc2560d4e1994db8591f8774de873b60/e4f7a/photo-19196703263_69f9f0df5f_o.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 800px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 49.66666666666666%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAC4jAAAuIwF4pT92AAACV0lEQVQozw2NW0/aYABA+2f24sPmlmWXRLNlhrgHt2imM3MblKG9fu0H9EZbQLEVNUqm2wA1Q8EpoMwr0Oq8RrEgChij/2ck5+E8nOQgPxKZaHItllqfX84tpjdWclvZ7fyOYR6e/CuVT68bF/f3l9WbavbIihatGaM6XqjphRvdvNX37pBwNDkRS03EliMLK/FkZimzntnc2jUKhyemVTmuXJ0dWCWjZJnWpVGuGuXrQrmWrzQO6rfHN3eIPpuY/LUYiS9Nx5NT8dTPxOpiJvfn7/bunrl/enRinZ9fWseV8mGlWqpVy/WrSqN2Uatf1BtntQYyGok1mZydG5+d12YWJqO/p6JzseWVRDabyuUy2xs75s6mWUwXjNW8sW6Ya0UznTezxn66uI84KOBiIEoClKQcOI4SBIoPuShskMZwhiQhjbMUxlIEBDhsNriTIpw0hZKEnSAQJwB2gv7mlpwMNwhYysvhELI85xE5r4+HgptTJK8i0TwHBI7weEjOC0TBLctuVUVsvV86+1HbJ6zrK4kCjuQkVpTEQEAaDvq10HBYV0Ijqqbxo+PuoC6OTQnhiFub9o5Ny9/nEUwI9A6yb/vRbhR8bEqfo8eOD2CMnWRdNAt4EQqib2RECOmUOkqpGu3XSH+Y8I8RgQkEBd7WdtuTV7b2rt7ntveP2mxPO7owj0zzvgEXPgQgFCVF05tnVg0yAi8FFVULQTnAKCEEyv6WZ21v3nW3tnU8ePyy5cXrh+2dH5ykquucogwx7j6Hq+ez3U4yOOcjeBEIEpQk6JNZSf4PpY46MAAAeQ8AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    ></span>\n    <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px transparent;\"\n        alt=\"Abashiri, Japan\"\n        title=\"\"\n        src=\"/static/cc2560d4e1994db8591f8774de873b60/5f213/photo-19196703263_69f9f0df5f_o.png\"\n        srcset=\"/static/cc2560d4e1994db8591f8774de873b60/793cf/photo-19196703263_69f9f0df5f_o.png 200w,\n/static/cc2560d4e1994db8591f8774de873b60/767c8/photo-19196703263_69f9f0df5f_o.png 400w,\n/static/cc2560d4e1994db8591f8774de873b60/5f213/photo-19196703263_69f9f0df5f_o.png 800w,\n/static/cc2560d4e1994db8591f8774de873b60/c5dd2/photo-19196703263_69f9f0df5f_o.png 1200w,\n/static/cc2560d4e1994db8591f8774de873b60/e4f7a/photo-19196703263_69f9f0df5f_o.png 1500w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n      />\n  </span>\n  </a></p>\n<!-- TOC -->\n<ul>\n<li><a href=\"#changing-your-ssh-login\">Changing your SSH login</a></li>\n<li><a href=\"#running-firewalld\">Running FirewallD</a></li>\n<li><a href=\"#changing-the-ssh-port\">Changing the SSH Port</a></li>\n<li><a href=\"#changing-the-hostname\">Changing the Hostname</a></li>\n<li><a href=\"#kernel-update-troubleshooting\">Kernel Update Troubleshooting</a></li>\n<li>\n<p><a href=\"#working-with-ip-tables\">Working with IP tables</a></p>\n<ul>\n<li><a href=\"#how-do-i-view-blocked-ports-rules\">How do I view blocked ports rules?</a></li>\n</ul>\n</li>\n</ul>\n<!-- /TOC -->\n<h2 id=\"changing-your-ssh-login\"><a href=\"#changing-your-ssh-login\" aria-label=\"changing your ssh login permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Changing your SSH login</h2>\n<p>SSH uses your linux user password. Simply use the passwd command after logging in. It will prompt you to change it. Or name a different user to change theirs:</p>\n<div class=\"gatsby-highlight\" data-language=\"ssh\"><pre class=\"language-ssh\"><code class=\"language-ssh\">passwd\npasswd user1</code></pre></div>\n<h2 id=\"running-firewalld\"><a href=\"#running-firewalld\" aria-label=\"running firewalld permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Running FirewallD</h2>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">yum <span class=\"token function\">install</span> -y firewalld\nsystemctl <span class=\"token function\">enable</span> firewalld\nsystemctl start firewalld\nsystemctl status firewalld\nfirewall-cmd --permanent --zone<span class=\"token operator\">=</span>public --add-service<span class=\"token operator\">=</span>http\nfirewall-cmd --permanent --zone<span class=\"token operator\">=</span>public --add-port<span class=\"token operator\">=</span>1880/tcp\nfirewall-cmd --reload\nfirewall-cmd --list-all</code></pre></div>\n<h2 id=\"changing-the-ssh-port\"><a href=\"#changing-the-ssh-port\" aria-label=\"changing the ssh port permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Changing the SSH Port</h2>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">firewall-cmd --permanent --zone<span class=\"token operator\">=</span>public --add-port<span class=\"token operator\">=</span>4444/tcp\nfirewall-cmd --reload\nsemanage port -a -t ssh_port_t -p tcp 4444\n<span class=\"token function\">nano</span> /etc/ssh/sshd_config</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token comment\"># If you want to change the port on a SELinux system, you have to tell</span>\n<span class=\"token comment\"># SELinux about this change.</span>\n<span class=\"token comment\"># semanage port -a -t ssh_port_t -p tcp #PORTNUMBER</span>\n<span class=\"token comment\">#</span>\nPort 4444\n<span class=\"token comment\">#AddressFamily any</span>\n<span class=\"token comment\">#ListenAddress 0.0.0.0</span>\n<span class=\"token comment\">#ListenAddress ::</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">service</span> sshd restart</code></pre></div>\n<h2 id=\"changing-the-hostname\"><a href=\"#changing-the-hostname\" aria-label=\"changing the hostname permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Changing the Hostname</h2>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">hostnamectl set-hostname your-new-hostname\nhostnamectl\nsystemctl <span class=\"token function\">reboot</span></code></pre></div>\n<h2 id=\"kernel-update-troubleshooting\"><a href=\"#kernel-update-troubleshooting\" aria-label=\"kernel update troubleshooting permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Kernel Update Troubleshooting</h2>\n<p>How to fix: <code class=\"language-text\">At least xMB more space needed on the /boot filesystem</code>. List all installed kernel packages with:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">yum list kernel</code></pre></div>\n<p>The kernel in-use will be underlined and cannot be removed. Now to remove unused kernels, install the yum-utils package and use the package-cleanup util:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">yum <span class=\"token function\">install</span> yum-utils\npackage-cleanup --oldkernels --count<span class=\"token operator\">=</span>2</code></pre></div>\n<p>To make this permanent, edit <code class=\"language-text\">/etc/yum.conf</code> and change the following line:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">installonly_limit<span class=\"token operator\">=</span>2</code></pre></div>\n<h2 id=\"working-with-ip-tables\"><a href=\"#working-with-ip-tables\" aria-label=\"working with ip tables permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Working with IP tables</h2>\n<h3 id=\"how-do-i-view-blocked-ports-rules\"><a href=\"#how-do-i-view-blocked-ports-rules\" aria-label=\"how do i view blocked ports rules permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>How do I view blocked ports rules?</h3>\n<p><em>Use the iptables command:</em></p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token comment\"># /sbin/iptables -L -n -v</span>\n<span class=\"token comment\"># /sbin/iptables -L -n -v | grep port</span>\n<span class=\"token comment\"># /sbin/iptables -L -n -v | grep -i DROP</span>\n<span class=\"token comment\"># /sbin/iptables -L OUTPUT -n -v</span>\n<span class=\"token comment\"># /sbin/iptables -L INPUT -n -v</span></code></pre></div>\n<p>Generally Useful Rules\nThis section includes a variety of iptables commands that will create rules that are generally useful on most servers.</p>\n<p>Allow Loopback Connections\nThe loopback interface, also referred to as lo, is what a computer uses to forward network connections to itself. For example, if you run ping localhost or ping 127.0.0.1, your server will ping itself using the loopback. The loopback interface is also used if you configure your application server to connect to a database server with a “localhost” address. As such, you will want to be sure that your firewall is allowing these connections.</p>\n<p>To accept all traffic on your loopback interface, run these commands:</p>\n<p>sudo iptables -A INPUT -i lo -j ACCEPT\nsudo iptables -A OUTPUT -o lo -j ACCEPT\nAllow Established and Related Incoming Connections\nAs network traffic generally needs to be two-way—incoming and outgoing—to work properly, it is typical to create a firewall rule that allows established and related incoming traffic, so that the server will allow return traffic to outgoing connections initiated by the server itself. This command will allow that:</p>\n<p>sudo iptables -A INPUT -m conntrack —ctstate ESTABLISHED,RELATED -j ACCEPT\nAllow Established Outgoing Connections\nYou may want to allow outgoing traffic of all established connections, which are typically the response to legitimate incoming connections. This command will allow that:</p>\n<p>sudo iptables -A OUTPUT -m conntrack —ctstate ESTABLISHED -j ACCEPT\nInternal to External\nAssuming eth0 is your external network, and eth1 is your internal network, this will allow your internal to access the external:</p>\n<p>sudo iptables -A FORWARD -i eth1 -o eth0 -j ACCEPT\nDrop Invalid Packets\nSome network traffic packets get marked as invalid. Sometimes it can be useful to log this type of packet but often it is fine to drop them. Do so with this command:</p>\n<p>sudo iptables -A INPUT -m conntrack —ctstate INVALID -j DROP\nBlock an IP Address\nTo block network connections that originate from a specific IP address, 15.15.15.51 for example, run this command:</p>\n<p>sudo iptables -A INPUT -s 15.15.15.51 -j DROP\nIn this example, -s 15.15.15.51 specifies a source IP address of “15.15.15.51”. The source IP address can be specified in any firewall rule, including an allow rule.</p>\n<p>If you want to reject the connection instead, which will respond to the connection request with a “connection refused” error, replace “DROP” with “REJECT” like this:</p>\n<p>sudo iptables -A INPUT -s 15.15.15.51 -j REJECT\nBlock Connections to a Network Interface\nTo block connections from a specific IP address, e.g. 15.15.15.51, to a specific network interface, e.g. eth0, use this command:</p>\n<p>iptables -A INPUT -i eth0 -s 15.15.15.51 -j DROP\nThis is the same as the previous example, with the addition of -i eth0. The network interface can be specified in any firewall rule, and is a great way to limit the rule to a particular network.</p>\n<p>Service: SSH\nIf you’re using a cloud server, you will probably want to allow incoming SSH connections (port 22) so you can connect to and manage your server. This section covers how to configure your firewall with various SSH-related rules.</p>\n<p>Allow All Incoming SSH\nTo allow all incoming SSH connections run these commands:</p>\n<p>sudo iptables -A INPUT -p tcp —dport 22 -m conntrack —ctstate NEW,ESTABLISHED -j ACCEPT\nsudo iptables -A OUTPUT -p tcp —sport 22 -m conntrack —ctstate ESTABLISHED -j ACCEPT\nThe second command, which allows the outgoing traffic of established SSH connections, is only necessary if the OUTPUT policy is not set to ACCEPT.</p>\n<p>Allow Incoming SSH from Specific IP address or subnet\nTo allow incoming SSH connections from a specific IP address or subnet, specify the source. For example, if you want to allow the entire 15.15.15.0/24 subnet, run these commands:</p>\n<p>sudo iptables -A INPUT -p tcp -s 15.15.15.0/24 —dport 22 -m conntrack —ctstate NEW,ESTABLISHED -j ACCEPT\nsudo iptables -A OUTPUT -p tcp —sport 22 -m conntrack —ctstate ESTABLISHED -j ACCEPT\nThe second command, which allows the outgoing traffic of established SSH connections, is only necessary if the OUTPUT policy is not set to ACCEPT.</p>\n<p>Allow Outgoing SSH\nIf your firewall OUTPUT policy is not set to ACCEPT, and you want to allow outgoing SSH connections—your server initiating an SSH connection to another server—you can run these commands:</p>\n<p>sudo iptables -A OUTPUT -p tcp —dport 22 -m conntrack —ctstate NEW,ESTABLISHED -j ACCEPT\nsudo iptables -A INPUT -p tcp —sport 22 -m conntrack —ctstate ESTABLISHED -j ACCEPT\nAllow Incoming Rsync from Specific IP Address or Subnet\nRsync, which runs on port 873, can be used to transfer files from one computer to another.</p>\n<p>To allow incoming rsync connections from a specific IP address or subnet, specify the source IP address and the destination port. For example, if you want to allow the entire 15.15.15.0/24 subnet to be able to rsync to your server, run these commands:</p>\n<p>sudo iptables -A INPUT -p tcp -s 15.15.15.0/24 —dport 873 -m conntrack —ctstate NEW,ESTABLISHED -j ACCEPT\nsudo iptables -A OUTPUT -p tcp —sport 873 -m conntrack —ctstate ESTABLISHED -j ACCEPT\nThe second command, which allows the outgoing traffic of established rsync connections, is only necessary if the OUTPUT policy is not set to ACCEPT.</p>\n<p>Service: Web Server\nWeb servers, such as Apache and Nginx, typically listen for requests on port 80 and 443 for HTTP and HTTPS connections, respectively. If your default policy for incoming traffic is set to drop or deny, you will want to create rules that will allow your server to respond to those requests.</p>\n<p>Allow All Incoming HTTP\nTo allow all incoming HTTP (port 80) connections run these commands:</p>\n<p>sudo iptables -A INPUT -p tcp —dport 80 -m conntrack —ctstate NEW,ESTABLISHED -j ACCEPT\nsudo iptables -A OUTPUT -p tcp —sport 80 -m conntrack —ctstate ESTABLISHED -j ACCEPT\nThe second command, which allows the outgoing traffic of established HTTP connections, is only necessary if the OUTPUT policy is not set to ACCEPT.</p>\n<p>Allow All Incoming HTTPS\nTo allow all incoming HTTPS (port 443) connections run these commands:</p>\n<p>sudo iptables -A INPUT -p tcp —dport 443 -m conntrack —ctstate NEW,ESTABLISHED -j ACCEPT\nsudo iptables -A OUTPUT -p tcp —sport 443 -m conntrack —ctstate ESTABLISHED -j ACCEPT\nThe second command, which allows the outgoing traffic of established HTTP connections, is only necessary if the OUTPUT policy is not set to ACCEPT.</p>\n<p>Allow All Incoming HTTP and HTTPS\nIf you want to allow both HTTP and HTTPS traffic, you can use the multiport module to create a rule that allows both ports. To allow all incoming HTTP and HTTPS (port 443) connections run these commands:</p>\n<p>sudo iptables -A INPUT -p tcp -m multiport —dports 80,443 -m conntrack —ctstate NEW,ESTABLISHED -j ACCEPT\nsudo iptables -A OUTPUT -p tcp -m multiport —dports 80,443 -m conntrack —ctstate ESTABLISHED -j ACCEPT\nThe second command, which allows the outgoing traffic of established HTTP and HTTPS connections, is only necessary if the OUTPUT policy is not set to ACCEPT.</p>\n<p>Run the following. It’ll insert the rule at the top of your iptables and will allow all traffic unless subsequently handled by another rule.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">iptables -I INPUT -j ACCEPT</code></pre></div>\n<p>You can also flush your entire iptables setup with the following:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">iptables -F\niptables -X\niptables -t nat -F\niptables -t nat -X\niptables -t mangle -F\niptables -t mangle -X\niptables -P INPUT ACCEPT\niptables -P FORWARD ACCEPT\niptables -P OUTPUT ACCEPT</code></pre></div>\n<p>If you flush it, you might want to run something like:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">iptables -A INPUT -i lo -j ACCEPT -m comment --comment &quot;Allow all loopback traffic&quot;\niptables -A INPUT ! -i lo -d 127.0.0.0/8 -j REJECT -m comment --comment &quot;Drop all traffic to 127 that doesn&#39;t use lo&quot;\niptables -A OUTPUT -j ACCEPT -m comment --comment &quot;Accept all outgoing&quot;\niptables -A INPUT -j ACCEPT -m comment --comment &quot;Accept all incoming&quot;\niptables -A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT -m comment --comment &quot;Allow all incoming on established connections&quot;\niptables -A INPUT -j REJECT -m comment --comment &quot;Reject all incoming&quot;\niptables -A FORWARD -j REJECT -m comment --comment &quot;Reject all forwarded&quot;</code></pre></div>\n<p>If you want to be a bit safer with your traffic, don’t use the accept all incoming rule, or remove it with “iptables -D INPUT -j ACCEPT -m comment —comment “Accept all incoming\"\", and add more specific rules like:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">iptables -I INPUT -p tcp --dport 80 -j ACCEPT -m comment --comment <span class=\"token string\">\"Allow HTTP\"</span>\niptables -I INPUT -p tcp --dport 443 -j ACCEPT -m comment --comment <span class=\"token string\">\"Allow HTTPS\"</span>\niptables -I INPUT -p tcp -m state --state NEW --dport 22 -j ACCEPT -m comment --comment <span class=\"token string\">\"Allow SSH\"</span>\niptables -I INPUT -p tcp --dport 8071:8079 -j ACCEPT -m comment --comment <span class=\"token string\">\"Allow torrents\"</span></code></pre></div>\n<p>NOTE: They need to be above the 2 reject rules at the bottom, so use I to insert them at the top. Or if you’re anal like me, use “iptables -nL —line-numbers” to get the line numbers, then use “iptables -I INPUT …” to insert a rule at a specific line number.</p>\n<p>Finally, save your work with:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">iptables-save &gt; /etc/network/iptables.rules #Or wherever your iptables.rules file is</code></pre></div>","htmlAst":{"type":"root","children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"a","properties":{"className":["gatsby-resp-image-link"],"href":"/static/cc2560d4e1994db8591f8774de873b60/e4f7a/photo-19196703263_69f9f0df5f_o.png","style":"display: block","target":"_blank","rel":["noopener"]},"children":[{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-wrapper"],"style":"position: relative; display: block;  max-width: 800px; margin-left: auto; margin-right: auto;"},"children":[{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-background-image"],"style":"padding-bottom: 49.66666666666666%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAC4jAAAuIwF4pT92AAACV0lEQVQozw2NW0/aYABA+2f24sPmlmWXRLNlhrgHt2imM3MblKG9fu0H9EZbQLEVNUqm2wA1Q8EpoMwr0Oq8RrEgChij/2ck5+E8nOQgPxKZaHItllqfX84tpjdWclvZ7fyOYR6e/CuVT68bF/f3l9WbavbIihatGaM6XqjphRvdvNX37pBwNDkRS03EliMLK/FkZimzntnc2jUKhyemVTmuXJ0dWCWjZJnWpVGuGuXrQrmWrzQO6rfHN3eIPpuY/LUYiS9Nx5NT8dTPxOpiJvfn7/bunrl/enRinZ9fWseV8mGlWqpVy/WrSqN2Uatf1BtntQYyGok1mZydG5+d12YWJqO/p6JzseWVRDabyuUy2xs75s6mWUwXjNW8sW6Ya0UznTezxn66uI84KOBiIEoClKQcOI4SBIoPuShskMZwhiQhjbMUxlIEBDhsNriTIpw0hZKEnSAQJwB2gv7mlpwMNwhYysvhELI85xE5r4+HgptTJK8i0TwHBI7weEjOC0TBLctuVUVsvV86+1HbJ6zrK4kCjuQkVpTEQEAaDvq10HBYV0Ijqqbxo+PuoC6OTQnhiFub9o5Ny9/nEUwI9A6yb/vRbhR8bEqfo8eOD2CMnWRdNAt4EQqib2RECOmUOkqpGu3XSH+Y8I8RgQkEBd7WdtuTV7b2rt7ntveP2mxPO7owj0zzvgEXPgQgFCVF05tnVg0yAi8FFVULQTnAKCEEyv6WZ21v3nW3tnU8ePyy5cXrh+2dH5ykquucogwx7j6Hq+ez3U4yOOcjeBEIEpQk6JNZSf4PpY46MAAAeQ8AAAAASUVORK5CYII='); background-size: cover; display: block;"},"children":[]},{"type":"text","value":"\n    "},{"type":"element","tagName":"img","properties":{"className":["gatsby-resp-image-image"],"style":"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px transparent;","alt":"Abashiri, Japan","title":"","src":"/static/cc2560d4e1994db8591f8774de873b60/5f213/photo-19196703263_69f9f0df5f_o.png","srcSet":["/static/cc2560d4e1994db8591f8774de873b60/793cf/photo-19196703263_69f9f0df5f_o.png 200w","/static/cc2560d4e1994db8591f8774de873b60/767c8/photo-19196703263_69f9f0df5f_o.png 400w","/static/cc2560d4e1994db8591f8774de873b60/5f213/photo-19196703263_69f9f0df5f_o.png 800w","/static/cc2560d4e1994db8591f8774de873b60/c5dd2/photo-19196703263_69f9f0df5f_o.png 1200w","/static/cc2560d4e1994db8591f8774de873b60/e4f7a/photo-19196703263_69f9f0df5f_o.png 1500w"],"sizes":["(max-width:","800px)","100vw,","800px"]},"children":[]},{"type":"text","value":"\n  "}]},{"type":"text","value":"\n  "}]}]},{"type":"text","value":"\n"},{"type":"comment","value":" TOC "},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"#changing-your-ssh-login"},"children":[{"type":"text","value":"Changing your SSH login"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"#running-firewalld"},"children":[{"type":"text","value":"Running FirewallD"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"#changing-the-ssh-port"},"children":[{"type":"text","value":"Changing the SSH Port"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"#changing-the-hostname"},"children":[{"type":"text","value":"Changing the Hostname"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"#kernel-update-troubleshooting"},"children":[{"type":"text","value":"Kernel Update Troubleshooting"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"#working-with-ip-tables"},"children":[{"type":"text","value":"Working with IP tables"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"#how-do-i-view-blocked-ports-rules"},"children":[{"type":"text","value":"How do I view blocked ports rules?"}]}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"comment","value":" /TOC "},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{"id":"changing-your-ssh-login"},"children":[{"type":"element","tagName":"a","properties":{"href":"#changing-your-ssh-login","ariaLabel":"changing your ssh login permalink","className":["anchor"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"Changing your SSH login"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"SSH uses your linux user password. Simply use the passwd command after logging in. It will prompt you to change it. Or name a different user to change theirs:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"ssh"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-ssh"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-ssh"]},"children":[{"type":"text","value":"passwd\npasswd user1"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{"id":"running-firewalld"},"children":[{"type":"element","tagName":"a","properties":{"href":"#running-firewalld","ariaLabel":"running firewalld permalink","className":["anchor"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"Running FirewallD"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"bash"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-bash"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-bash"]},"children":[{"type":"text","value":"yum "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"install"}]},{"type":"text","value":" -y firewalld\nsystemctl "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"enable"}]},{"type":"text","value":" firewalld\nsystemctl start firewalld\nsystemctl status firewalld\nfirewall-cmd --permanent --zone"},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":"public --add-service"},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":"http\nfirewall-cmd --permanent --zone"},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":"public --add-port"},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":"1880/tcp\nfirewall-cmd --reload\nfirewall-cmd --list-all"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{"id":"changing-the-ssh-port"},"children":[{"type":"element","tagName":"a","properties":{"href":"#changing-the-ssh-port","ariaLabel":"changing the ssh port permalink","className":["anchor"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"Changing the SSH Port"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"bash"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-bash"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-bash"]},"children":[{"type":"text","value":"firewall-cmd --permanent --zone"},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":"public --add-port"},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":"4444/tcp\nfirewall-cmd --reload\nsemanage port -a -t ssh_port_t -p tcp 4444\n"},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"nano"}]},{"type":"text","value":" /etc/ssh/sshd_config"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"yaml"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"# If you want to change the port on a SELinux system, you have to tell"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"# SELinux about this change."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"# semanage port -a -t ssh_port_t -p tcp #PORTNUMBER"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"#"}]},{"type":"text","value":"\nPort 4444\n"},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"#AddressFamily any"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"#ListenAddress 0.0.0.0"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"#ListenAddress ::"}]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"bash"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-bash"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-bash"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"service"}]},{"type":"text","value":" sshd restart"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{"id":"changing-the-hostname"},"children":[{"type":"element","tagName":"a","properties":{"href":"#changing-the-hostname","ariaLabel":"changing the hostname permalink","className":["anchor"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"Changing the Hostname"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"bash"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-bash"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-bash"]},"children":[{"type":"text","value":"hostnamectl set-hostname your-new-hostname\nhostnamectl\nsystemctl "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"reboot"}]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{"id":"kernel-update-troubleshooting"},"children":[{"type":"element","tagName":"a","properties":{"href":"#kernel-update-troubleshooting","ariaLabel":"kernel update troubleshooting permalink","className":["anchor"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"Kernel Update Troubleshooting"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"How to fix: "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"At least xMB more space needed on the /boot filesystem"}]},{"type":"text","value":". List all installed kernel packages with:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"bash"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-bash"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-bash"]},"children":[{"type":"text","value":"yum list kernel"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The kernel in-use will be underlined and cannot be removed. Now to remove unused kernels, install the yum-utils package and use the package-cleanup util:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"bash"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-bash"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-bash"]},"children":[{"type":"text","value":"yum "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"install"}]},{"type":"text","value":" yum-utils\npackage-cleanup --oldkernels --count"},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":"2"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"To make this permanent, edit "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"/etc/yum.conf"}]},{"type":"text","value":" and change the following line:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"bash"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-bash"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-bash"]},"children":[{"type":"text","value":"installonly_limit"},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":"2"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{"id":"working-with-ip-tables"},"children":[{"type":"element","tagName":"a","properties":{"href":"#working-with-ip-tables","ariaLabel":"working with ip tables permalink","className":["anchor"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"Working with IP tables"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{"id":"how-do-i-view-blocked-ports-rules"},"children":[{"type":"element","tagName":"a","properties":{"href":"#how-do-i-view-blocked-ports-rules","ariaLabel":"how do i view blocked ports rules permalink","className":["anchor"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"How do I view blocked ports rules?"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"Use the iptables command:"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"bash"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-bash"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-bash"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"# /sbin/iptables -L -n -v"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"# /sbin/iptables -L -n -v | grep port"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"# /sbin/iptables -L -n -v | grep -i DROP"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"# /sbin/iptables -L OUTPUT -n -v"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"# /sbin/iptables -L INPUT -n -v"}]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Generally Useful Rules\nThis section includes a variety of iptables commands that will create rules that are generally useful on most servers."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Allow Loopback Connections\nThe loopback interface, also referred to as lo, is what a computer uses to forward network connections to itself. For example, if you run ping localhost or ping 127.0.0.1, your server will ping itself using the loopback. The loopback interface is also used if you configure your application server to connect to a database server with a “localhost” address. As such, you will want to be sure that your firewall is allowing these connections."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"To accept all traffic on your loopback interface, run these commands:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"sudo iptables -A INPUT -i lo -j ACCEPT\nsudo iptables -A OUTPUT -o lo -j ACCEPT\nAllow Established and Related Incoming Connections\nAs network traffic generally needs to be two-way—incoming and outgoing—to work properly, it is typical to create a firewall rule that allows established and related incoming traffic, so that the server will allow return traffic to outgoing connections initiated by the server itself. This command will allow that:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"sudo iptables -A INPUT -m conntrack —ctstate ESTABLISHED,RELATED -j ACCEPT\nAllow Established Outgoing Connections\nYou may want to allow outgoing traffic of all established connections, which are typically the response to legitimate incoming connections. This command will allow that:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"sudo iptables -A OUTPUT -m conntrack —ctstate ESTABLISHED -j ACCEPT\nInternal to External\nAssuming eth0 is your external network, and eth1 is your internal network, this will allow your internal to access the external:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"sudo iptables -A FORWARD -i eth1 -o eth0 -j ACCEPT\nDrop Invalid Packets\nSome network traffic packets get marked as invalid. Sometimes it can be useful to log this type of packet but often it is fine to drop them. Do so with this command:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"sudo iptables -A INPUT -m conntrack —ctstate INVALID -j DROP\nBlock an IP Address\nTo block network connections that originate from a specific IP address, 15.15.15.51 for example, run this command:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"sudo iptables -A INPUT -s 15.15.15.51 -j DROP\nIn this example, -s 15.15.15.51 specifies a source IP address of “15.15.15.51”. The source IP address can be specified in any firewall rule, including an allow rule."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"If you want to reject the connection instead, which will respond to the connection request with a “connection refused” error, replace “DROP” with “REJECT” like this:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"sudo iptables -A INPUT -s 15.15.15.51 -j REJECT\nBlock Connections to a Network Interface\nTo block connections from a specific IP address, e.g. 15.15.15.51, to a specific network interface, e.g. eth0, use this command:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"iptables -A INPUT -i eth0 -s 15.15.15.51 -j DROP\nThis is the same as the previous example, with the addition of -i eth0. The network interface can be specified in any firewall rule, and is a great way to limit the rule to a particular network."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Service: SSH\nIf you’re using a cloud server, you will probably want to allow incoming SSH connections (port 22) so you can connect to and manage your server. This section covers how to configure your firewall with various SSH-related rules."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Allow All Incoming SSH\nTo allow all incoming SSH connections run these commands:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"sudo iptables -A INPUT -p tcp —dport 22 -m conntrack —ctstate NEW,ESTABLISHED -j ACCEPT\nsudo iptables -A OUTPUT -p tcp —sport 22 -m conntrack —ctstate ESTABLISHED -j ACCEPT\nThe second command, which allows the outgoing traffic of established SSH connections, is only necessary if the OUTPUT policy is not set to ACCEPT."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Allow Incoming SSH from Specific IP address or subnet\nTo allow incoming SSH connections from a specific IP address or subnet, specify the source. For example, if you want to allow the entire 15.15.15.0/24 subnet, run these commands:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"sudo iptables -A INPUT -p tcp -s 15.15.15.0/24 —dport 22 -m conntrack —ctstate NEW,ESTABLISHED -j ACCEPT\nsudo iptables -A OUTPUT -p tcp —sport 22 -m conntrack —ctstate ESTABLISHED -j ACCEPT\nThe second command, which allows the outgoing traffic of established SSH connections, is only necessary if the OUTPUT policy is not set to ACCEPT."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Allow Outgoing SSH\nIf your firewall OUTPUT policy is not set to ACCEPT, and you want to allow outgoing SSH connections—your server initiating an SSH connection to another server—you can run these commands:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"sudo iptables -A OUTPUT -p tcp —dport 22 -m conntrack —ctstate NEW,ESTABLISHED -j ACCEPT\nsudo iptables -A INPUT -p tcp —sport 22 -m conntrack —ctstate ESTABLISHED -j ACCEPT\nAllow Incoming Rsync from Specific IP Address or Subnet\nRsync, which runs on port 873, can be used to transfer files from one computer to another."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"To allow incoming rsync connections from a specific IP address or subnet, specify the source IP address and the destination port. For example, if you want to allow the entire 15.15.15.0/24 subnet to be able to rsync to your server, run these commands:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"sudo iptables -A INPUT -p tcp -s 15.15.15.0/24 —dport 873 -m conntrack —ctstate NEW,ESTABLISHED -j ACCEPT\nsudo iptables -A OUTPUT -p tcp —sport 873 -m conntrack —ctstate ESTABLISHED -j ACCEPT\nThe second command, which allows the outgoing traffic of established rsync connections, is only necessary if the OUTPUT policy is not set to ACCEPT."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Service: Web Server\nWeb servers, such as Apache and Nginx, typically listen for requests on port 80 and 443 for HTTP and HTTPS connections, respectively. If your default policy for incoming traffic is set to drop or deny, you will want to create rules that will allow your server to respond to those requests."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Allow All Incoming HTTP\nTo allow all incoming HTTP (port 80) connections run these commands:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"sudo iptables -A INPUT -p tcp —dport 80 -m conntrack —ctstate NEW,ESTABLISHED -j ACCEPT\nsudo iptables -A OUTPUT -p tcp —sport 80 -m conntrack —ctstate ESTABLISHED -j ACCEPT\nThe second command, which allows the outgoing traffic of established HTTP connections, is only necessary if the OUTPUT policy is not set to ACCEPT."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Allow All Incoming HTTPS\nTo allow all incoming HTTPS (port 443) connections run these commands:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"sudo iptables -A INPUT -p tcp —dport 443 -m conntrack —ctstate NEW,ESTABLISHED -j ACCEPT\nsudo iptables -A OUTPUT -p tcp —sport 443 -m conntrack —ctstate ESTABLISHED -j ACCEPT\nThe second command, which allows the outgoing traffic of established HTTP connections, is only necessary if the OUTPUT policy is not set to ACCEPT."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Allow All Incoming HTTP and HTTPS\nIf you want to allow both HTTP and HTTPS traffic, you can use the multiport module to create a rule that allows both ports. To allow all incoming HTTP and HTTPS (port 443) connections run these commands:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"sudo iptables -A INPUT -p tcp -m multiport —dports 80,443 -m conntrack —ctstate NEW,ESTABLISHED -j ACCEPT\nsudo iptables -A OUTPUT -p tcp -m multiport —dports 80,443 -m conntrack —ctstate ESTABLISHED -j ACCEPT\nThe second command, which allows the outgoing traffic of established HTTP and HTTPS connections, is only necessary if the OUTPUT policy is not set to ACCEPT."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Run the following. It’ll insert the rule at the top of your iptables and will allow all traffic unless subsequently handled by another rule."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"bash"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-bash"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-bash"]},"children":[{"type":"text","value":"iptables -I INPUT -j ACCEPT"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"You can also flush your entire iptables setup with the following:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"bash"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-bash"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-bash"]},"children":[{"type":"text","value":"iptables -F\niptables -X\niptables -t nat -F\niptables -t nat -X\niptables -t mangle -F\niptables -t mangle -X\niptables -P INPUT ACCEPT\niptables -P FORWARD ACCEPT\niptables -P OUTPUT ACCEPT"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"If you flush it, you might want to run something like:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"text"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-text"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"iptables -A INPUT -i lo -j ACCEPT -m comment --comment \"Allow all loopback traffic\"\niptables -A INPUT ! -i lo -d 127.0.0.0/8 -j REJECT -m comment --comment \"Drop all traffic to 127 that doesn't use lo\"\niptables -A OUTPUT -j ACCEPT -m comment --comment \"Accept all outgoing\"\niptables -A INPUT -j ACCEPT -m comment --comment \"Accept all incoming\"\niptables -A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT -m comment --comment \"Allow all incoming on established connections\"\niptables -A INPUT -j REJECT -m comment --comment \"Reject all incoming\"\niptables -A FORWARD -j REJECT -m comment --comment \"Reject all forwarded\""}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"If you want to be a bit safer with your traffic, don’t use the accept all incoming rule, or remove it with “iptables -D INPUT -j ACCEPT -m comment —comment “Accept all incoming\"\", and add more specific rules like:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"bash"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-bash"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-bash"]},"children":[{"type":"text","value":"iptables -I INPUT -p tcp --dport 80 -j ACCEPT -m comment --comment "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"Allow HTTP\""}]},{"type":"text","value":"\niptables -I INPUT -p tcp --dport 443 -j ACCEPT -m comment --comment "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"Allow HTTPS\""}]},{"type":"text","value":"\niptables -I INPUT -p tcp -m state --state NEW --dport 22 -j ACCEPT -m comment --comment "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"Allow SSH\""}]},{"type":"text","value":"\niptables -I INPUT -p tcp --dport 8071:8079 -j ACCEPT -m comment --comment "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"Allow torrents\""}]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"NOTE: They need to be above the 2 reject rules at the bottom, so use I to insert them at the top. Or if you’re anal like me, use “iptables -nL —line-numbers” to get the line numbers, then use “iptables -I INPUT …” to insert a rule at a specific line number."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Finally, save your work with:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"text"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-text"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"iptables-save > /etc/network/iptables.rules #Or wherever your iptables.rules file is"}]}]}]}],"data":{"quirksMode":false}},"fields":{"slug":"/centos-administration/","prefix":"2019-01-13"},"frontmatter":{"title":"Centos Administration","subTitle":"Red Hat Enterprise and Centos Linux Server Adminsitration","cover":{"childImageSharp":{"resize":{"src":"/static/d56d3ceb6d8a72e5713d16cdc8fb4ba8/152f9/photo-19196703263_69f9f0df5f_o-cover.png"}}}}},"author":{"id":"9c69de06-11ab-55c9-b52a-3cc0b2f51365","html":"<p><strong>Mike Polinowski</strong> Proin ornare ligula eu tellus tempus elementum. Aenean <a href=\"/contact/\">contact me</a> iaculis mi, nec blandit lacus interdum vitae. Vestibulum non nibh risus, a scelerisque purus. :hearts:</p>"},"footnote":{"id":"24817670-3434-5a21-9de1-e9fab89708d7","html":"<ul>\n<li>This is a personal Developer Blog</li>\n<li>Ξ</li>\n<li>built by <a href=\"https://github.com/mpolinowski\">Mike Polinowski</a></li>\n<li>Ξ</li>\n<li>with <a href=\"https://www.gatsbyjs.org/\">Gatsby</a> &#x26; <a href=\"https://reactjs.org\">React</a></li>\n<li>Ξ</li>\n<li>source code on <a href=\"https://github.com/mpolinowski/mpolinowski.github.io\">GitHub</a></li>\n<li>Ξ</li>\n<li>deliverd by <a href=\"https://pages.github.com\">Github Pages</a></li>\n<li>Ξ</li>\n<li>photos from <a href=\"https://www.flickr.com/people/149680084@N06/\">Flickr</a></li>\n</ul>"}},"pageContext":{"slug":"/centos-administration/"}}