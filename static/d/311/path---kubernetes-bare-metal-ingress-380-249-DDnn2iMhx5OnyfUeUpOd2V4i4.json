{"data":{"post":{"id":"2620f7db-7edd-58ea-ad5c-546ace072143","html":"<p><a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/20163114aeb82ffdf18e1c79b2db2f8d/abed6/photo-34607876585_6e59cd762e_o.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 800px;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 46.93333333333333%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsSAAALEgHS3X78AAACXElEQVQozy2SS09TURSF79BEg9LC7X31vtrb3pa2lFeBFtpShAKiLSKioBiMPBQVEhwYo07AqDESBhKjhokhcQBxpkYHmDDkT30e1MEenHP2+s7K3kvSVR3L0ImYYXzXpDPpMNIdY7qU4O5oisf1FB/Xy3x/M872XIblkRT1fIJym0c27uDZJq7QGpqOLGtIwSaF5mYVVYAd8dDmOwzn4tT6k6xeq7A2Xebp4hiHB5scvF1mabiDyUKK/laPdMzGNMLEIxaa0J9wpKhuEbEtzLBBxrfpa49RzvnUK2lmq208vFrm8/t1jo/3+P1ti8O913x49YSV0SwzQ+14jkUhG8ESetcOI2Vdm0zMIulZXCz63LjQylDOY6qS5PZEjmeLRXY363z9tChqgV/7Gxz9eMfB1gM21hao5uPcnyvRmXap9CaQQrLKScUEPWYbdCUs7lSizJ/3eTRbYvV6kfmxNF+eT3K0v8n2So2VWp6xco5qX45E1CSTjBBxLaKOieRZGnJTiK6kSTFrMjGQpD/t0O5b1IotTIhZ1osJdhZL/NxZ4cXMIDcLaaqiN24ZmLpOUzDEqdNBGhtlpMaAzJmGZixdIRvVuDXoiEEbDPXEWZ7s4HJvhEtdJuPdUaaH25kayFDrFR91u/hOGE9AQ7JCUEBDzQpSwzmZc4IcCIRoEhs3VQXP1Cl1uCIWYXp8nZf38izVMmRdlVLGoj9l0WLraCEFNaQiC9AJNCCg0tnG/0Bx+BchBU3RMFRVZNOg0KKwuzHClaEMugBEwzpRQ8PVNWxNFXfqX2dBYejE5R+5mSqywrWtiQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    ></span>\n    <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px transparent;\"\n        alt=\"Victoria Harbour, Hongkong\"\n        title=\"\"\n        src=\"/static/20163114aeb82ffdf18e1c79b2db2f8d/de8ec/photo-34607876585_6e59cd762e_o.png\"\n        srcset=\"/static/20163114aeb82ffdf18e1c79b2db2f8d/81654/photo-34607876585_6e59cd762e_o.png 200w,\n/static/20163114aeb82ffdf18e1c79b2db2f8d/3601a/photo-34607876585_6e59cd762e_o.png 400w,\n/static/20163114aeb82ffdf18e1c79b2db2f8d/de8ec/photo-34607876585_6e59cd762e_o.png 800w,\n/static/20163114aeb82ffdf18e1c79b2db2f8d/4c3ca/photo-34607876585_6e59cd762e_o.png 1200w,\n/static/20163114aeb82ffdf18e1c79b2db2f8d/abed6/photo-34607876585_6e59cd762e_o.png 1500w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n      />\n  </span>\n  </a></p>\n<!-- TOC -->\n<ul>\n<li><a href=\"#bare-metal-considerations\">Bare-metal considerations</a></li>\n<li>\n<p><a href=\"#network-load-balancer-metallb\">Network Load-balancer MetalLB</a></p>\n<ul>\n<li><a href=\"#installation-with-kubernetes-manifests\">Installation With Kubernetes Manifests</a></li>\n<li><a href=\"#metallb-configuration\">MetalLB Configuration</a></li>\n<li><a href=\"#layer-2-configuration\">Layer 2 Configuration</a></li>\n</ul>\n</li>\n</ul>\n<!-- /TOC -->\n<blockquote>\n<p>DRAFT - this article is still undergoing some “research”…</p>\n</blockquote>\n<h2 id=\"bare-metal-considerations\"><a href=\"#bare-metal-considerations\" aria-label=\"bare metal considerations permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Bare-metal considerations</h2>\n<p>In traditional cloud environments, where network load balancers are available on-demand, a single Kubernetes manifest suffices to provide a single point of contact to the NGINX Ingress controller to external clients and, indirectly, to any application running inside the cluster. <a href=\"https://kubernetes.github.io/ingress-nginx/deploy/baremetal/\">Bare-metal environments</a> lack this commodity, requiring a slightly different setup to offer the same kind of access to external consumers. The rest of this article describes a few recommended approaches to deploying the <a href=\"https://github.com/kubernetes/ingress-nginx\">NGINX Ingress controller</a> inside a Kubernetes cluster running on bare-metal.</p>\n<h2 id=\"network-load-balancer-metallb\"><a href=\"#network-load-balancer-metallb\" aria-label=\"network load balancer metallb permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Network Load-balancer MetalLB</h2>\n<p><a href=\"https://metallb.universe.tf/concepts/\">MetalLB</a> hooks into your Kubernetes cluster, and provides a network load-balancer implementation. In short, it allows you to create Kubernetes services of type “LoadBalancer” in clusters that don’t run on a cloud provider, and thus cannot simply hook into paid products to provide load-balancers.</p>\n<p>It has two features that work together to provide this service: address allocation, and external announcement:</p>\n<ul>\n<li><strong>Address Allocation</strong>: In a cloud-enabled Kubernetes cluster, you request a load-balancer, and your cloud platform assigns an IP address to you. In a bare metal cluster, MetalLB is responsible for that allocation.</li>\n<li><strong>External Announcement</strong>: Once MetalLB has assigned an external IP address to a service, it needs to make the network beyond the cluster aware that the IP “lives” in the cluster. MetalLB uses standard routing protocols to achieve this: ARP, NDP, or BGP.</li>\n</ul>\n<p>Before starting with installation, make sure you meet all the <a href=\"https://metallb.universe.tf/#requirements\">requirements</a>.</p>\n<h3 id=\"installation-with-kubernetes-manifests\"><a href=\"#installation-with-kubernetes-manifests\" aria-label=\"installation with kubernetes manifests permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Installation With Kubernetes Manifests</h3>\n<p>To install MetalLB, simply apply the manifest:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">kubectl apply -f https://raw.githubusercontent.com/google/metallb/v0.7.3/manifests/metallb.yaml</code></pre></div>\n<p>This will deploy MetalLB to your cluster, under the metallb-system namespace. The components in the manifest are:</p>\n<ul>\n<li>The <code class=\"language-text\">metallb-system/controller deployment</code>. This is the cluster-wide controller that handles IP address assignments.</li>\n<li>The <code class=\"language-text\">metallb-system/speaker daemonset</code>. This is the component that speaks the protocol(s) of your choice to make the services reachable.</li>\n</ul>\n<p>The installation manifest does not include a configuration file. MetalLB’s components will still start, but will remain idle until you define and deploy a configmap.</p>\n<h3 id=\"metallb-configuration\"><a href=\"#metallb-configuration\" aria-label=\"metallb configuration permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>MetalLB Configuration</h3>\n<p>To configure MetalLB, write a config map to <code class=\"language-text\">metallb-system/config</code> like <a href=\"https://raw.githubusercontent.com/google/metallb/v0.7.3/manifests/example-config.yaml\">this example</a>:</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> ConfigMap\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> metallb<span class=\"token punctuation\">-</span>system\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> config\n<span class=\"token key atrule\">data</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">config</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">|</span><span class=\"token scalar string\">\n    # The peers section tells MetalLB what BGP routers to connect too. There\n    # is one entry for each router you want to peer with.\n    peers:\n    - # The target IP address for the BGP session.\n      peer-address: 10.0.0.1\n      # The BGP AS number that MetalLB expects to see advertised by\n      # the router.\n      peer-asn: 64512\n      # The BGP AS number that MetalLB should speak as.\n      my-asn: 64512\n      # (optional) the TCP port to talk to. Defaults to 179, you shouldn't\n      # need to set this in production.\n      peer-port: 179\n      # (optional) The proposed value of the BGP Hold Time timer. Refer to\n      # BGP reference material to understand what setting this implies.\n      hold-time: 120\n      # (optional) The router ID to use when connecting to this peer. Defaults\n      # to the node IP address. Generally only useful when you need to peer with\n      # another BGP router running on the same machine as MetalLB.\n      router-id: 1.2.3.4\n      # (optional) Password for TCPMD5 authenticated BGP sessions\n      # offered by some peers.\n      password: \"yourPassword\"\n      # (optional) The nodes that should connect to this peer. A node\n      # matches if at least one of the node selectors matches. Within\n      # one selector, a node matches if all the matchers are\n      # satisfied. The semantics of each selector are the same as the\n      # label- and set-based selectors in Kubernetes, documented at\n      # https://kubernetes.io/docs/concepts/overview/working-with-objects/labels/.\n      # By default, all nodes are selected.\n      node-selectors:\n      - # Match by label=value\n        match-labels:\n          kubernetes.io/hostname: prod-01\n        # Match by 'key OP values' expressions\n        match-expressions:\n        - key: beta.kubernetes.io/arch\n          operator: In\n          values: [amd64, arm]</span>\n\n    <span class=\"token comment\"># The address-pools section lists the IP addresses that MetalLB is</span>\n    <span class=\"token comment\"># allowed to allocate, along with settings for how to advertise</span>\n    <span class=\"token comment\"># those addresses over BGP once assigned. You can have as many</span>\n    <span class=\"token comment\"># address pools as you want.</span>\n    <span class=\"token key atrule\">address-pools</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token comment\"># A name for the address pool. Services can request allocation</span>\n      <span class=\"token comment\"># from a specific address pool using this name, by listing this</span>\n      <span class=\"token comment\"># name under the 'metallb.universe.tf/address-pool' annotation.</span>\n      <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> my<span class=\"token punctuation\">-</span>ip<span class=\"token punctuation\">-</span>space\n      <span class=\"token comment\"># Protocol can be used to select how the announcement is done.</span>\n      <span class=\"token comment\"># Supported values are bgp and layer2.</span>\n      <span class=\"token key atrule\">protocol</span><span class=\"token punctuation\">:</span> bgp\n      \n      <span class=\"token comment\"># A list of IP address ranges over which MetalLB has</span>\n      <span class=\"token comment\"># authority. You can list multiple ranges in a single pool, they</span>\n      <span class=\"token comment\"># will all share the same settings. Each range can be either a</span>\n      <span class=\"token comment\"># CIDR prefix, or an explicit start-end range of IPs.</span>\n      <span class=\"token key atrule\">addresses</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> 198.51.100.0/24\n      <span class=\"token punctuation\">-</span> 192.168.0.150<span class=\"token punctuation\">-</span>192.168.0.200\n      <span class=\"token comment\"># (optional) If true, MetalLB will not allocate any address that</span>\n      <span class=\"token comment\"># ends in .0 or .255. Some old, buggy consumer devices</span>\n      <span class=\"token comment\"># mistakenly block traffic to such addresses under the guise of</span>\n      <span class=\"token comment\"># smurf protection. Such devices have become fairly rare, but</span>\n      <span class=\"token comment\"># the option is here if you encounter serving issues.</span>\n      <span class=\"token key atrule\">avoid-buggy-ips</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n      <span class=\"token comment\"># (optional, default true) If false, MetalLB will not automatically</span>\n      <span class=\"token comment\"># allocate any address in this pool. Addresses can still explicitly</span>\n      <span class=\"token comment\"># be requested via loadBalancerIP or the address-pool annotation.</span>\n      <span class=\"token key atrule\">auto-assign</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span>\n      <span class=\"token comment\"># (optional) A list of BGP advertisements to make, when</span>\n      <span class=\"token comment\"># protocol=bgp. Each address that gets assigned out of this pool</span>\n      <span class=\"token comment\"># will turn into this many advertisements. For most simple</span>\n      <span class=\"token comment\"># setups, you'll probably just want one.</span>\n      <span class=\"token comment\">#</span>\n      <span class=\"token comment\"># The default value for this field is a single advertisement with</span>\n      <span class=\"token comment\"># all parameters set to their respective defaults.</span>\n      <span class=\"token key atrule\">bgp-advertisements</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token comment\"># (optional) How much you want to aggregate up the IP address</span>\n        <span class=\"token comment\"># before advertising. For example, advertising 1.2.3.4 with</span>\n        <span class=\"token comment\"># aggregation-length=24 would end up advertising 1.2.3.0/24.</span>\n        <span class=\"token comment\"># For the majority of setups, you'll want to keep this at the</span>\n        <span class=\"token comment\"># default of 32, which advertises the entire IP address</span>\n        <span class=\"token comment\"># unmodified.</span>\n        <span class=\"token key atrule\">aggregation-length</span><span class=\"token punctuation\">:</span> <span class=\"token number\">32</span>\n        <span class=\"token comment\"># (optional) The value of the BGP \"local preference\" attribute</span>\n        <span class=\"token comment\"># for this advertisement. Only used with IBGP peers,</span>\n        <span class=\"token comment\"># i.e. peers where peer-asn is the same as my-asn.</span>\n        <span class=\"token key atrule\">localpref</span><span class=\"token punctuation\">:</span> <span class=\"token number\">100</span>\n        <span class=\"token comment\"># (optional) BGP communities to attach to this</span>\n        <span class=\"token comment\"># advertisement. Communities are given in the standard</span>\n        <span class=\"token comment\"># two-part form &lt;asn>:&lt;community number>. You can also use</span>\n        <span class=\"token comment\"># alias names (see below).</span>\n        <span class=\"token key atrule\">communities</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> 64512<span class=\"token punctuation\">:</span><span class=\"token number\">1</span>\n        <span class=\"token punctuation\">-</span> no<span class=\"token punctuation\">-</span>export\n    <span class=\"token comment\"># (optional) BGP community aliases. Instead of using hard to</span>\n    <span class=\"token comment\"># read BGP community numbers in address pool advertisement</span>\n    <span class=\"token comment\"># configurations, you can define alias names here and use those</span>\n    <span class=\"token comment\"># elsewhere in the configuration. The \"no-export\" community used</span>\n    <span class=\"token comment\"># above is defined below.</span>\n    <span class=\"token key atrule\">bgp-communities</span><span class=\"token punctuation\">:</span>\n      <span class=\"token comment\"># no-export is a well-known BGP community that prevents</span>\n      <span class=\"token comment\"># re-advertisement outside of the immediate autonomous system,</span>\n      <span class=\"token comment\"># but people don't usually recognize its numerical value. :)</span>\n      <span class=\"token key atrule\">no-export</span><span class=\"token punctuation\">:</span> 65535<span class=\"token punctuation\">:</span><span class=\"token number\">65281</span></code></pre></div>\n<h3 id=\"layer-2-configuration\"><a href=\"#layer-2-configuration\" aria-label=\"layer 2 configuration permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Layer 2 Configuration</h3>\n<p><a href=\"https://metallb.universe.tf/tutorial/layer2/\">Layer 2 mode</a> is the simplest to configure. The nice thing about layer 2 mode is that you don’t need any fancy network hardware at all, it should just work on any ethernet network. For example, the following configuration gives MetalLB control over IPs from <strong>192.168.1.240</strong> to <strong>192.168.1.250</strong>, and configures <a href=\"https://metallb.universe.tf/configuration/#layer-2-configuration\">Layer 2 mode</a>:</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> ConfigMap\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> metallb<span class=\"token punctuation\">-</span>system\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> config\n<span class=\"token key atrule\">data</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">config</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">|</span><span class=\"token scalar string\">\n    address-pools:\n    - name: default\n      protocol: layer2\n      addresses:\n      - 192.168.1.240-192.168.1.250</span></code></pre></div>\n<hr>\n<p><img src=\"./kubernetes_logging_04.png\" alt=\"A Kubernetes Cluster &#x26; Microservices\"></p>\n<hr>","htmlAst":{"type":"root","children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"a","properties":{"className":["gatsby-resp-image-link"],"href":"/static/20163114aeb82ffdf18e1c79b2db2f8d/abed6/photo-34607876585_6e59cd762e_o.png","style":"display: block","target":"_blank","rel":["noopener"]},"children":[{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-wrapper"],"style":"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 800px;"},"children":[{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-background-image"],"style":"padding-bottom: 46.93333333333333%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsSAAALEgHS3X78AAACXElEQVQozy2SS09TURSF79BEg9LC7X31vtrb3pa2lFeBFtpShAKiLSKioBiMPBQVEhwYo07AqDESBhKjhokhcQBxpkYHmDDkT30e1MEenHP2+s7K3kvSVR3L0ImYYXzXpDPpMNIdY7qU4O5oisf1FB/Xy3x/M872XIblkRT1fIJym0c27uDZJq7QGpqOLGtIwSaF5mYVVYAd8dDmOwzn4tT6k6xeq7A2Xebp4hiHB5scvF1mabiDyUKK/laPdMzGNMLEIxaa0J9wpKhuEbEtzLBBxrfpa49RzvnUK2lmq208vFrm8/t1jo/3+P1ti8O913x49YSV0SwzQ+14jkUhG8ESetcOI2Vdm0zMIulZXCz63LjQylDOY6qS5PZEjmeLRXY363z9tChqgV/7Gxz9eMfB1gM21hao5uPcnyvRmXap9CaQQrLKScUEPWYbdCUs7lSizJ/3eTRbYvV6kfmxNF+eT3K0v8n2So2VWp6xco5qX45E1CSTjBBxLaKOieRZGnJTiK6kSTFrMjGQpD/t0O5b1IotTIhZ1osJdhZL/NxZ4cXMIDcLaaqiN24ZmLpOUzDEqdNBGhtlpMaAzJmGZixdIRvVuDXoiEEbDPXEWZ7s4HJvhEtdJuPdUaaH25kayFDrFR91u/hOGE9AQ7JCUEBDzQpSwzmZc4IcCIRoEhs3VQXP1Cl1uCIWYXp8nZf38izVMmRdlVLGoj9l0WLraCEFNaQiC9AJNCCg0tnG/0Bx+BchBU3RMFRVZNOg0KKwuzHClaEMugBEwzpRQ8PVNWxNFXfqX2dBYejE5R+5mSqywrWtiQAAAABJRU5ErkJggg=='); background-size: cover; display: block;"},"children":[]},{"type":"text","value":"\n    "},{"type":"element","tagName":"img","properties":{"className":["gatsby-resp-image-image"],"style":"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px transparent;","alt":"Victoria Harbour, Hongkong","title":"","src":"/static/20163114aeb82ffdf18e1c79b2db2f8d/de8ec/photo-34607876585_6e59cd762e_o.png","srcSet":["/static/20163114aeb82ffdf18e1c79b2db2f8d/81654/photo-34607876585_6e59cd762e_o.png 200w","/static/20163114aeb82ffdf18e1c79b2db2f8d/3601a/photo-34607876585_6e59cd762e_o.png 400w","/static/20163114aeb82ffdf18e1c79b2db2f8d/de8ec/photo-34607876585_6e59cd762e_o.png 800w","/static/20163114aeb82ffdf18e1c79b2db2f8d/4c3ca/photo-34607876585_6e59cd762e_o.png 1200w","/static/20163114aeb82ffdf18e1c79b2db2f8d/abed6/photo-34607876585_6e59cd762e_o.png 1500w"],"sizes":["(max-width:","800px)","100vw,","800px"]},"children":[]},{"type":"text","value":"\n  "}]},{"type":"text","value":"\n  "}]}]},{"type":"text","value":"\n"},{"type":"comment","value":" TOC "},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"#bare-metal-considerations"},"children":[{"type":"text","value":"Bare-metal considerations"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"#network-load-balancer-metallb"},"children":[{"type":"text","value":"Network Load-balancer MetalLB"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"#installation-with-kubernetes-manifests"},"children":[{"type":"text","value":"Installation With Kubernetes Manifests"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"#metallb-configuration"},"children":[{"type":"text","value":"MetalLB Configuration"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"#layer-2-configuration"},"children":[{"type":"text","value":"Layer 2 Configuration"}]}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"comment","value":" /TOC "},{"type":"text","value":"\n"},{"type":"element","tagName":"blockquote","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"DRAFT - this article is still undergoing some “research”…"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{"id":"bare-metal-considerations"},"children":[{"type":"element","tagName":"a","properties":{"href":"#bare-metal-considerations","ariaLabel":"bare metal considerations permalink","className":["anchor"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"Bare-metal considerations"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"In traditional cloud environments, where network load balancers are available on-demand, a single Kubernetes manifest suffices to provide a single point of contact to the NGINX Ingress controller to external clients and, indirectly, to any application running inside the cluster. "},{"type":"element","tagName":"a","properties":{"href":"https://kubernetes.github.io/ingress-nginx/deploy/baremetal/"},"children":[{"type":"text","value":"Bare-metal environments"}]},{"type":"text","value":" lack this commodity, requiring a slightly different setup to offer the same kind of access to external consumers. The rest of this article describes a few recommended approaches to deploying the "},{"type":"element","tagName":"a","properties":{"href":"https://github.com/kubernetes/ingress-nginx"},"children":[{"type":"text","value":"NGINX Ingress controller"}]},{"type":"text","value":" inside a Kubernetes cluster running on bare-metal."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{"id":"network-load-balancer-metallb"},"children":[{"type":"element","tagName":"a","properties":{"href":"#network-load-balancer-metallb","ariaLabel":"network load balancer metallb permalink","className":["anchor"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"Network Load-balancer MetalLB"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://metallb.universe.tf/concepts/"},"children":[{"type":"text","value":"MetalLB"}]},{"type":"text","value":" hooks into your Kubernetes cluster, and provides a network load-balancer implementation. In short, it allows you to create Kubernetes services of type “LoadBalancer” in clusters that don’t run on a cloud provider, and thus cannot simply hook into paid products to provide load-balancers."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"It has two features that work together to provide this service: address allocation, and external announcement:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"Address Allocation"}]},{"type":"text","value":": In a cloud-enabled Kubernetes cluster, you request a load-balancer, and your cloud platform assigns an IP address to you. In a bare metal cluster, MetalLB is responsible for that allocation."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"External Announcement"}]},{"type":"text","value":": Once MetalLB has assigned an external IP address to a service, it needs to make the network beyond the cluster aware that the IP “lives” in the cluster. MetalLB uses standard routing protocols to achieve this: ARP, NDP, or BGP."}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Before starting with installation, make sure you meet all the "},{"type":"element","tagName":"a","properties":{"href":"https://metallb.universe.tf/#requirements"},"children":[{"type":"text","value":"requirements"}]},{"type":"text","value":"."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{"id":"installation-with-kubernetes-manifests"},"children":[{"type":"element","tagName":"a","properties":{"href":"#installation-with-kubernetes-manifests","ariaLabel":"installation with kubernetes manifests permalink","className":["anchor"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"Installation With Kubernetes Manifests"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"To install MetalLB, simply apply the manifest:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"bash"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-bash"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-bash"]},"children":[{"type":"text","value":"kubectl apply -f https://raw.githubusercontent.com/google/metallb/v0.7.3/manifests/metallb.yaml"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"This will deploy MetalLB to your cluster, under the metallb-system namespace. The components in the manifest are:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"The "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"metallb-system/controller deployment"}]},{"type":"text","value":". This is the cluster-wide controller that handles IP address assignments."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"The "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"metallb-system/speaker daemonset"}]},{"type":"text","value":". This is the component that speaks the protocol(s) of your choice to make the services reachable."}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The installation manifest does not include a configuration file. MetalLB’s components will still start, but will remain idle until you define and deploy a configmap."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{"id":"metallb-configuration"},"children":[{"type":"element","tagName":"a","properties":{"href":"#metallb-configuration","ariaLabel":"metallb configuration permalink","className":["anchor"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"MetalLB Configuration"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"To configure MetalLB, write a config map to "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"metallb-system/config"}]},{"type":"text","value":" like "},{"type":"element","tagName":"a","properties":{"href":"https://raw.githubusercontent.com/google/metallb/v0.7.3/manifests/example-config.yaml"},"children":[{"type":"text","value":"this example"}]},{"type":"text","value":":"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"yaml"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"apiVersion"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" v1\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"kind"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" ConfigMap\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"metadata"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"namespace"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" metallb"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"system\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"name"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" config\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"data"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"config"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"|"}]},{"type":"element","tagName":"span","properties":{"className":["token","scalar","string"]},"children":[{"type":"text","value":"\n    # The peers section tells MetalLB what BGP routers to connect too. There\n    # is one entry for each router you want to peer with.\n    peers:\n    - # The target IP address for the BGP session.\n      peer-address: 10.0.0.1\n      # The BGP AS number that MetalLB expects to see advertised by\n      # the router.\n      peer-asn: 64512\n      # The BGP AS number that MetalLB should speak as.\n      my-asn: 64512\n      # (optional) the TCP port to talk to. Defaults to 179, you shouldn't\n      # need to set this in production.\n      peer-port: 179\n      # (optional) The proposed value of the BGP Hold Time timer. Refer to\n      # BGP reference material to understand what setting this implies.\n      hold-time: 120\n      # (optional) The router ID to use when connecting to this peer. Defaults\n      # to the node IP address. Generally only useful when you need to peer with\n      # another BGP router running on the same machine as MetalLB.\n      router-id: 1.2.3.4\n      # (optional) Password for TCPMD5 authenticated BGP sessions\n      # offered by some peers.\n      password: \"yourPassword\"\n      # (optional) The nodes that should connect to this peer. A node\n      # matches if at least one of the node selectors matches. Within\n      # one selector, a node matches if all the matchers are\n      # satisfied. The semantics of each selector are the same as the\n      # label- and set-based selectors in Kubernetes, documented at\n      # https://kubernetes.io/docs/concepts/overview/working-with-objects/labels/.\n      # By default, all nodes are selected.\n      node-selectors:\n      - # Match by label=value\n        match-labels:\n          kubernetes.io/hostname: prod-01\n        # Match by 'key OP values' expressions\n        match-expressions:\n        - key: beta.kubernetes.io/arch\n          operator: In\n          values: [amd64, arm]"}]},{"type":"text","value":"\n\n    "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"# The address-pools section lists the IP addresses that MetalLB is"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"# allowed to allocate, along with settings for how to advertise"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"# those addresses over BGP once assigned. You can have as many"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"# address pools as you want."}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"address-pools"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"# A name for the address pool. Services can request allocation"}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"# from a specific address pool using this name, by listing this"}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"# name under the 'metallb.universe.tf/address-pool' annotation."}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"name"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" my"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"ip"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"space\n      "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"# Protocol can be used to select how the announcement is done."}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"# Supported values are bgp and layer2."}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"protocol"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" bgp\n      \n      "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"# A list of IP address ranges over which MetalLB has"}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"# authority. You can list multiple ranges in a single pool, they"}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"# will all share the same settings. Each range can be either a"}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"# CIDR prefix, or an explicit start-end range of IPs."}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"addresses"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" 198.51.100.0/24\n      "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" 192.168.0.150"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"192.168.0.200\n      "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"# (optional) If true, MetalLB will not allocate any address that"}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"# ends in .0 or .255. Some old, buggy consumer devices"}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"# mistakenly block traffic to such addresses under the guise of"}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"# smurf protection. Such devices have become fairly rare, but"}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"# the option is here if you encounter serving issues."}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"avoid-buggy-ips"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","boolean","important"]},"children":[{"type":"text","value":"true"}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"# (optional, default true) If false, MetalLB will not automatically"}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"# allocate any address in this pool. Addresses can still explicitly"}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"# be requested via loadBalancerIP or the address-pool annotation."}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"auto-assign"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","boolean","important"]},"children":[{"type":"text","value":"false"}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"# (optional) A list of BGP advertisements to make, when"}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"# protocol=bgp. Each address that gets assigned out of this pool"}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"# will turn into this many advertisements. For most simple"}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"# setups, you'll probably just want one."}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"#"}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"# The default value for this field is a single advertisement with"}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"# all parameters set to their respective defaults."}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"bgp-advertisements"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"# (optional) How much you want to aggregate up the IP address"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"# before advertising. For example, advertising 1.2.3.4 with"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"# aggregation-length=24 would end up advertising 1.2.3.0/24."}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"# For the majority of setups, you'll want to keep this at the"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"# default of 32, which advertises the entire IP address"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"# unmodified."}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"aggregation-length"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"32"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"# (optional) The value of the BGP \"local preference\" attribute"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"# for this advertisement. Only used with IBGP peers,"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"# i.e. peers where peer-asn is the same as my-asn."}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"localpref"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"100"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"# (optional) BGP communities to attach to this"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"# advertisement. Communities are given in the standard"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"# two-part form <asn>:<community number>. You can also use"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"# alias names (see below)."}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"communities"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" 64512"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"1"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" no"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"export\n    "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"# (optional) BGP community aliases. Instead of using hard to"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"# read BGP community numbers in address pool advertisement"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"# configurations, you can define alias names here and use those"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"# elsewhere in the configuration. The \"no-export\" community used"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"# above is defined below."}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"bgp-communities"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"# no-export is a well-known BGP community that prevents"}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"# re-advertisement outside of the immediate autonomous system,"}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"# but people don't usually recognize its numerical value. :)"}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"no-export"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" 65535"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"65281"}]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{"id":"layer-2-configuration"},"children":[{"type":"element","tagName":"a","properties":{"href":"#layer-2-configuration","ariaLabel":"layer 2 configuration permalink","className":["anchor"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"Layer 2 Configuration"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://metallb.universe.tf/tutorial/layer2/"},"children":[{"type":"text","value":"Layer 2 mode"}]},{"type":"text","value":" is the simplest to configure. The nice thing about layer 2 mode is that you don’t need any fancy network hardware at all, it should just work on any ethernet network. For example, the following configuration gives MetalLB control over IPs from "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"192.168.1.240"}]},{"type":"text","value":" to "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"192.168.1.250"}]},{"type":"text","value":", and configures "},{"type":"element","tagName":"a","properties":{"href":"https://metallb.universe.tf/configuration/#layer-2-configuration"},"children":[{"type":"text","value":"Layer 2 mode"}]},{"type":"text","value":":"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"yaml"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"apiVersion"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" v1\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"kind"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" ConfigMap\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"metadata"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"namespace"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" metallb"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"system\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"name"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" config\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"data"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"config"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"|"}]},{"type":"element","tagName":"span","properties":{"className":["token","scalar","string"]},"children":[{"type":"text","value":"\n    address-pools:\n    - name: default\n      protocol: layer2\n      addresses:\n      - 192.168.1.240-192.168.1.250"}]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"hr","properties":{},"children":[]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"img","properties":{"src":"./kubernetes_logging_04.png","alt":"A Kubernetes Cluster & Microservices"},"children":[]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"hr","properties":{},"children":[]}],"data":{"quirksMode":false}},"fields":{"slug":"/kubernetes-bare-metal-ingress/","prefix":"2019-01-21"},"frontmatter":{"title":"Kubernetes Bare Metal Ingress","subTitle":"Red Hat Enterprise and Centos Linux Server Administration","cover":{"childImageSharp":{"resize":{"src":"/static/0df3ee82db4a6571ae35fedc5657ee74/152f9/photo-34607876585_6e59cd762e_o-cover.png"}}}}},"author":{"id":"9c69de06-11ab-55c9-b52a-3cc0b2f51365","html":"<p><strong>Mike Polinowski</strong> Proin ornare ligula eu tellus tempus elementum. Aenean <a href=\"/contact/\">contact me</a> iaculis mi, nec blandit lacus interdum vitae. Vestibulum non nibh risus, a scelerisque purus. :hearts:</p>"},"footnote":{"id":"24817670-3434-5a21-9de1-e9fab89708d7","html":"<ul>\n<li>This is a personal Developer Blog</li>\n<li>Ξ</li>\n<li>built by <a href=\"https://github.com/mpolinowski\">Mike Polinowski</a></li>\n<li>Ξ</li>\n<li>with <a href=\"https://www.gatsbyjs.org/\">Gatsby</a> &#x26; <a href=\"https://reactjs.org\">React</a></li>\n<li>Ξ</li>\n<li>source code on <a href=\"https://github.com/mpolinowski/mpolinowski.github.io\">GitHub</a></li>\n<li>Ξ</li>\n<li>deliverd by <a href=\"https://pages.github.com\">Github Pages</a></li>\n<li>Ξ</li>\n<li>photos from <a href=\"https://www.flickr.com/people/149680084@N06/\">Flickr</a></li>\n</ul>"}},"pageContext":{"slug":"/kubernetes-bare-metal-ingress/"}}