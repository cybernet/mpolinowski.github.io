{"data":{"post":{"id":"192817e9-5b63-5137-a5a3-cdf9ed522f70","html":"<p><a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/1437e941328bcc77e312cf8c19e062d6/abed6/photo-76834w36_4356dfgdsds_o.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 800px;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 44.4%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAA7EAAAOxAGVKw4bAAACc0lEQVQozxWQ3U9SARyGuU7lGzyCwBEOiol8iIoJJqERCAF6INMSvy1NEReYps1VlrVc5XRdtNZszs111bxq66ar1n/1dLr8vRfP+z4/lWgxEe/pYKEQIz3s59ePCyqFDBm/i53pNCtyhsp4nurMPV5XNzn9+o3vl5ds7e2y//4Dq+s1Ir0BXFIjOrMGlWg1Ewm4mR8bYSE/xsHGBivDMebkPHsH+6zNTVK8FSc7FGN5dY3i/BLJvExpukRByeVrPST7AvT53LQ6WlBdNRlZ7vISCwZJ9SdIdA1SCPvpCXnJyVnulMbI5AbQG/UMRiNEUnniQzc4fFwjG0vR3zNMZvA24UCEkD+KyqLTsXU9wqKcY6WY5+1SnpP1WZ7ezxHobCMR6eZ0b5XjcomTqQVm05NUZqb48myf54sV5O4oCamdSEcQQasoe+xmysqS6fEEL6sy5x8n+H2xy9mLJ3QYzBSTWf5+XubPUYGf23O8m8pzqJSV5TFGB4Zo0xvwNzXR2+LELwioWgQ9TmsjzSY1ybCTpVw7D1M+5oZH2IzG6HK6Odrf5vzTG86eH3Bc2+LRaJFXKzsE2wJ0+fpwNDtQ19Uh6HWo6uvruaIcJp0GQafGbjbiFUWaLQ78CqzbIVJIZRlPF+kNhKg8WCdzM011ocxEIkmmP6bohtFq69FoG1Bp1A3oNGo0mgZMei3W/8AWCVeTHY/NTtAl4REdJAfDeCUBwVCH22ZkwGejVuikFG/lbiioaFsRDSZURqMJk9mMJDoxKP/Qa9WIQiM+BRqQ3HQqQMluw9Pqwuv14pRc2BwORNFOyGMj1GrBpxS1WazY9QL/AJMkPnqn8LoQAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n    ></span>\n    <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px transparent;\"\n        alt=\"Shenzhen, China\"\n        title=\"\"\n        src=\"/static/1437e941328bcc77e312cf8c19e062d6/de8ec/photo-76834w36_4356dfgdsds_o.png\"\n        srcset=\"/static/1437e941328bcc77e312cf8c19e062d6/81654/photo-76834w36_4356dfgdsds_o.png 200w,\n/static/1437e941328bcc77e312cf8c19e062d6/3601a/photo-76834w36_4356dfgdsds_o.png 400w,\n/static/1437e941328bcc77e312cf8c19e062d6/de8ec/photo-76834w36_4356dfgdsds_o.png 800w,\n/static/1437e941328bcc77e312cf8c19e062d6/4c3ca/photo-76834w36_4356dfgdsds_o.png 1200w,\n/static/1437e941328bcc77e312cf8c19e062d6/abed6/photo-76834w36_4356dfgdsds_o.png 1500w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n      />\n  </span>\n  </a></p>\n<!-- TOC -->\n<ul>\n<li><a href=\"#prerequisites\">Prerequisites</a></li>\n<li><a href=\"#installing-docker\">Installing Docker</a></li>\n<li><a href=\"#installing-kubernetes\">Installing Kubernetes</a></li>\n</ul>\n<!-- /TOC -->\n<blockquote>\n<p>DRAFT - this article is still undergoing some “research”…</p>\n</blockquote>\n<p>When trying to run a Kubernetes cluster in China you quickly realize that 404s will take away the fun from it. This tutorial is based on a <a href=\"https://github.com/mpolinowski/kubernetes-for-china\">Github repository</a> but re-written to cater for CentOS servers.</p>\n<h2 id=\"prerequisites\"><a href=\"#prerequisites\" aria-label=\"prerequisites permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Prerequisites</h2>\n<p>Install required packages. yum-utils provides the yum-config-manager utility, and device-mapper-persistent-data and lvm2 are required by the device mapper storage driver:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> yum <span class=\"token function\">install</span> -y yum-utils device-mapper-persistent-data lvm2\nswapoff -a\nsetenforce 0</code></pre></div>\n<p>Edit the following file to disable <code class=\"language-text\">nano /etc/sysconfig/selinux</code> SELinux - <code class=\"language-text\">SELINUX=disabled</code>.</p>\n<p>And for <strong>iptables</strong> create the following file <code class=\"language-text\">nano /etc/sysctl.d/k8s.conf</code> with the content below:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">net.bridge.bridge-nf-call-ip6tables <span class=\"token operator\">=</span> 1\n\nnet.bridge.bridge-nf-call-iptables <span class=\"token operator\">=</span> 1</code></pre></div>\n<p>And apply those changes with the following command <code class=\"language-text\">sysctl --system</code>.</p>\n<h2 id=\"installing-docker\"><a href=\"#installing-docker\" aria-label=\"installing docker permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Installing Docker</h2>\n<p>Now we can <a href=\"https://docs.docker.com/install/linux/docker-ce/centos/\">install DockerCE</a> using the Aliyun cloud mirror.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">curl</span> -fsSL https://get.docker.com <span class=\"token operator\">|</span> <span class=\"token function\">bash</span> -s docker --mirror Aliyun</code></pre></div>\n<p><a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/934a8d66f59ef414dd7eb6e2317ad315/5d97e/Kubernetes-Aliyun-01.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 800px;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 59.82694684796045%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABiElEQVQoz3WSjW6rMAyFeYFBSVL6s92WkXYlJE7iBOh2pav7/m81G3VbNW3SJ+so6NiHOIXwWL+Oa4chJyRsSGfA3iftmAtwPUPWkJ6d2ph7CuFi/TaJlOQ8qtdp/eKbp6HZDRvZL1xuVfXNuleNYe7MKP5OIudqGst5rFxcdbDSsDp75sWvTovuoN4Pcj8o4tNMY+t/swrYBdQQNVXCo44LKWlEjYm+nozft0607m5yTPV1UjmZgL0NfU49JhY2Gu1Ma03rzMH2rXUHe9j0Qn2FJzOKKYt5fLiOD29TCVh5LF0sQyptrBxpLD1Wl1BpqJ9BdaCOVh0s+Qt2jll6lBFlTizChxiiBGRBmKBskGfPnIBQR1dIG3n4QHUxaJBHR6jH5WK2C5/r2Q23ky3rQmCq6bbnkStE2YGkK1lSfdvqDWr6ZJmvPU8jhedt00ug9rvhZycN/GMlQd23ZKbYIXFsEwQgN/5t5mKmXJxOA8emtymGQM24K72hze/OhjOLlOkH6/9XGv4ObIdgr8Yi6KwAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    ></span>\n    <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px transparent;\"\n        alt=\"Kubernetes Aliyun\"\n        title=\"\"\n        src=\"/static/934a8d66f59ef414dd7eb6e2317ad315/de8ec/Kubernetes-Aliyun-01.png\"\n        srcset=\"/static/934a8d66f59ef414dd7eb6e2317ad315/81654/Kubernetes-Aliyun-01.png 200w,\n/static/934a8d66f59ef414dd7eb6e2317ad315/3601a/Kubernetes-Aliyun-01.png 400w,\n/static/934a8d66f59ef414dd7eb6e2317ad315/de8ec/Kubernetes-Aliyun-01.png 800w,\n/static/934a8d66f59ef414dd7eb6e2317ad315/5d97e/Kubernetes-Aliyun-01.png 809w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n      />\n  </span>\n  </a></p>\n<p>Now you can start and enable the Docker service, to have it automatically run in the background when you start your server:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">systemctl start docker\nsystemctl <span class=\"token function\">enable</span> docker</code></pre></div>\n<p><a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/b67c62f43b1ae1cb5bd6473099c10ae5/d7315/Kubernetes-Aliyun-02.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 800px;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 13.591022443890274%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAIAAAAcOLh5AAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAgElEQVQI103IaQ6CMBCG4d5A6UYoP7RIsC2dkm5AXO5/LSuoMXkyme9F+D4fwEMMjxzWcVqNu2knucJcM64pUx/l3/0KUwg/52NOQwh+iS5HWKJP4Ty4SlraAblseiCysPRkSYlF7wpU5YSvE5NQC1M35n2FYa2hYtN+7bP57+MLEesYMHDKHUwAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    ></span>\n    <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px transparent;\"\n        alt=\"Kubernetes Aliyun\"\n        title=\"\"\n        src=\"/static/b67c62f43b1ae1cb5bd6473099c10ae5/de8ec/Kubernetes-Aliyun-02.png\"\n        srcset=\"/static/b67c62f43b1ae1cb5bd6473099c10ae5/81654/Kubernetes-Aliyun-02.png 200w,\n/static/b67c62f43b1ae1cb5bd6473099c10ae5/3601a/Kubernetes-Aliyun-02.png 400w,\n/static/b67c62f43b1ae1cb5bd6473099c10ae5/de8ec/Kubernetes-Aliyun-02.png 800w,\n/static/b67c62f43b1ae1cb5bd6473099c10ae5/d7315/Kubernetes-Aliyun-02.png 802w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n      />\n  </span>\n  </a></p>\n<h2 id=\"installing-kubernetes\"><a href=\"#installing-kubernetes\" aria-label=\"installing kubernetes permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Installing Kubernetes</h2>\n<p>Kubernetes can be installed from the <a href=\"https://opsx.alibaba.com/mirror\">Alibaba Mirror</a> which holds both a <a href=\"https://mirrors.aliyun.com/kubernetes/apt/\">Debian/Ubuntu (apt)</a> as well as a <a href=\"https://mirrors.aliyun.com/kubernetes/yum/\">RHEL/CentOS (yum)</a> version. For CentOS their currently <a href=\"https://mirrors.aliyun.com/kubernetes/yum/repos/\">two versions hosted</a>, el6 and el7, for RHEL6/CentOS6 and REHL7/CentOS7, respectively:</p>\n<p><a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/a402bb3b10bec6183e7f34a570c2d147/5d97e/Kubernetes-Aliyun-03.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 800px;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 43.63411619283065%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABCklEQVQoz3WRfWuDMBDG/f7fa6iMtcytMWo1igNZTCxGjYl52VLL6vzDh+PIcfe7J3AehHFd11H06ZSkCYzjsqogTNwLAND37OdY3jQNQvB5nsaRDQPr3ThzmQ333GutrbX6QB79njss2obP3Cq1beWcd7cbJWQcRlfaVcYY+09e4Mv38xK8iDTTTWOecNtimGZZmmKMn7DDd98+nxQA+u1VlaXGrbF/ja6jqKpKhCjtHvBjww72/SWKdBgqhDTGG0wpyfK8KHJC6aEz/GBXOMHL8FUvhJh1bnWmpEAlKgq6g/fOYbAE4QIuSkorxNZzzte7cU7IsTNjysU4Kmu0MdsZpBR8lRDy6FS/5OMC8phhJngAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    ></span>\n    <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px transparent;\"\n        alt=\"Kubernetes Aliyun\"\n        title=\"\"\n        src=\"/static/a402bb3b10bec6183e7f34a570c2d147/de8ec/Kubernetes-Aliyun-03.png\"\n        srcset=\"/static/a402bb3b10bec6183e7f34a570c2d147/81654/Kubernetes-Aliyun-03.png 200w,\n/static/a402bb3b10bec6183e7f34a570c2d147/3601a/Kubernetes-Aliyun-03.png 400w,\n/static/a402bb3b10bec6183e7f34a570c2d147/de8ec/Kubernetes-Aliyun-03.png 800w,\n/static/a402bb3b10bec6183e7f34a570c2d147/5d97e/Kubernetes-Aliyun-03.png 809w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n      />\n  </span>\n  </a></p>\n<p>On CentOS 7 we have to install the el7 version by adding the repository <code class=\"language-text\">nano /etc/yum.repos.d/kubernetes.repo</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token punctuation\">[</span>kubernetes<span class=\"token punctuation\">]</span>\nname=Kubernetes\nbaseurl=https<span class=\"token punctuation\">:</span>//mirrors.aliyun.com/kubernetes/yum/repos/kubernetes<span class=\"token punctuation\">-</span>el7<span class=\"token punctuation\">-</span>x86_64\nenabled=1\ngpgcheck=0</code></pre></div>\n<blockquote>\n<p><strong>NOTE</strong>: The following installation fails when you activate the <em>gpgcheck</em>. Re-running the installation after setting <em>gpgcheck=0</em> “solved” this. I find this slightly troublesome, but will proceed for now - since this is just a local test server environment.</p>\n</blockquote>\n<p><a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/55d1ddb61d88cef3acab558057bcc764/e0a77/Kubernetes-Aliyun-04.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 800px;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 14.1439205955335%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAIAAAAcOLh5AAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAbElEQVQI12PgDXXiDXHiDXXmDXcBoUBHvgBHPj8HMLLn87UHMniDnHgjXDARg6CVqbC2gYi0loiUFoiU1RaR04aSQCSvLSKjDRKX1hIVUhMVREEMgibGwsq6YJ3aUARULaMFRjCdELaEJhoCAPslGtGZWC+kAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n    ></span>\n    <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px transparent;\"\n        alt=\"Kubernetes Aliyun\"\n        title=\"\"\n        src=\"/static/55d1ddb61d88cef3acab558057bcc764/de8ec/Kubernetes-Aliyun-04.png\"\n        srcset=\"/static/55d1ddb61d88cef3acab558057bcc764/81654/Kubernetes-Aliyun-04.png 200w,\n/static/55d1ddb61d88cef3acab558057bcc764/3601a/Kubernetes-Aliyun-04.png 400w,\n/static/55d1ddb61d88cef3acab558057bcc764/de8ec/Kubernetes-Aliyun-04.png 800w,\n/static/55d1ddb61d88cef3acab558057bcc764/e0a77/Kubernetes-Aliyun-04.png 806w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n      />\n  </span>\n  </a></p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">rpm --import https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg\nyum update\nyum <span class=\"token function\">install</span> -y kubelet kubeadm kubectl</code></pre></div>\n<p><a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/e5edfca2e3a958feaecb70707fdecdae/8b662/Kubernetes-Aliyun-05.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 800px;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 35.0920245398773%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAIAAACHqfpvAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABA0lEQVQY03WQi2qEMBBF/YJd847bdt2KpiZONMb46IOy9P8/qoktlC0sXIYhzL05MxnxU/65cuuus/9a/db1vrEhqoJQ26BsqvvLXFtXAReaCM2EwbzJSD+i9wVPU77N+Vs4qv5QwuEJjkwfWXsrnTNNeUtZS7neze2Atxk7j9yIRk+egdI2TQhN0w+3KjQ9d6TsaAmYNRleAvpYYoS4gDwZ+WCkNLIwqS8M2yP+VBiievLSk9Gjss1ImPLrSsPUrWF4DQMMroFBWVfDWHWPUuN/fvaDbZBQGTEuYcekJeAtRARyAXKGuBUVdyRjNShhg4vY0bZvPtKToekq952/tzCIq2+xvjb3qP2PpgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    ></span>\n    <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px transparent;\"\n        alt=\"Kubernetes Aliyun\"\n        title=\"\"\n        src=\"/static/e5edfca2e3a958feaecb70707fdecdae/de8ec/Kubernetes-Aliyun-05.png\"\n        srcset=\"/static/e5edfca2e3a958feaecb70707fdecdae/81654/Kubernetes-Aliyun-05.png 200w,\n/static/e5edfca2e3a958feaecb70707fdecdae/3601a/Kubernetes-Aliyun-05.png 400w,\n/static/e5edfca2e3a958feaecb70707fdecdae/de8ec/Kubernetes-Aliyun-05.png 800w,\n/static/e5edfca2e3a958feaecb70707fdecdae/8b662/Kubernetes-Aliyun-05.png 815w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n      />\n  </span>\n  </a></p>\n<p>As described above - this install failed du to the active key check. Going back to <code class=\"language-text\">nano /etc/yum.repos.d/kubernetes.repo</code> and setting <code class=\"language-text\">gpgcheck=0</code> solved this for now:</p>\n<p><a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/84413ef58af5f3ecc05fe873e257c9a4/e0a77/Kubernetes-Aliyun-06.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 800px;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 20.347394540942926%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAIAAAABPYjBAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAo0lEQVQI1y2PjQ6CMAyEeYW1RdTwp4LZTzcYiNH3fzFbJLksl12/W1eAmyAvOERsAzWBTlaEPeM9Uh+pDnTxhBZrjx3Lvc40TGdHlSuQZ/PZYFnMe4Uwa8uQqGWqvUzgmIBncLNEYjT9VxzwM5nvBlOW981rhZTxEaljunoiq3DKiokkGpNK2qsdBs4K3GRtplJ2dsd50lg9WmlRiSl3ydd2+Aeb+h4W2lVxvgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    ></span>\n    <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px transparent;\"\n        alt=\"Kubernetes Aliyun\"\n        title=\"\"\n        src=\"/static/84413ef58af5f3ecc05fe873e257c9a4/de8ec/Kubernetes-Aliyun-06.png\"\n        srcset=\"/static/84413ef58af5f3ecc05fe873e257c9a4/81654/Kubernetes-Aliyun-06.png 200w,\n/static/84413ef58af5f3ecc05fe873e257c9a4/3601a/Kubernetes-Aliyun-06.png 400w,\n/static/84413ef58af5f3ecc05fe873e257c9a4/de8ec/Kubernetes-Aliyun-06.png 800w,\n/static/84413ef58af5f3ecc05fe873e257c9a4/e0a77/Kubernetes-Aliyun-06.png 806w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n      />\n  </span>\n  </a></p>\n<!--\n\n\n本来打算搭建istio环境，然后默置安装了kubernetes1.5.2集群，结果RBAC模式不被支持，然后切换到kubernetes1.7.5。\n\n祝你好运吧！\n\n一、基础环境配置，以下环境基于Docker\n\nmaster和slave的kubernetes yum源必须都修改\n\nvi /etc/yum.repos.d/kubernetes.repo\n\n[kubernetes]\nname=Kubernetes\nbaseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64\nenabled=1\ngpgcheck=0\n\n(1)关闭swap\n\nswapoff -a\n\n(2)关闭SELinux，修改SELINUX属性\n\nsetenforce 0\n\nvi /etc/sysconfig/selinux\n\nSELINUX=disabled    \n\n(3)设置iptables\n\nvi /etc/sysctl.d/k8s.conf\n\nnet.bridge.bridge-nf-call-ip6tables = 1\n\nnet.bridge.bridge-nf-call-iptables = 1\n\n同iptables\n\nsysctl --system\n\n[1]以防在kubeadm init时出现如下错误\n\n[kubeadm] WARNING: kubeadm is in beta, please do not use it for production clusters.\n[init] Using Kubernetes version: v1.7.5\n[init] Using Authorization modes: [Node RBAC]\n[preflight] Running pre-flight checks\n[preflight] WARNING: kubelet service is not enabled, please run 'systemctl enable kubelet.service'\n[preflight] WARNING: docker service is not enabled, please run 'systemctl enable docker.service'\n[preflight] Some fatal errors occurred:\n    /proc/sys/net/bridge/bridge-nf-call-iptables contents are not set to 1\n\n(4)安装socat\n\nyum install -y socat\n\nrpm -qa|grep socat\n\nsystemctl enable socat\n\n\n二、安装kubernetes集群\n\nMaster:安装master\n\n1、检查docker，如果没有安装docker,请看前面docker系列\n\ndocker version\n\n2、安装kubectl、kubelet、kubeadm [yum源的问题使用阿里云的可以获取]\n\nyum install -y kubelet kubeadm kubectl\n\n(2)启动kubelet\n\nsystemctl start kubelet\n\nsystemctl status kubelet #查看是否启动成功\n\n注意：[有人说要先修改/etc/systemd/system/kubelet.service.d/10-kubeadm.conf下参数，我修改后发现kubelet无法启动]\n\n(3)初始化master\n\nkubeadm init --apiserver-advertise-address=192.168.117.132 --pod-network-cidr=192.168.0.0/16 --kubernetes-version=v1.7.5 --skip-preflight-checks\n\n参数说明：\n\n[1]--kubernetes-version=v1.7.5，如果不加版本号会导致报错\n\n[kubeadm] WARNING: kubeadm is in beta, please do not use it for production clusters.unable to get URL \"https://storage.googleapis.com/kubernetes-release/release/stable-1.7.txt\": Get https://storage.googleapis.com/kubernetes-release/release/stable-1.7.txt: net/http: TLS handshake timeout\n\n或者\n\n[kubeadm] WARNING: kubeadm is in beta, please do not use it for production clusters.\nunable to get URL \"https://storage.googleapis.com/kubernetes-release/release/stable-1.7.txt\": Get https://storage.googleapis.com/kubernetes-release/release/stable-1.7.txt: dial tcp 172.217.160.112:443: getsockopt: connection refused\n[2]--skip-preflight-checks，可以防止每次初始化都去检查配置文件，否则可能在多次init后报错[etcd在使用、kubelet在使\n\n用，因为每次init，kubeadm其实都会去启动etcd/kubelet]\n\n[3]还有可能出现的错误是镜像错误\n\n初始化一直卡在[apiclient] Created API client, waiting for the control plane to become ready\n\n或者\n\nUnfortunately, an error has occurred:\n    timed out waiting for the condition\n\nThis error is likely caused by that:\n    - The kubelet is not running\n    - The kubelet is unhealthy due to a misconfiguration of the node in some way (required cgroups disabled)\n    - There is no internet connection; so the kubelet can't pull the following control plane images:\n        - gcr.io/google_containers/kube-apiserver-amd64:v1.8.4\n        - gcr.io/google_containers/kube-controller-manager-amd64:v1.8.4\n        - gcr.io/google_containers/kube-scheduler-amd64:v1.8.4\n\nYou can troubleshoot this for example with the following commands if you're on a systemd-powered system:\n    - 'systemctl status kubelet'\n    - 'journalctl -xeu kubelet'\ncouldn't initialize a Kubernetes cluster\n\n{网上有人提出了一个很好的方法，就是先把需要的镜像下载下来改tag名，但是可能导致镜像不匹配问题}\n\ndocker pull docker.io/sylzd/etcd-amd64-3.0.17\ndocker tag docker.io/sylzd/etcd-amd64-3.0.17:latest gcr.io/google_containers/etcd-amd64:3.0.17\ndocker pull registry.cn-hangzhou.aliyuncs.com/google-containers/kube-apiserver-amd64:v1.7.5\ndocker tag registry.cn-hangzhou.aliyuncs.com/google-containers/kube-apiserver-amd64:v1.7.5 gcr.io/google_containers/kube-apiserver-amd64:v1.7.5\ndocker pull registry.cn-hangzhou.aliyuncs.com/google-containers/kube-controller-manager-amd64:v1.7.5\ndocker tag registry.cn-hangzhou.aliyuncs.com/google-containers/kube-controller-manager-amd64:v1.7.5 gcr.io/google_containers/kube-controller-manager-amd64:v1.7.5\ndocker pull registry.cn-hangzhou.aliyuncs.com/google-containers/kube-scheduler-amd64:v1.7.5\ndocker tag registry.cn-hangzhou.aliyuncs.com/google-containers/kube-scheduler-amd64:v1.7.5 gcr.io/google_containers/kube-scheduler-amd64:v1.7.5\n\ndocker pull visenzek8s/pause-amd64:3.0\ndocker tag visenzek8s/pause-amd64:3.0 gcr.io/google_containers/pause-amd64:3.0\n\ndocker pull mirrorgooglecontainers/kube-proxy-amd64:v1.7.5\ndocker tag mirrorgooglecontainers/kube-proxy-amd64:v1.7.5 gcr.io/google_containers/kube-proxy-amd64:v1.7.5\n\ndocker pull registry.cn-hangzhou.aliyuncs.com/google-containers/k8s-dns-kube-dns-amd64:1.14.4\ndocker tag registry.cn-hangzhou.aliyuncs.com/google-containers/k8s-dns-kube-dns-amd64:1.14.4 gcr.io/google_containers/k8s-dns-kube-dns-amd64:1.14.4\n\ndocker pull registry.cn-hangzhou.aliyuncs.com/google-containers/k8s-dns-sidecar-amd64:1.14.4\ndocker tag registry.cn-hangzhou.aliyuncs.com/google-containers/k8s-dns-sidecar-amd64:1.14.4 gcr.io/google_containers/k8s-dns-sidecar-amd64:1.14.4\n\ndocker pull mirrorgooglecontainers/k8s-dns-dnsmasq-nanny-amd64:1.14.4\ndocker tag mirrorgooglecontainers/k8s-dns-dnsmasq-nanny-amd64:1.14.4 gcr.io/google_containers/k8s-dns-dnsmasq-nanny-amd64:1.14.4\n\ndocker pull quay.io/coreos/flannel  #失败\ndocker pull quay.io/coreos/flannel:v0.9.1-amd64\n\n注意：只有出现以下提示才是搭建成功（记住提示kubeadm join --token xxxxxxx命令，在slave从服务器上会使用）\n\nkubeadm token list命令也可以查看token，但是可能会有多条记录\n\nYour Kubernetes master has initialized successfully!To start using your cluster, you need to run (as a regular user): mkdir -p $HOME/.kube sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config sudo chown $(id -u):$(id -g) $HOME/.kube/configYou should now deploy a pod network to the cluster.Run \"kubectl apply -f [podnetwork].yaml\" with one of the options listed at: http://kubernetes.io/docs/admin/addons/You can now join any number of machines by running the following on each nodeas root: kubeadm join --token xxxxxxxxx\n\n(4)配置root用户/非root用户模式管理集群\n\nroot模式：\n\nvi /etc/profile\nexport KUBECONFIG=/etc/kubernetes/admin.conf\nsource /etc/profile\n\n普通用户模式：\n\nmkdir -p $HOME/.kube \ncp -i /etc/kubernetes/admin.conf $HOME/.kube/config \nchown $(id -u):$(id -g) $HOME/.kube/config\n\n这一步很关键，否则kubectl监控会报错\n\n(5)网络配置，可以选择Calico、Canal、Flannel、Weave网络模式（有人说Flannel最好用，但是我感觉坑好多），两种配置方式如下：\n\na、先将kube-flannel.yml下载到本地，或者自己创建一个和官网一样的kube-flannel.yml文件，在当前目录执行\n\nkubectl apply -f kube-flannel.yml\n\nb、通过网络执行\n\nkubectl apply -f https://raw.githubusercontent.com/coreos/flannel/v0.9.1/Documentation/kube-flannel.yml\n\n检查flannel是否正常安装启动\n\nkubectl get pods --all-namespaces\n\n注意：如果出现Error、Pending、ImagePullBackOff、CrashLoopBackOff都属于启动失败的Pod，原因需要仔细排除\n\na、查看 /var/log/messages系统日志\n\nb、kubectl describe pod kube-flannel-ds-2wk55 --namespace=kube-system\n\nc、kubectl logs -f kube-dns-2425271678-37lf7 -n kube-system kubedns\n\n(6)默认情况下pod不会被schedule到master节点上\n\nkubectl taint nodes --all node-role.kubernetes.io/master-\n\n报错\n\nnode \"master\" untainted\n\n或者\n\nerror: taint \"node-role.kubernetes.io/master:\" not found\n\n错误\n\n[1]因为我第一次安装的1.5.2没有卸载干净\n\nTransaction check error:\n  file /usr/bin/kubectl from install of kubectl-1.7.5-0.x86_64 conflicts with file from package kubernetes-client-1.5.2-0.7.git269f928.el7.x86_64\n\nSlave:安装slave从服务器\n\n1、操作和以上基础操作(1)、(2)、(3)一样\n\n2、将master中一些镜像导出，然后导入到slave中\n\ndocker save -o /opt/kube-pause.tar gcr.io/google_containers/pause-amd64:3.0\ndocker save -o /opt/kube-proxy.tar gcr.io/google_containers/kube-proxy-amd64:v1.7.5\ndocker save -o /opt/kube-flannel.tar quay.io/coreos/flannel:v0.9.1-amd64\ndocker load -i /opt/kube-flannel.tar\ndocker load -i /opt/kube-proxy.tar\ndocker load -i /opt/kube-pause.tar\n\n3、在slave上安装kubeadm，然后执行master init后提示的kubeadm join --token\n\nkubeadm join --token 04c77a.416fb2c7971328af 192.168.117.132:6443\n\n4、切换到master检查子节点是否连接正常\n\nkubectl get nodes\n\n错误\n\n[1][discovery] Failed to request cluster info, will try again: [Get https://192.168.117.132:6443/api/v1/namespaces/kube-public/configmaps/cluster-info: dial tcp 192.168.117.132:6443: getsockopt: no route to host]\n\n原因是master开着防火墙，把防火墙关掉就行了\n\n[2]failed to check server version: Get https://192.168.117.132:6443/version: x509: certificate has expired or is not yet valid\n\n原因是master和slave的时间不同步，这一点和Elasticsearch/Kibana一样，必须时间同步，所以安装ntp就可以了\n\n\n{***坎坎坷坷这一周内，从各种VPN到github，每天晚上回来搭到十二点，终于可以告一段落了，参考了很多文章，回头有时间再详细列出来，各位有什么问题的欢迎指正、交流***}\n\n\n -->","htmlAst":{"type":"root","children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"a","properties":{"className":["gatsby-resp-image-link"],"href":"/static/1437e941328bcc77e312cf8c19e062d6/abed6/photo-76834w36_4356dfgdsds_o.png","style":"display: block","target":"_blank","rel":["noopener"]},"children":[{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-wrapper"],"style":"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 800px;"},"children":[{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-background-image"],"style":"padding-bottom: 44.4%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAA7EAAAOxAGVKw4bAAACc0lEQVQozxWQ3U9SARyGuU7lGzyCwBEOiol8iIoJJqERCAF6INMSvy1NEReYps1VlrVc5XRdtNZszs111bxq66ar1n/1dLr8vRfP+z4/lWgxEe/pYKEQIz3s59ePCyqFDBm/i53pNCtyhsp4nurMPV5XNzn9+o3vl5ds7e2y//4Dq+s1Ir0BXFIjOrMGlWg1Ewm4mR8bYSE/xsHGBivDMebkPHsH+6zNTVK8FSc7FGN5dY3i/BLJvExpukRByeVrPST7AvT53LQ6WlBdNRlZ7vISCwZJ9SdIdA1SCPvpCXnJyVnulMbI5AbQG/UMRiNEUnniQzc4fFwjG0vR3zNMZvA24UCEkD+KyqLTsXU9wqKcY6WY5+1SnpP1WZ7ezxHobCMR6eZ0b5XjcomTqQVm05NUZqb48myf54sV5O4oCamdSEcQQasoe+xmysqS6fEEL6sy5x8n+H2xy9mLJ3QYzBSTWf5+XubPUYGf23O8m8pzqJSV5TFGB4Zo0xvwNzXR2+LELwioWgQ9TmsjzSY1ybCTpVw7D1M+5oZH2IzG6HK6Odrf5vzTG86eH3Bc2+LRaJFXKzsE2wJ0+fpwNDtQ19Uh6HWo6uvruaIcJp0GQafGbjbiFUWaLQ78CqzbIVJIZRlPF+kNhKg8WCdzM011ocxEIkmmP6bohtFq69FoG1Bp1A3oNGo0mgZMei3W/8AWCVeTHY/NTtAl4REdJAfDeCUBwVCH22ZkwGejVuikFG/lbiioaFsRDSZURqMJk9mMJDoxKP/Qa9WIQiM+BRqQ3HQqQMluw9Pqwuv14pRc2BwORNFOyGMj1GrBpxS1WazY9QL/AJMkPnqn8LoQAAAAAElFTkSuQmCC'); background-size: cover; display: block;"},"children":[]},{"type":"text","value":"\n    "},{"type":"element","tagName":"img","properties":{"className":["gatsby-resp-image-image"],"style":"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px transparent;","alt":"Shenzhen, China","title":"","src":"/static/1437e941328bcc77e312cf8c19e062d6/de8ec/photo-76834w36_4356dfgdsds_o.png","srcSet":["/static/1437e941328bcc77e312cf8c19e062d6/81654/photo-76834w36_4356dfgdsds_o.png 200w","/static/1437e941328bcc77e312cf8c19e062d6/3601a/photo-76834w36_4356dfgdsds_o.png 400w","/static/1437e941328bcc77e312cf8c19e062d6/de8ec/photo-76834w36_4356dfgdsds_o.png 800w","/static/1437e941328bcc77e312cf8c19e062d6/4c3ca/photo-76834w36_4356dfgdsds_o.png 1200w","/static/1437e941328bcc77e312cf8c19e062d6/abed6/photo-76834w36_4356dfgdsds_o.png 1500w"],"sizes":["(max-width:","800px)","100vw,","800px"]},"children":[]},{"type":"text","value":"\n  "}]},{"type":"text","value":"\n  "}]}]},{"type":"text","value":"\n"},{"type":"comment","value":" TOC "},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"#prerequisites"},"children":[{"type":"text","value":"Prerequisites"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"#installing-docker"},"children":[{"type":"text","value":"Installing Docker"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"#installing-kubernetes"},"children":[{"type":"text","value":"Installing Kubernetes"}]}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"comment","value":" /TOC "},{"type":"text","value":"\n"},{"type":"element","tagName":"blockquote","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"DRAFT - this article is still undergoing some “research”…"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"When trying to run a Kubernetes cluster in China you quickly realize that 404s will take away the fun from it. This tutorial is based on a "},{"type":"element","tagName":"a","properties":{"href":"https://github.com/mpolinowski/kubernetes-for-china"},"children":[{"type":"text","value":"Github repository"}]},{"type":"text","value":" but re-written to cater for CentOS servers."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{"id":"prerequisites"},"children":[{"type":"element","tagName":"a","properties":{"href":"#prerequisites","ariaLabel":"prerequisites permalink","className":["anchor"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"Prerequisites"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Install required packages. yum-utils provides the yum-config-manager utility, and device-mapper-persistent-data and lvm2 are required by the device mapper storage driver:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"bash"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-bash"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-bash"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"sudo"}]},{"type":"text","value":" yum "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"install"}]},{"type":"text","value":" -y yum-utils device-mapper-persistent-data lvm2\nswapoff -a\nsetenforce 0"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Edit the following file to disable "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"nano /etc/sysconfig/selinux"}]},{"type":"text","value":" SELinux - "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"SELINUX=disabled"}]},{"type":"text","value":"."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"And for "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"iptables"}]},{"type":"text","value":" create the following file "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"nano /etc/sysctl.d/k8s.conf"}]},{"type":"text","value":" with the content below:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"bash"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-bash"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-bash"]},"children":[{"type":"text","value":"net.bridge.bridge-nf-call-ip6tables "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" 1\n\nnet.bridge.bridge-nf-call-iptables "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" 1"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"And apply those changes with the following command "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"sysctl --system"}]},{"type":"text","value":"."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{"id":"installing-docker"},"children":[{"type":"element","tagName":"a","properties":{"href":"#installing-docker","ariaLabel":"installing docker permalink","className":["anchor"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"Installing Docker"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Now we can "},{"type":"element","tagName":"a","properties":{"href":"https://docs.docker.com/install/linux/docker-ce/centos/"},"children":[{"type":"text","value":"install DockerCE"}]},{"type":"text","value":" using the Aliyun cloud mirror."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"bash"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-bash"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-bash"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"curl"}]},{"type":"text","value":" -fsSL https://get.docker.com "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"|"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"bash"}]},{"type":"text","value":" -s docker --mirror Aliyun"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"a","properties":{"className":["gatsby-resp-image-link"],"href":"/static/934a8d66f59ef414dd7eb6e2317ad315/5d97e/Kubernetes-Aliyun-01.png","style":"display: block","target":"_blank","rel":["noopener"]},"children":[{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-wrapper"],"style":"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 800px;"},"children":[{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-background-image"],"style":"padding-bottom: 59.82694684796045%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABiElEQVQoz3WSjW6rMAyFeYFBSVL6s92WkXYlJE7iBOh2pav7/m81G3VbNW3SJ+so6NiHOIXwWL+Oa4chJyRsSGfA3iftmAtwPUPWkJ6d2ph7CuFi/TaJlOQ8qtdp/eKbp6HZDRvZL1xuVfXNuleNYe7MKP5OIudqGst5rFxcdbDSsDp75sWvTovuoN4Pcj8o4tNMY+t/swrYBdQQNVXCo44LKWlEjYm+nozft0607m5yTPV1UjmZgL0NfU49JhY2Gu1Ma03rzMH2rXUHe9j0Qn2FJzOKKYt5fLiOD29TCVh5LF0sQyptrBxpLD1Wl1BpqJ9BdaCOVh0s+Qt2jll6lBFlTizChxiiBGRBmKBskGfPnIBQR1dIG3n4QHUxaJBHR6jH5WK2C5/r2Q23ky3rQmCq6bbnkStE2YGkK1lSfdvqDWr6ZJmvPU8jhedt00ug9rvhZycN/GMlQd23ZKbYIXFsEwQgN/5t5mKmXJxOA8emtymGQM24K72hze/OhjOLlOkH6/9XGv4ObIdgr8Yi6KwAAAAASUVORK5CYII='); background-size: cover; display: block;"},"children":[]},{"type":"text","value":"\n    "},{"type":"element","tagName":"img","properties":{"className":["gatsby-resp-image-image"],"style":"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px transparent;","alt":"Kubernetes Aliyun","title":"","src":"/static/934a8d66f59ef414dd7eb6e2317ad315/de8ec/Kubernetes-Aliyun-01.png","srcSet":["/static/934a8d66f59ef414dd7eb6e2317ad315/81654/Kubernetes-Aliyun-01.png 200w","/static/934a8d66f59ef414dd7eb6e2317ad315/3601a/Kubernetes-Aliyun-01.png 400w","/static/934a8d66f59ef414dd7eb6e2317ad315/de8ec/Kubernetes-Aliyun-01.png 800w","/static/934a8d66f59ef414dd7eb6e2317ad315/5d97e/Kubernetes-Aliyun-01.png 809w"],"sizes":["(max-width:","800px)","100vw,","800px"]},"children":[]},{"type":"text","value":"\n  "}]},{"type":"text","value":"\n  "}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Now you can start and enable the Docker service, to have it automatically run in the background when you start your server:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"bash"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-bash"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-bash"]},"children":[{"type":"text","value":"systemctl start docker\nsystemctl "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"enable"}]},{"type":"text","value":" docker"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"a","properties":{"className":["gatsby-resp-image-link"],"href":"/static/b67c62f43b1ae1cb5bd6473099c10ae5/d7315/Kubernetes-Aliyun-02.png","style":"display: block","target":"_blank","rel":["noopener"]},"children":[{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-wrapper"],"style":"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 800px;"},"children":[{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-background-image"],"style":"padding-bottom: 13.591022443890274%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAIAAAAcOLh5AAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAgElEQVQI103IaQ6CMBCG4d5A6UYoP7RIsC2dkm5AXO5/LSuoMXkyme9F+D4fwEMMjxzWcVqNu2knucJcM64pUx/l3/0KUwg/52NOQwh+iS5HWKJP4Ty4SlraAblseiCysPRkSYlF7wpU5YSvE5NQC1M35n2FYa2hYtN+7bP57+MLEesYMHDKHUwAAAAASUVORK5CYII='); background-size: cover; display: block;"},"children":[]},{"type":"text","value":"\n    "},{"type":"element","tagName":"img","properties":{"className":["gatsby-resp-image-image"],"style":"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px transparent;","alt":"Kubernetes Aliyun","title":"","src":"/static/b67c62f43b1ae1cb5bd6473099c10ae5/de8ec/Kubernetes-Aliyun-02.png","srcSet":["/static/b67c62f43b1ae1cb5bd6473099c10ae5/81654/Kubernetes-Aliyun-02.png 200w","/static/b67c62f43b1ae1cb5bd6473099c10ae5/3601a/Kubernetes-Aliyun-02.png 400w","/static/b67c62f43b1ae1cb5bd6473099c10ae5/de8ec/Kubernetes-Aliyun-02.png 800w","/static/b67c62f43b1ae1cb5bd6473099c10ae5/d7315/Kubernetes-Aliyun-02.png 802w"],"sizes":["(max-width:","800px)","100vw,","800px"]},"children":[]},{"type":"text","value":"\n  "}]},{"type":"text","value":"\n  "}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{"id":"installing-kubernetes"},"children":[{"type":"element","tagName":"a","properties":{"href":"#installing-kubernetes","ariaLabel":"installing kubernetes permalink","className":["anchor"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"Installing Kubernetes"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Kubernetes can be installed from the "},{"type":"element","tagName":"a","properties":{"href":"https://opsx.alibaba.com/mirror"},"children":[{"type":"text","value":"Alibaba Mirror"}]},{"type":"text","value":" which holds both a "},{"type":"element","tagName":"a","properties":{"href":"https://mirrors.aliyun.com/kubernetes/apt/"},"children":[{"type":"text","value":"Debian/Ubuntu (apt)"}]},{"type":"text","value":" as well as a "},{"type":"element","tagName":"a","properties":{"href":"https://mirrors.aliyun.com/kubernetes/yum/"},"children":[{"type":"text","value":"RHEL/CentOS (yum)"}]},{"type":"text","value":" version. For CentOS their currently "},{"type":"element","tagName":"a","properties":{"href":"https://mirrors.aliyun.com/kubernetes/yum/repos/"},"children":[{"type":"text","value":"two versions hosted"}]},{"type":"text","value":", el6 and el7, for RHEL6/CentOS6 and REHL7/CentOS7, respectively:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"a","properties":{"className":["gatsby-resp-image-link"],"href":"/static/a402bb3b10bec6183e7f34a570c2d147/5d97e/Kubernetes-Aliyun-03.png","style":"display: block","target":"_blank","rel":["noopener"]},"children":[{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-wrapper"],"style":"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 800px;"},"children":[{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-background-image"],"style":"padding-bottom: 43.63411619283065%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABCklEQVQoz3WRfWuDMBDG/f7fa6iMtcytMWo1igNZTCxGjYl52VLL6vzDh+PIcfe7J3AehHFd11H06ZSkCYzjsqogTNwLAND37OdY3jQNQvB5nsaRDQPr3ThzmQ333GutrbX6QB79njss2obP3Cq1beWcd7cbJWQcRlfaVcYY+09e4Mv38xK8iDTTTWOecNtimGZZmmKMn7DDd98+nxQA+u1VlaXGrbF/ja6jqKpKhCjtHvBjww72/SWKdBgqhDTGG0wpyfK8KHJC6aEz/GBXOMHL8FUvhJh1bnWmpEAlKgq6g/fOYbAE4QIuSkorxNZzzte7cU7IsTNjysU4Kmu0MdsZpBR8lRDy6FS/5OMC8phhJngAAAAASUVORK5CYII='); background-size: cover; display: block;"},"children":[]},{"type":"text","value":"\n    "},{"type":"element","tagName":"img","properties":{"className":["gatsby-resp-image-image"],"style":"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px transparent;","alt":"Kubernetes Aliyun","title":"","src":"/static/a402bb3b10bec6183e7f34a570c2d147/de8ec/Kubernetes-Aliyun-03.png","srcSet":["/static/a402bb3b10bec6183e7f34a570c2d147/81654/Kubernetes-Aliyun-03.png 200w","/static/a402bb3b10bec6183e7f34a570c2d147/3601a/Kubernetes-Aliyun-03.png 400w","/static/a402bb3b10bec6183e7f34a570c2d147/de8ec/Kubernetes-Aliyun-03.png 800w","/static/a402bb3b10bec6183e7f34a570c2d147/5d97e/Kubernetes-Aliyun-03.png 809w"],"sizes":["(max-width:","800px)","100vw,","800px"]},"children":[]},{"type":"text","value":"\n  "}]},{"type":"text","value":"\n  "}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"On CentOS 7 we have to install the el7 version by adding the repository "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"nano /etc/yum.repos.d/kubernetes.repo"}]},{"type":"text","value":":"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"yaml"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"["}]},{"type":"text","value":"kubernetes"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"]"}]},{"type":"text","value":"\nname=Kubernetes\nbaseurl=https"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"//mirrors.aliyun.com/kubernetes/yum/repos/kubernetes"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"el7"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"x86_64\nenabled=1\ngpgcheck=0"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"blockquote","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"NOTE"}]},{"type":"text","value":": The following installation fails when you activate the "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"gpgcheck"}]},{"type":"text","value":". Re-running the installation after setting "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"gpgcheck=0"}]},{"type":"text","value":" “solved” this. I find this slightly troublesome, but will proceed for now - since this is just a local test server environment."}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"a","properties":{"className":["gatsby-resp-image-link"],"href":"/static/55d1ddb61d88cef3acab558057bcc764/e0a77/Kubernetes-Aliyun-04.png","style":"display: block","target":"_blank","rel":["noopener"]},"children":[{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-wrapper"],"style":"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 800px;"},"children":[{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-background-image"],"style":"padding-bottom: 14.1439205955335%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAIAAAAcOLh5AAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAbElEQVQI12PgDXXiDXHiDXXmDXcBoUBHvgBHPj8HMLLn87UHMniDnHgjXDARg6CVqbC2gYi0loiUFoiU1RaR04aSQCSvLSKjDRKX1hIVUhMVREEMgibGwsq6YJ3aUARULaMFRjCdELaEJhoCAPslGtGZWC+kAAAAAElFTkSuQmCC'); background-size: cover; display: block;"},"children":[]},{"type":"text","value":"\n    "},{"type":"element","tagName":"img","properties":{"className":["gatsby-resp-image-image"],"style":"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px transparent;","alt":"Kubernetes Aliyun","title":"","src":"/static/55d1ddb61d88cef3acab558057bcc764/de8ec/Kubernetes-Aliyun-04.png","srcSet":["/static/55d1ddb61d88cef3acab558057bcc764/81654/Kubernetes-Aliyun-04.png 200w","/static/55d1ddb61d88cef3acab558057bcc764/3601a/Kubernetes-Aliyun-04.png 400w","/static/55d1ddb61d88cef3acab558057bcc764/de8ec/Kubernetes-Aliyun-04.png 800w","/static/55d1ddb61d88cef3acab558057bcc764/e0a77/Kubernetes-Aliyun-04.png 806w"],"sizes":["(max-width:","800px)","100vw,","800px"]},"children":[]},{"type":"text","value":"\n  "}]},{"type":"text","value":"\n  "}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"bash"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-bash"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-bash"]},"children":[{"type":"text","value":"rpm --import https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg\nyum update\nyum "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"install"}]},{"type":"text","value":" -y kubelet kubeadm kubectl"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"a","properties":{"className":["gatsby-resp-image-link"],"href":"/static/e5edfca2e3a958feaecb70707fdecdae/8b662/Kubernetes-Aliyun-05.png","style":"display: block","target":"_blank","rel":["noopener"]},"children":[{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-wrapper"],"style":"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 800px;"},"children":[{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-background-image"],"style":"padding-bottom: 35.0920245398773%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAIAAACHqfpvAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABA0lEQVQY03WQi2qEMBBF/YJd847bdt2KpiZONMb46IOy9P8/qoktlC0sXIYhzL05MxnxU/65cuuus/9a/db1vrEhqoJQ26BsqvvLXFtXAReaCM2EwbzJSD+i9wVPU77N+Vs4qv5QwuEJjkwfWXsrnTNNeUtZS7neze2Atxk7j9yIRk+egdI2TQhN0w+3KjQ9d6TsaAmYNRleAvpYYoS4gDwZ+WCkNLIwqS8M2yP+VBiievLSk9Gjss1ImPLrSsPUrWF4DQMMroFBWVfDWHWPUuN/fvaDbZBQGTEuYcekJeAtRARyAXKGuBUVdyRjNShhg4vY0bZvPtKToekq952/tzCIq2+xvjb3qP2PpgAAAABJRU5ErkJggg=='); background-size: cover; display: block;"},"children":[]},{"type":"text","value":"\n    "},{"type":"element","tagName":"img","properties":{"className":["gatsby-resp-image-image"],"style":"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px transparent;","alt":"Kubernetes Aliyun","title":"","src":"/static/e5edfca2e3a958feaecb70707fdecdae/de8ec/Kubernetes-Aliyun-05.png","srcSet":["/static/e5edfca2e3a958feaecb70707fdecdae/81654/Kubernetes-Aliyun-05.png 200w","/static/e5edfca2e3a958feaecb70707fdecdae/3601a/Kubernetes-Aliyun-05.png 400w","/static/e5edfca2e3a958feaecb70707fdecdae/de8ec/Kubernetes-Aliyun-05.png 800w","/static/e5edfca2e3a958feaecb70707fdecdae/8b662/Kubernetes-Aliyun-05.png 815w"],"sizes":["(max-width:","800px)","100vw,","800px"]},"children":[]},{"type":"text","value":"\n  "}]},{"type":"text","value":"\n  "}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"As described above - this install failed du to the active key check. Going back to "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"nano /etc/yum.repos.d/kubernetes.repo"}]},{"type":"text","value":" and setting "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"gpgcheck=0"}]},{"type":"text","value":" solved this for now:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"a","properties":{"className":["gatsby-resp-image-link"],"href":"/static/84413ef58af5f3ecc05fe873e257c9a4/e0a77/Kubernetes-Aliyun-06.png","style":"display: block","target":"_blank","rel":["noopener"]},"children":[{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-wrapper"],"style":"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 800px;"},"children":[{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-background-image"],"style":"padding-bottom: 20.347394540942926%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAIAAAABPYjBAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAo0lEQVQI1y2PjQ6CMAyEeYW1RdTwp4LZTzcYiNH3fzFbJLksl12/W1eAmyAvOERsAzWBTlaEPeM9Uh+pDnTxhBZrjx3Lvc40TGdHlSuQZ/PZYFnMe4Uwa8uQqGWqvUzgmIBncLNEYjT9VxzwM5nvBlOW981rhZTxEaljunoiq3DKiokkGpNK2qsdBs4K3GRtplJ2dsd50lg9WmlRiSl3ydd2+Aeb+h4W2lVxvgAAAABJRU5ErkJggg=='); background-size: cover; display: block;"},"children":[]},{"type":"text","value":"\n    "},{"type":"element","tagName":"img","properties":{"className":["gatsby-resp-image-image"],"style":"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px transparent;","alt":"Kubernetes Aliyun","title":"","src":"/static/84413ef58af5f3ecc05fe873e257c9a4/de8ec/Kubernetes-Aliyun-06.png","srcSet":["/static/84413ef58af5f3ecc05fe873e257c9a4/81654/Kubernetes-Aliyun-06.png 200w","/static/84413ef58af5f3ecc05fe873e257c9a4/3601a/Kubernetes-Aliyun-06.png 400w","/static/84413ef58af5f3ecc05fe873e257c9a4/de8ec/Kubernetes-Aliyun-06.png 800w","/static/84413ef58af5f3ecc05fe873e257c9a4/e0a77/Kubernetes-Aliyun-06.png 806w"],"sizes":["(max-width:","800px)","100vw,","800px"]},"children":[]},{"type":"text","value":"\n  "}]},{"type":"text","value":"\n  "}]}]},{"type":"text","value":"\n"},{"type":"comment","value":"\n\n\n本来打算搭建istio环境，然后默置安装了kubernetes1.5.2集群，结果RBAC模式不被支持，然后切换到kubernetes1.7.5。\n\n祝你好运吧！\n\n一、基础环境配置，以下环境基于Docker\n\nmaster和slave的kubernetes yum源必须都修改\n\nvi /etc/yum.repos.d/kubernetes.repo\n\n[kubernetes]\nname=Kubernetes\nbaseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64\nenabled=1\ngpgcheck=0\n\n(1)关闭swap\n\nswapoff -a\n\n(2)关闭SELinux，修改SELINUX属性\n\nsetenforce 0\n\nvi /etc/sysconfig/selinux\n\nSELINUX=disabled    \n\n(3)设置iptables\n\nvi /etc/sysctl.d/k8s.conf\n\nnet.bridge.bridge-nf-call-ip6tables = 1\n\nnet.bridge.bridge-nf-call-iptables = 1\n\n同iptables\n\nsysctl --system\n\n[1]以防在kubeadm init时出现如下错误\n\n[kubeadm] WARNING: kubeadm is in beta, please do not use it for production clusters.\n[init] Using Kubernetes version: v1.7.5\n[init] Using Authorization modes: [Node RBAC]\n[preflight] Running pre-flight checks\n[preflight] WARNING: kubelet service is not enabled, please run 'systemctl enable kubelet.service'\n[preflight] WARNING: docker service is not enabled, please run 'systemctl enable docker.service'\n[preflight] Some fatal errors occurred:\n    /proc/sys/net/bridge/bridge-nf-call-iptables contents are not set to 1\n\n(4)安装socat\n\nyum install -y socat\n\nrpm -qa|grep socat\n\nsystemctl enable socat\n\n\n二、安装kubernetes集群\n\nMaster:安装master\n\n1、检查docker，如果没有安装docker,请看前面docker系列\n\ndocker version\n\n2、安装kubectl、kubelet、kubeadm [yum源的问题使用阿里云的可以获取]\n\nyum install -y kubelet kubeadm kubectl\n\n(2)启动kubelet\n\nsystemctl start kubelet\n\nsystemctl status kubelet #查看是否启动成功\n\n注意：[有人说要先修改/etc/systemd/system/kubelet.service.d/10-kubeadm.conf下参数，我修改后发现kubelet无法启动]\n\n(3)初始化master\n\nkubeadm init --apiserver-advertise-address=192.168.117.132 --pod-network-cidr=192.168.0.0/16 --kubernetes-version=v1.7.5 --skip-preflight-checks\n\n参数说明：\n\n[1]--kubernetes-version=v1.7.5，如果不加版本号会导致报错\n\n[kubeadm] WARNING: kubeadm is in beta, please do not use it for production clusters.unable to get URL \"https://storage.googleapis.com/kubernetes-release/release/stable-1.7.txt\": Get https://storage.googleapis.com/kubernetes-release/release/stable-1.7.txt: net/http: TLS handshake timeout\n\n或者\n\n[kubeadm] WARNING: kubeadm is in beta, please do not use it for production clusters.\nunable to get URL \"https://storage.googleapis.com/kubernetes-release/release/stable-1.7.txt\": Get https://storage.googleapis.com/kubernetes-release/release/stable-1.7.txt: dial tcp 172.217.160.112:443: getsockopt: connection refused\n[2]--skip-preflight-checks，可以防止每次初始化都去检查配置文件，否则可能在多次init后报错[etcd在使用、kubelet在使\n\n用，因为每次init，kubeadm其实都会去启动etcd/kubelet]\n\n[3]还有可能出现的错误是镜像错误\n\n初始化一直卡在[apiclient] Created API client, waiting for the control plane to become ready\n\n或者\n\nUnfortunately, an error has occurred:\n    timed out waiting for the condition\n\nThis error is likely caused by that:\n    - The kubelet is not running\n    - The kubelet is unhealthy due to a misconfiguration of the node in some way (required cgroups disabled)\n    - There is no internet connection; so the kubelet can't pull the following control plane images:\n        - gcr.io/google_containers/kube-apiserver-amd64:v1.8.4\n        - gcr.io/google_containers/kube-controller-manager-amd64:v1.8.4\n        - gcr.io/google_containers/kube-scheduler-amd64:v1.8.4\n\nYou can troubleshoot this for example with the following commands if you're on a systemd-powered system:\n    - 'systemctl status kubelet'\n    - 'journalctl -xeu kubelet'\ncouldn't initialize a Kubernetes cluster\n\n{网上有人提出了一个很好的方法，就是先把需要的镜像下载下来改tag名，但是可能导致镜像不匹配问题}\n\ndocker pull docker.io/sylzd/etcd-amd64-3.0.17\ndocker tag docker.io/sylzd/etcd-amd64-3.0.17:latest gcr.io/google_containers/etcd-amd64:3.0.17\ndocker pull registry.cn-hangzhou.aliyuncs.com/google-containers/kube-apiserver-amd64:v1.7.5\ndocker tag registry.cn-hangzhou.aliyuncs.com/google-containers/kube-apiserver-amd64:v1.7.5 gcr.io/google_containers/kube-apiserver-amd64:v1.7.5\ndocker pull registry.cn-hangzhou.aliyuncs.com/google-containers/kube-controller-manager-amd64:v1.7.5\ndocker tag registry.cn-hangzhou.aliyuncs.com/google-containers/kube-controller-manager-amd64:v1.7.5 gcr.io/google_containers/kube-controller-manager-amd64:v1.7.5\ndocker pull registry.cn-hangzhou.aliyuncs.com/google-containers/kube-scheduler-amd64:v1.7.5\ndocker tag registry.cn-hangzhou.aliyuncs.com/google-containers/kube-scheduler-amd64:v1.7.5 gcr.io/google_containers/kube-scheduler-amd64:v1.7.5\n\ndocker pull visenzek8s/pause-amd64:3.0\ndocker tag visenzek8s/pause-amd64:3.0 gcr.io/google_containers/pause-amd64:3.0\n\ndocker pull mirrorgooglecontainers/kube-proxy-amd64:v1.7.5\ndocker tag mirrorgooglecontainers/kube-proxy-amd64:v1.7.5 gcr.io/google_containers/kube-proxy-amd64:v1.7.5\n\ndocker pull registry.cn-hangzhou.aliyuncs.com/google-containers/k8s-dns-kube-dns-amd64:1.14.4\ndocker tag registry.cn-hangzhou.aliyuncs.com/google-containers/k8s-dns-kube-dns-amd64:1.14.4 gcr.io/google_containers/k8s-dns-kube-dns-amd64:1.14.4\n\ndocker pull registry.cn-hangzhou.aliyuncs.com/google-containers/k8s-dns-sidecar-amd64:1.14.4\ndocker tag registry.cn-hangzhou.aliyuncs.com/google-containers/k8s-dns-sidecar-amd64:1.14.4 gcr.io/google_containers/k8s-dns-sidecar-amd64:1.14.4\n\ndocker pull mirrorgooglecontainers/k8s-dns-dnsmasq-nanny-amd64:1.14.4\ndocker tag mirrorgooglecontainers/k8s-dns-dnsmasq-nanny-amd64:1.14.4 gcr.io/google_containers/k8s-dns-dnsmasq-nanny-amd64:1.14.4\n\ndocker pull quay.io/coreos/flannel  #失败\ndocker pull quay.io/coreos/flannel:v0.9.1-amd64\n\n注意：只有出现以下提示才是搭建成功（记住提示kubeadm join --token xxxxxxx命令，在slave从服务器上会使用）\n\nkubeadm token list命令也可以查看token，但是可能会有多条记录\n\nYour Kubernetes master has initialized successfully!To start using your cluster, you need to run (as a regular user): mkdir -p $HOME/.kube sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config sudo chown $(id -u):$(id -g) $HOME/.kube/configYou should now deploy a pod network to the cluster.Run \"kubectl apply -f [podnetwork].yaml\" with one of the options listed at: http://kubernetes.io/docs/admin/addons/You can now join any number of machines by running the following on each nodeas root: kubeadm join --token xxxxxxxxx\n\n(4)配置root用户/非root用户模式管理集群\n\nroot模式：\n\nvi /etc/profile\nexport KUBECONFIG=/etc/kubernetes/admin.conf\nsource /etc/profile\n\n普通用户模式：\n\nmkdir -p $HOME/.kube \ncp -i /etc/kubernetes/admin.conf $HOME/.kube/config \nchown $(id -u):$(id -g) $HOME/.kube/config\n\n这一步很关键，否则kubectl监控会报错\n\n(5)网络配置，可以选择Calico、Canal、Flannel、Weave网络模式（有人说Flannel最好用，但是我感觉坑好多），两种配置方式如下：\n\na、先将kube-flannel.yml下载到本地，或者自己创建一个和官网一样的kube-flannel.yml文件，在当前目录执行\n\nkubectl apply -f kube-flannel.yml\n\nb、通过网络执行\n\nkubectl apply -f https://raw.githubusercontent.com/coreos/flannel/v0.9.1/Documentation/kube-flannel.yml\n\n检查flannel是否正常安装启动\n\nkubectl get pods --all-namespaces\n\n注意：如果出现Error、Pending、ImagePullBackOff、CrashLoopBackOff都属于启动失败的Pod，原因需要仔细排除\n\na、查看 /var/log/messages系统日志\n\nb、kubectl describe pod kube-flannel-ds-2wk55 --namespace=kube-system\n\nc、kubectl logs -f kube-dns-2425271678-37lf7 -n kube-system kubedns\n\n(6)默认情况下pod不会被schedule到master节点上\n\nkubectl taint nodes --all node-role.kubernetes.io/master-\n\n报错\n\nnode \"master\" untainted\n\n或者\n\nerror: taint \"node-role.kubernetes.io/master:\" not found\n\n错误\n\n[1]因为我第一次安装的1.5.2没有卸载干净\n\nTransaction check error:\n  file /usr/bin/kubectl from install of kubectl-1.7.5-0.x86_64 conflicts with file from package kubernetes-client-1.5.2-0.7.git269f928.el7.x86_64\n\nSlave:安装slave从服务器\n\n1、操作和以上基础操作(1)、(2)、(3)一样\n\n2、将master中一些镜像导出，然后导入到slave中\n\ndocker save -o /opt/kube-pause.tar gcr.io/google_containers/pause-amd64:3.0\ndocker save -o /opt/kube-proxy.tar gcr.io/google_containers/kube-proxy-amd64:v1.7.5\ndocker save -o /opt/kube-flannel.tar quay.io/coreos/flannel:v0.9.1-amd64\ndocker load -i /opt/kube-flannel.tar\ndocker load -i /opt/kube-proxy.tar\ndocker load -i /opt/kube-pause.tar\n\n3、在slave上安装kubeadm，然后执行master init后提示的kubeadm join --token\n\nkubeadm join --token 04c77a.416fb2c7971328af 192.168.117.132:6443\n\n4、切换到master检查子节点是否连接正常\n\nkubectl get nodes\n\n错误\n\n[1][discovery] Failed to request cluster info, will try again: [Get https://192.168.117.132:6443/api/v1/namespaces/kube-public/configmaps/cluster-info: dial tcp 192.168.117.132:6443: getsockopt: no route to host]\n\n原因是master开着防火墙，把防火墙关掉就行了\n\n[2]failed to check server version: Get https://192.168.117.132:6443/version: x509: certificate has expired or is not yet valid\n\n原因是master和slave的时间不同步，这一点和Elasticsearch/Kibana一样，必须时间同步，所以安装ntp就可以了\n\n\n{***坎坎坷坷这一周内，从各种VPN到github，每天晚上回来搭到十二点，终于可以告一段落了，参考了很多文章，回头有时间再详细列出来，各位有什么问题的欢迎指正、交流***}\n\n\n "}],"data":{"quirksMode":false}},"fields":{"slug":"/kubernetes-the-chinese-way/","prefix":"2019-01-27"},"frontmatter":{"title":"Kubernetes the Chinese Way","subTitle":"Red Hat Enterprise and Centos Linux Server Administration","cover":{"childImageSharp":{"resize":{"src":"/static/ed12d89a2bb8e2cde9d718a17e77cf93/152f9/photo-76834w36_4356dfgdsds_o-cover.png"}}}}},"author":{"id":"9c69de06-11ab-55c9-b52a-3cc0b2f51365","html":"<p><strong>Mike Polinowski</strong> Proin ornare ligula eu tellus tempus elementum. Aenean <a href=\"/contact/\">contact me</a> iaculis mi, nec blandit lacus interdum vitae. Vestibulum non nibh risus, a scelerisque purus. :hearts:</p>"},"footnote":{"id":"24817670-3434-5a21-9de1-e9fab89708d7","html":"<ul>\n<li>This is a personal Developer Blog</li>\n<li>Ξ</li>\n<li>built by <a href=\"https://github.com/mpolinowski\">Mike Polinowski</a></li>\n<li>Ξ</li>\n<li>with <a href=\"https://www.gatsbyjs.org/\">Gatsby</a> &#x26; <a href=\"https://reactjs.org\">React</a></li>\n<li>Ξ</li>\n<li>source code on <a href=\"https://github.com/mpolinowski/mpolinowski.github.io\">GitHub</a></li>\n<li>Ξ</li>\n<li>deliverd by <a href=\"https://pages.github.com\">Github Pages</a></li>\n<li>Ξ</li>\n<li>photos from <a href=\"https://www.flickr.com/people/149680084@N06/\">Flickr</a></li>\n</ul>"}},"pageContext":{"slug":"/kubernetes-the-chinese-way/"}}